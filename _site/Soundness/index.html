<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Soundness: of reduction with respect to denotational semantics | Programming Language Foundations in Agda
</title><!-- Begin Jekyll SEO tag v2.5.0 -->
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Soundness: of reduction with respect to denotational semantics" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Programming Language Foundations in Agda" />
<meta property="og:description" content="Programming Language Foundations in Agda" />
<link rel="canonical" href="https://plfa.github.io/Soundness/" />
<meta property="og:url" content="https://plfa.github.io/Soundness/" />
<meta property="og:site_name" content="Programming Language Foundations in Agda" />
<script type="application/ld+json">
{"description":"Programming Language Foundations in Agda","@type":"WebPage","headline":"Soundness: of reduction with respect to denotational semantics","url":"https://plfa.github.io/Soundness/","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"></head>
<body><header class="site-header" role="banner">

    <div class="wrapper">

        <a class="site-title" href="/">Programming Language Foundations in Agda
</a>

        <nav class="site-nav">
            <span class="menu-icon">
                <svg viewBox="0 0 18 15" width="18px" height="15px">
                    <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
                    <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
                    <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
                </svg>
            </span>

            <div class="trigger">
                <a class="page-link" href="/">The Book</a>
                <!--!>
                <a class="page-link" href="/Announcements/">Announcements</a>
                <---->
                <a class="page-link" href="/GettingStarted/">Getting Started</a>
                <a class="page-link" href="/Citing/">Citing</a>
                <a class="page-link" href="https://agda-zh.github.io/PLFA-zh/">中文</a>
            </div>
        </nav>

    </div>

</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
      <h1 class="post-title">Soundness: of reduction with respect to denotational semantics</h1>
  </header>

  <p style="text-align:center;">
    
    <a alt="Previous chapter" href="/Compositional/">Prev</a>
    &bullet;
    
    
    <a alt="Source code" href="https://github.com/plfa/plfa.github.io/blob/dev/src/plfa/Soundness.lagda">Source</a>
    
    
    &bullet;
    <a alt="Next chapter" href="/Adequacy/">Next</a>
    
</p>


  <div class="post-content">
    <pre class="Agda"><a id="192" class="Keyword">module</a> <a id="199" href="/Soundness/" class="Module">plfa.Soundness</a> <a id="214" class="Keyword">where</a></pre>

<h2 id="introduction">Introduction</h2>

<p>In this chapter we prove that the reduction semantics is sound with
respect to the denotational semantics, i.e., for any term L</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>L —↠ ƛ N  implies  ℰ L ≃ ℰ (ƛ N)
</code></pre></div></div>

<p>The proof is by induction on the reduction sequence, so the main lemma
concerns a single reduction step. We prove that if any term <code class="highlighter-rouge">M</code> steps
to a term <code class="highlighter-rouge">N</code>, then <code class="highlighter-rouge">M</code> and <code class="highlighter-rouge">N</code> are denotationally equal. We shall
prove each direction of this if-and-only-if separately. One direction
will look just like a type preservation proof. The other direction is
like proving type preservation for reduction going in reverse.  Recall
that type preservation is sometimes called subject
reduction. Preservation in reverse is a well-known property and is
called <em>subject expansion</em>. It is also well-known that subject
expansion is false for most typed lambda calculi!</p>

<h2 id="imports">Imports</h2>

<pre class="Agda"><a id="1094" class="Keyword">open</a> <a id="1099" class="Keyword">import</a> <a id="1106" href="/Untyped/" class="Module">plfa.Untyped</a>
  <a id="1121" class="Keyword">using</a> <a id="1127" class="Symbol">(</a><a id="1128" href="/Untyped/#2980" class="Datatype">Context</a><a id="1135" class="Symbol">;</a> <a id="1137" href="/Untyped/#3018" class="InductiveConstructor Operator">_,_</a><a id="1140" class="Symbol">;</a> <a id="1142" href="/Untyped/#3365" class="Datatype Operator">_∋_</a><a id="1145" class="Symbol">;</a> <a id="1147" href="/Untyped/#4150" class="Datatype Operator">_⊢_</a><a id="1150" class="Symbol">;</a> <a id="1152" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="1153" class="Symbol">;</a> <a id="1155" href="/Untyped/#3401" class="InductiveConstructor">Z</a><a id="1156" class="Symbol">;</a> <a id="1158" href="/Untyped/#3446" class="InductiveConstructor Operator">S_</a><a id="1160" class="Symbol">;</a> <a id="1162" href="/Untyped/#4186" class="InductiveConstructor Operator">`_</a><a id="1164" class="Symbol">;</a> <a id="1166" href="/Untyped/#4238" class="InductiveConstructor Operator">ƛ_</a><a id="1168" class="Symbol">;</a> <a id="1170" href="/Untyped/#4298" class="InductiveConstructor Operator">_·_</a><a id="1173" class="Symbol">;</a>
         <a id="1184" href="/Untyped/#6931" class="Function">subst</a><a id="1189" class="Symbol">;</a> <a id="1191" href="/Untyped/#7475" class="Function Operator">_[_]</a><a id="1195" class="Symbol">;</a> <a id="1197" href="/Untyped/#7359" class="Function">subst-zero</a><a id="1207" class="Symbol">;</a> <a id="1209" href="/Untyped/#5845" class="Function">ext</a><a id="1212" class="Symbol">;</a> <a id="1214" href="/Untyped/#6171" class="Function">rename</a><a id="1220" class="Symbol">;</a> <a id="1222" href="/Untyped/#6623" class="Function">exts</a><a id="1226" class="Symbol">)</a>
<a id="1228" class="Keyword">open</a> <a id="1233" class="Keyword">import</a> <a id="1240" href="/LambdaReduction/" class="Module">plfa.LambdaReduction</a>
  <a id="1263" class="Keyword">using</a> <a id="1269" class="Symbol">(</a><a id="1270" href="/LambdaReduction/#386" class="Datatype Operator">_—→_</a><a id="1274" class="Symbol">;</a> <a id="1276" href="/LambdaReduction/#436" class="InductiveConstructor">ξ₁</a><a id="1278" class="Symbol">;</a> <a id="1280" href="/LambdaReduction/#526" class="InductiveConstructor">ξ₂</a><a id="1282" class="Symbol">;</a> <a id="1284" href="/LambdaReduction/#616" class="InductiveConstructor">β</a><a id="1285" class="Symbol">;</a> <a id="1287" href="/LambdaReduction/#724" class="InductiveConstructor">ζ</a><a id="1288" class="Symbol">;</a> <a id="1290" href="/LambdaReduction/#894" class="Datatype Operator">_—↠_</a><a id="1294" class="Symbol">;</a> <a id="1296" href="/LambdaReduction/#1001" class="InductiveConstructor Operator">_—→⟨_⟩_</a><a id="1303" class="Symbol">;</a> <a id="1305" href="/LambdaReduction/#944" class="InductiveConstructor Operator">_[]</a><a id="1308" class="Symbol">)</a>
<a id="1310" class="Keyword">open</a> <a id="1315" class="Keyword">import</a> <a id="1322" href="/Substitution/" class="Module">plfa.Substitution</a> <a id="1340" class="Keyword">using</a> <a id="1346" class="Symbol">(</a><a id="1347" href="/Substitution/#2275" class="Function">Rename</a><a id="1353" class="Symbol">;</a> <a id="1355" href="/Substitution/#2504" class="Function">Subst</a><a id="1360" class="Symbol">;</a> <a id="1362" href="/Substitution/#3177" class="Function">ids</a><a id="1365" class="Symbol">)</a>
<a id="1367" class="Keyword">open</a> <a id="1372" class="Keyword">import</a> <a id="1379" href="/Denotational/" class="Module">plfa.Denotational</a>
  <a id="1399" class="Keyword">using</a> <a id="1405" class="Symbol">(</a><a id="1406" href="/Denotational/#3999" class="Datatype">Value</a><a id="1411" class="Symbol">;</a> <a id="1413" href="/Denotational/#4019" class="InductiveConstructor">⊥</a><a id="1414" class="Symbol">;</a> <a id="1416" href="/Denotational/#7233" class="Function">Env</a><a id="1419" class="Symbol">;</a> <a id="1421" href="/Denotational/#9519" class="Datatype Operator">_⊢_↓_</a><a id="1426" class="Symbol">;</a> <a id="1428" href="/Denotational/#7406" class="Function Operator">_`,_</a><a id="1432" class="Symbol">;</a> <a id="1434" href="/Denotational/#4370" class="Datatype Operator">_⊑_</a><a id="1437" class="Symbol">;</a> <a id="1439" href="/Denotational/#8259" class="Function Operator">_`⊑_</a><a id="1443" class="Symbol">;</a> <a id="1445" href="/Denotational/#8478" class="Function">`⊥</a><a id="1447" class="Symbol">;</a> <a id="1449" href="/Denotational/#8507" class="Function Operator">_`⊔_</a><a id="1453" class="Symbol">;</a> <a id="1455" href="/Denotational/#7659" class="Function">init</a><a id="1459" class="Symbol">;</a> <a id="1461" href="/Denotational/#7714" class="Function">last</a><a id="1465" class="Symbol">;</a> <a id="1467" href="/Denotational/#7763" class="Function">init-last</a><a id="1476" class="Symbol">;</a>
         <a id="1487" href="/Denotational/#5540" class="Function">Refl⊑</a><a id="1492" class="Symbol">;</a> <a id="1494" href="/Denotational/#4667" class="InductiveConstructor">Trans⊑</a><a id="1500" class="Symbol">;</a> <a id="1502" href="/Denotational/#8777" class="Function">`Refl⊑</a><a id="1508" class="Symbol">;</a> <a id="1510" href="/Denotational/#25541" class="Function">Env⊑</a><a id="1514" class="Symbol">;</a> <a id="1516" href="/Denotational/#8845" class="Function">EnvConjR1⊑</a><a id="1526" class="Symbol">;</a> <a id="1528" href="/Denotational/#8942" class="Function">EnvConjR2⊑</a><a id="1538" class="Symbol">;</a> <a id="1540" href="/Denotational/#25985" class="Function">up-env</a><a id="1546" class="Symbol">;</a>
         <a id="1557" href="/Denotational/#9573" class="InductiveConstructor">var</a><a id="1560" class="Symbol">;</a> <a id="1562" href="/Denotational/#9652" class="InductiveConstructor">↦-elim</a><a id="1568" class="Symbol">;</a> <a id="1570" href="/Denotational/#9790" class="InductiveConstructor">↦-intro</a><a id="1577" class="Symbol">;</a> <a id="1579" href="/Denotational/#9914" class="InductiveConstructor">⊥-intro</a><a id="1586" class="Symbol">;</a> <a id="1588" href="/Denotational/#9989" class="InductiveConstructor">⊔-intro</a><a id="1595" class="Symbol">;</a> <a id="1597" href="/Denotational/#10120" class="InductiveConstructor">sub</a><a id="1600" class="Symbol">;</a>
         <a id="1611" href="/Denotational/#23933" class="Function">rename-pres</a><a id="1622" class="Symbol">;</a> <a id="1624" href="/Denotational/#17652" class="Function">ℰ</a><a id="1625" class="Symbol">;</a> <a id="1627" href="/Denotational/#17850" class="Function Operator">_≃_</a><a id="1630" class="Symbol">;</a> <a id="1632" href="/Denotational/#18271" class="Function">≃-trans</a><a id="1639" class="Symbol">)</a>
<a id="1641" class="Keyword">open</a> <a id="1646" class="Keyword">import</a> <a id="1653" href="/Compositional/" class="Module">plfa.Compositional</a> <a id="1672" class="Keyword">using</a> <a id="1678" class="Symbol">(</a><a id="1679" href="/Compositional/#3655" class="Function">lambda-inversion</a><a id="1695" class="Symbol">;</a> <a id="1697" href="/Compositional/#9866" class="Function">var-inv</a><a id="1704" class="Symbol">)</a>

<a id="1707" class="Keyword">open</a> <a id="1712" class="Keyword">import</a> <a id="1719" href="https://agda.github.io/agda-stdlib/v0.17/Relation.Binary.PropositionalEquality.html" class="Module">Relation.Binary.PropositionalEquality</a>
  <a id="1759" class="Keyword">using</a> <a id="1765" class="Symbol">(</a><a id="1766" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Equality.html#83" class="Datatype Operator">_≡_</a><a id="1769" class="Symbol">;</a> <a id="1771" href="https://agda.github.io/agda-stdlib/v0.17/Relation.Binary.PropositionalEquality.Core.html#660" class="Function Operator">_≢_</a><a id="1774" class="Symbol">;</a> <a id="1776" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a><a id="1780" class="Symbol">;</a> <a id="1782" href="https://agda.github.io/agda-stdlib/v0.17/Relation.Binary.PropositionalEquality.Core.html#838" class="Function">sym</a><a id="1785" class="Symbol">;</a> <a id="1787" href="https://agda.github.io/agda-stdlib/v0.17/Relation.Binary.PropositionalEquality.html#1170" class="Function">cong</a><a id="1791" class="Symbol">;</a> <a id="1793" href="https://agda.github.io/agda-stdlib/v0.17/Relation.Binary.PropositionalEquality.html#1408" class="Function">cong₂</a><a id="1798" class="Symbol">;</a> <a id="1800" href="https://agda.github.io/agda-stdlib/v0.17/Relation.Binary.PropositionalEquality.html#1274" class="Function">cong-app</a><a id="1808" class="Symbol">)</a>
<a id="1810" class="Keyword">open</a> <a id="1815" class="Keyword">import</a> <a id="1822" href="https://agda.github.io/agda-stdlib/v0.17/Data.Product.html" class="Module">Data.Product</a> <a id="1835" class="Keyword">using</a> <a id="1841" class="Symbol">(</a><a id="1842" href="https://agda.github.io/agda-stdlib/v0.17/Data.Product.html#1353" class="Function Operator">_×_</a><a id="1845" class="Symbol">;</a> <a id="1847" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#69" class="Record">Σ</a><a id="1848" class="Symbol">;</a> <a id="1850" href="https://agda.github.io/agda-stdlib/v0.17/Data.Product.html#764" class="Function">Σ-syntax</a><a id="1858" class="Symbol">;</a> <a id="1860" href="https://agda.github.io/agda-stdlib/v0.17/Data.Product.html#881" class="Function">∃</a><a id="1861" class="Symbol">;</a> <a id="1863" href="https://agda.github.io/agda-stdlib/v0.17/Data.Product.html#942" class="Function">∃-syntax</a><a id="1871" class="Symbol">;</a> <a id="1873" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#155" class="Field">proj₁</a><a id="1878" class="Symbol">;</a> <a id="1880" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#167" class="Field">proj₂</a><a id="1885" class="Symbol">)</a>
  <a id="1889" class="Keyword">renaming</a> <a id="1898" class="Symbol">(</a><a id="1899" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">_,_</a> <a id="1903" class="Symbol">to</a> <a id="1906" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨_,_⟩</a><a id="1911" class="Symbol">)</a>
<a id="1913" class="Keyword">open</a> <a id="1918" class="Keyword">import</a> <a id="1925" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Primitive.html" class="Module">Agda.Primitive</a> <a id="1940" class="Keyword">using</a> <a id="1946" class="Symbol">(</a><a id="1947" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Primitive.html#611" class="Primitive">lzero</a><a id="1952" class="Symbol">)</a>
<a id="1954" class="Keyword">open</a> <a id="1959" class="Keyword">import</a> <a id="1966" href="https://agda.github.io/agda-stdlib/v0.17/Relation.Nullary.html" class="Module">Relation.Nullary</a> <a id="1983" class="Keyword">using</a> <a id="1989" class="Symbol">(</a><a id="1990" href="https://agda.github.io/agda-stdlib/v0.17/Relation.Nullary.html#464" class="Function Operator">¬_</a><a id="1992" class="Symbol">)</a>
<a id="1994" class="Keyword">open</a> <a id="1999" class="Keyword">import</a> <a id="2006" href="https://agda.github.io/agda-stdlib/v0.17/Relation.Nullary.Negation.html" class="Module">Relation.Nullary.Negation</a> <a id="2032" class="Keyword">using</a> <a id="2038" class="Symbol">(</a><a id="2039" href="https://agda.github.io/agda-stdlib/v0.17/Relation.Nullary.Negation.html#560" class="Function">contradiction</a><a id="2052" class="Symbol">)</a>
<a id="2054" class="Keyword">open</a> <a id="2059" class="Keyword">import</a> <a id="2066" href="https://agda.github.io/agda-stdlib/v0.17/Data.Empty.html" class="Module">Data.Empty</a> <a id="2077" class="Keyword">using</a> <a id="2083" class="Symbol">(</a><a id="2084" href="https://agda.github.io/agda-stdlib/v0.17/Data.Empty.html#360" class="Function">⊥-elim</a><a id="2090" class="Symbol">)</a>
<a id="2092" class="Keyword">open</a> <a id="2097" class="Keyword">import</a> <a id="2104" href="https://agda.github.io/agda-stdlib/v0.17/Relation.Nullary.html" class="Module">Relation.Nullary</a> <a id="2121" class="Keyword">using</a> <a id="2127" class="Symbol">(</a><a id="2128" href="https://agda.github.io/agda-stdlib/v0.17/Relation.Nullary.html#534" class="Datatype">Dec</a><a id="2131" class="Symbol">;</a> <a id="2133" href="https://agda.github.io/agda-stdlib/v0.17/Relation.Nullary.html#570" class="InductiveConstructor">yes</a><a id="2136" class="Symbol">;</a> <a id="2138" href="https://agda.github.io/agda-stdlib/v0.17/Relation.Nullary.html#597" class="InductiveConstructor">no</a><a id="2140" class="Symbol">)</a>
<a id="2142" class="Keyword">open</a> <a id="2147" class="Keyword">import</a> <a id="2154" href="https://agda.github.io/agda-stdlib/v0.17/Function.html" class="Module">Function</a> <a id="2163" class="Keyword">using</a> <a id="2169" class="Symbol">(</a><a id="2170" href="https://agda.github.io/agda-stdlib/v0.17/Function.html#769" class="Function Operator">_∘_</a><a id="2173" class="Symbol">)</a>
<a id="2175" class="Comment">-- open import plfa.Isomorphism using (extensionality)  -- causes a bug!</a></pre>

<h2 id="forward-reduction-preserves-denotations">Forward reduction preserves denotations</h2>

<p>The proof of preservation in this section mixes techniques from
previous chapters. Like the proof of preservation for the STLC, we are
preserving a relation defined separately from the syntax, in contrast
to the inherently typed terms. On the other hand, we are using de
Bruijn indices for variables.</p>

<p>The outline of the proof remains the same in that we must prove lemmas
concerning all of the auxiliary functions used in the reduction
relation: substitution, renaming, and extension.</p>

<h3 id="simultaneous-substitution-preserves-denotations">Simultaneous substitution preserves denotations</h3>

<p>Our next goal is to prove that simultaneous substitution preserves
meaning.  That is, if <code class="highlighter-rouge">M</code> results in <code class="highlighter-rouge">v</code> in environment <code class="highlighter-rouge">γ</code>, then applying a
substitution <code class="highlighter-rouge">σ</code> to <code class="highlighter-rouge">M</code> gives us a program that also results in <code class="highlighter-rouge">v</code>, but in
an environment <code class="highlighter-rouge">δ</code> in which, for every variable <code class="highlighter-rouge">x</code>, <code class="highlighter-rouge">σ x</code> results in the
same value as the one for <code class="highlighter-rouge">x</code> in the original environment <code class="highlighter-rouge">γ</code>.
We write <code class="highlighter-rouge">δ ⊢ σ ↓ γ</code> for this condition.</p>

<pre class="Agda"><a id="3257" class="Keyword">infix</a> <a id="3263" class="Number">3</a> <a id="3265" href="/Soundness/#3272" class="Function Operator">_`⊢_↓_</a>
<a id="_`⊢_↓_"></a><a id="3272" href="/Soundness/#3272" class="Function Operator">_`⊢_↓_</a> <a id="3279" class="Symbol">:</a> <a id="3281" class="Symbol">∀{</a><a id="3283" href="/Soundness/#3283" class="Bound">Δ</a> <a id="3285" href="/Soundness/#3285" class="Bound">Γ</a><a id="3286" class="Symbol">}</a> <a id="3288" class="Symbol">→</a> <a id="3290" href="/Denotational/#7233" class="Function">Env</a> <a id="3294" href="/Soundness/#3283" class="Bound">Δ</a> <a id="3296" class="Symbol">→</a> <a id="3298" href="/Substitution/#2504" class="Function">Subst</a> <a id="3304" href="/Soundness/#3285" class="Bound">Γ</a> <a id="3306" href="/Soundness/#3283" class="Bound">Δ</a> <a id="3308" class="Symbol">→</a> <a id="3310" href="/Denotational/#7233" class="Function">Env</a> <a id="3314" href="/Soundness/#3285" class="Bound">Γ</a> <a id="3316" class="Symbol">→</a> <a id="3318" class="PrimitiveType">Set</a>
<a id="3322" href="/Soundness/#3272" class="Function Operator">_`⊢_↓_</a> <a id="3329" class="Symbol">{</a><a id="3330" href="/Soundness/#3330" class="Bound">Δ</a><a id="3331" class="Symbol">}{</a><a id="3333" href="/Soundness/#3333" class="Bound">Γ</a><a id="3334" class="Symbol">}</a> <a id="3336" href="/Soundness/#3336" class="Bound">δ</a> <a id="3338" href="/Soundness/#3338" class="Bound">σ</a> <a id="3340" href="/Soundness/#3340" class="Bound">γ</a> <a id="3342" class="Symbol">=</a> <a id="3344" class="Symbol">(∀</a> <a id="3347" class="Symbol">(</a><a id="3348" href="/Soundness/#3348" class="Bound">x</a> <a id="3350" class="Symbol">:</a> <a id="3352" href="/Soundness/#3333" class="Bound">Γ</a> <a id="3354" href="/Untyped/#3365" class="Datatype Operator">∋</a> <a id="3356" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="3357" class="Symbol">)</a> <a id="3359" class="Symbol">→</a> <a id="3361" href="/Soundness/#3336" class="Bound">δ</a> <a id="3363" href="/Denotational/#9519" class="Datatype Operator">⊢</a> <a id="3365" href="/Soundness/#3338" class="Bound">σ</a> <a id="3367" href="/Soundness/#3348" class="Bound">x</a> <a id="3369" href="/Denotational/#9519" class="Datatype Operator">↓</a> <a id="3371" href="/Soundness/#3340" class="Bound">γ</a> <a id="3373" href="/Soundness/#3348" class="Bound">x</a><a id="3374" class="Symbol">)</a></pre>

<p>As usual, to prepare for lambda abstraction, we prove an extension
lemma. It says that applying the <code class="highlighter-rouge">exts</code> function to a substitution
produces a new substitution that maps variables to terms that when
evaluated in <code class="highlighter-rouge">δ , v</code> produce the values in <code class="highlighter-rouge">γ , v</code>.</p>

<pre class="Agda"><a id="subst-ext"></a><a id="3655" href="/Soundness/#3655" class="Function">subst-ext</a> <a id="3665" class="Symbol">:</a> <a id="3667" class="Symbol">∀</a> <a id="3669" class="Symbol">{</a><a id="3670" href="/Soundness/#3670" class="Bound">Γ</a> <a id="3672" href="/Soundness/#3672" class="Bound">Δ</a> <a id="3674" href="/Soundness/#3674" class="Bound">v</a><a id="3675" class="Symbol">}</a> <a id="3677" class="Symbol">{</a><a id="3678" href="/Soundness/#3678" class="Bound">γ</a> <a id="3680" class="Symbol">:</a> <a id="3682" href="/Denotational/#7233" class="Function">Env</a> <a id="3686" href="/Soundness/#3670" class="Bound">Γ</a><a id="3687" class="Symbol">}</a> <a id="3689" class="Symbol">{</a><a id="3690" href="/Soundness/#3690" class="Bound">δ</a> <a id="3692" class="Symbol">:</a> <a id="3694" href="/Denotational/#7233" class="Function">Env</a> <a id="3698" href="/Soundness/#3672" class="Bound">Δ</a><a id="3699" class="Symbol">}</a>
  <a id="3703" class="Symbol">→</a> <a id="3705" class="Symbol">(</a><a id="3706" href="/Soundness/#3706" class="Bound">σ</a> <a id="3708" class="Symbol">:</a> <a id="3710" href="/Substitution/#2504" class="Function">Subst</a> <a id="3716" href="/Soundness/#3670" class="Bound">Γ</a> <a id="3718" href="/Soundness/#3672" class="Bound">Δ</a><a id="3719" class="Symbol">)</a>
  <a id="3723" class="Symbol">→</a> <a id="3725" href="/Soundness/#3690" class="Bound">δ</a> <a id="3727" href="/Soundness/#3272" class="Function Operator">`⊢</a> <a id="3730" href="/Soundness/#3706" class="Bound">σ</a> <a id="3732" href="/Soundness/#3272" class="Function Operator">↓</a> <a id="3734" href="/Soundness/#3678" class="Bound">γ</a>
   <a id="3739" class="Comment">--------------------------</a>
  <a id="3768" class="Symbol">→</a> <a id="3770" href="/Soundness/#3690" class="Bound">δ</a> <a id="3772" href="/Denotational/#7406" class="Function Operator">`,</a> <a id="3775" href="/Soundness/#3674" class="Bound">v</a> <a id="3777" href="/Soundness/#3272" class="Function Operator">`⊢</a> <a id="3780" href="/Untyped/#6623" class="Function">exts</a> <a id="3785" href="/Soundness/#3706" class="Bound">σ</a> <a id="3787" href="/Soundness/#3272" class="Function Operator">↓</a> <a id="3789" href="/Soundness/#3678" class="Bound">γ</a> <a id="3791" href="/Denotational/#7406" class="Function Operator">`,</a> <a id="3794" href="/Soundness/#3674" class="Bound">v</a>
<a id="3796" href="/Soundness/#3655" class="Function">subst-ext</a> <a id="3806" href="/Soundness/#3806" class="Bound">σ</a> <a id="3808" href="/Soundness/#3808" class="Bound">d</a> <a id="3810" href="/Untyped/#3401" class="InductiveConstructor">Z</a> <a id="3812" class="Symbol">=</a> <a id="3814" href="/Denotational/#9573" class="InductiveConstructor">var</a>
<a id="3818" href="/Soundness/#3655" class="Function">subst-ext</a> <a id="3828" href="/Soundness/#3828" class="Bound">σ</a> <a id="3830" href="/Soundness/#3830" class="Bound">d</a> <a id="3832" class="Symbol">(</a><a id="3833" href="/Untyped/#3446" class="InductiveConstructor Operator">S</a> <a id="3835" href="/Soundness/#3835" class="Bound">x′</a><a id="3837" class="Symbol">)</a> <a id="3839" class="Symbol">=</a> <a id="3841" href="/Denotational/#23933" class="Function">rename-pres</a> <a id="3853" href="/Untyped/#3446" class="InductiveConstructor Operator">S_</a> <a id="3856" class="Symbol">(λ</a> <a id="3859" href="/Soundness/#3859" class="Bound">_</a> <a id="3861" class="Symbol">→</a> <a id="3863" href="/Denotational/#5540" class="Function">Refl⊑</a><a id="3868" class="Symbol">)</a> <a id="3870" class="Symbol">(</a><a id="3871" href="/Soundness/#3830" class="Bound">d</a> <a id="3873" href="/Soundness/#3835" class="Bound">x′</a><a id="3875" class="Symbol">)</a></pre>

<p>The proof is by cases on the de Bruijn index <code class="highlighter-rouge">x</code>.</p>

<ul>
  <li>
    <p>If it is <code class="highlighter-rouge">Z</code>, then we need to show that <code class="highlighter-rouge">δ , v ⊢ # 0 ↓ v</code>,
which we have by rule <code class="highlighter-rouge">var</code>.</p>
  </li>
  <li>
    <p>If it is <code class="highlighter-rouge">S x′</code>,then we need to show that
<code class="highlighter-rouge">δ , v ⊢ rename S_ (σ x′) ↓ nth x′ γ</code>,
which we obtain by the <code class="highlighter-rouge">rename-pres</code> lemma.</p>
  </li>
</ul>

<p>With the extension lemma in hand, the proof that simultaneous
substitution preserves meaning is straightforward.  Let’s dive in!</p>

<pre class="Agda"><a id="subst-pres"></a><a id="4308" href="/Soundness/#4308" class="Function">subst-pres</a> <a id="4319" class="Symbol">:</a> <a id="4321" class="Symbol">∀</a> <a id="4323" class="Symbol">{</a><a id="4324" href="/Soundness/#4324" class="Bound">Γ</a> <a id="4326" href="/Soundness/#4326" class="Bound">Δ</a> <a id="4328" href="/Soundness/#4328" class="Bound">v</a><a id="4329" class="Symbol">}</a> <a id="4331" class="Symbol">{</a><a id="4332" href="/Soundness/#4332" class="Bound">γ</a> <a id="4334" class="Symbol">:</a> <a id="4336" href="/Denotational/#7233" class="Function">Env</a> <a id="4340" href="/Soundness/#4324" class="Bound">Γ</a><a id="4341" class="Symbol">}</a> <a id="4343" class="Symbol">{</a><a id="4344" href="/Soundness/#4344" class="Bound">δ</a> <a id="4346" class="Symbol">:</a> <a id="4348" href="/Denotational/#7233" class="Function">Env</a> <a id="4352" href="/Soundness/#4326" class="Bound">Δ</a><a id="4353" class="Symbol">}</a> <a id="4355" class="Symbol">{</a><a id="4356" href="/Soundness/#4356" class="Bound">M</a> <a id="4358" class="Symbol">:</a> <a id="4360" href="/Soundness/#4324" class="Bound">Γ</a> <a id="4362" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="4364" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="4365" class="Symbol">}</a>
  <a id="4369" class="Symbol">→</a> <a id="4371" class="Symbol">(</a><a id="4372" href="/Soundness/#4372" class="Bound">σ</a> <a id="4374" class="Symbol">:</a> <a id="4376" href="/Substitution/#2504" class="Function">Subst</a> <a id="4382" href="/Soundness/#4324" class="Bound">Γ</a> <a id="4384" href="/Soundness/#4326" class="Bound">Δ</a><a id="4385" class="Symbol">)</a>
  <a id="4389" class="Symbol">→</a> <a id="4391" href="/Soundness/#4344" class="Bound">δ</a> <a id="4393" href="/Soundness/#3272" class="Function Operator">`⊢</a> <a id="4396" href="/Soundness/#4372" class="Bound">σ</a> <a id="4398" href="/Soundness/#3272" class="Function Operator">↓</a> <a id="4400" href="/Soundness/#4332" class="Bound">γ</a>
  <a id="4404" class="Symbol">→</a> <a id="4406" href="/Soundness/#4332" class="Bound">γ</a> <a id="4408" href="/Denotational/#9519" class="Datatype Operator">⊢</a> <a id="4410" href="/Soundness/#4356" class="Bound">M</a> <a id="4412" href="/Denotational/#9519" class="Datatype Operator">↓</a> <a id="4414" href="/Soundness/#4328" class="Bound">v</a>
    <a id="4420" class="Comment">------------------</a>
  <a id="4441" class="Symbol">→</a> <a id="4443" href="/Soundness/#4344" class="Bound">δ</a> <a id="4445" href="/Denotational/#9519" class="Datatype Operator">⊢</a> <a id="4447" href="/Untyped/#6931" class="Function">subst</a> <a id="4453" href="/Soundness/#4372" class="Bound">σ</a> <a id="4455" href="/Soundness/#4356" class="Bound">M</a> <a id="4457" href="/Denotational/#9519" class="Datatype Operator">↓</a> <a id="4459" href="/Soundness/#4328" class="Bound">v</a>
<a id="4461" href="/Soundness/#4308" class="Function">subst-pres</a> <a id="4472" href="/Soundness/#4472" class="Bound">σ</a> <a id="4474" href="/Soundness/#4474" class="Bound">s</a> <a id="4476" class="Symbol">(</a><a id="4477" href="/Denotational/#9573" class="InductiveConstructor">var</a> <a id="4481" class="Symbol">{</a><a id="4482" class="Argument">x</a> <a id="4484" class="Symbol">=</a> <a id="4486" href="/Soundness/#4486" class="Bound">x</a><a id="4487" class="Symbol">})</a> <a id="4490" class="Symbol">=</a> <a id="4492" class="Symbol">(</a><a id="4493" href="/Soundness/#4474" class="Bound">s</a> <a id="4495" href="/Soundness/#4486" class="Bound">x</a><a id="4496" class="Symbol">)</a>
<a id="4498" href="/Soundness/#4308" class="Function">subst-pres</a> <a id="4509" href="/Soundness/#4509" class="Bound">σ</a> <a id="4511" href="/Soundness/#4511" class="Bound">s</a> <a id="4513" class="Symbol">(</a><a id="4514" href="/Denotational/#9652" class="InductiveConstructor">↦-elim</a> <a id="4521" href="/Soundness/#4521" class="Bound">d₁</a> <a id="4524" href="/Soundness/#4524" class="Bound">d₂</a><a id="4526" class="Symbol">)</a> <a id="4528" class="Symbol">=</a>
  <a id="4532" href="/Denotational/#9652" class="InductiveConstructor">↦-elim</a> <a id="4539" class="Symbol">(</a><a id="4540" href="/Soundness/#4308" class="Function">subst-pres</a> <a id="4551" href="/Soundness/#4509" class="Bound">σ</a> <a id="4553" href="/Soundness/#4511" class="Bound">s</a> <a id="4555" href="/Soundness/#4521" class="Bound">d₁</a><a id="4557" class="Symbol">)</a> <a id="4559" class="Symbol">(</a><a id="4560" href="/Soundness/#4308" class="Function">subst-pres</a> <a id="4571" href="/Soundness/#4509" class="Bound">σ</a> <a id="4573" href="/Soundness/#4511" class="Bound">s</a> <a id="4575" href="/Soundness/#4524" class="Bound">d₂</a><a id="4577" class="Symbol">)</a>
<a id="4579" href="/Soundness/#4308" class="Function">subst-pres</a> <a id="4590" href="/Soundness/#4590" class="Bound">σ</a> <a id="4592" href="/Soundness/#4592" class="Bound">s</a> <a id="4594" class="Symbol">(</a><a id="4595" href="/Denotational/#9790" class="InductiveConstructor">↦-intro</a> <a id="4603" href="/Soundness/#4603" class="Bound">d</a><a id="4604" class="Symbol">)</a> <a id="4606" class="Symbol">=</a>
  <a id="4610" href="/Denotational/#9790" class="InductiveConstructor">↦-intro</a> <a id="4618" class="Symbol">(</a><a id="4619" href="/Soundness/#4308" class="Function">subst-pres</a> <a id="4630" class="Symbol">(λ</a> <a id="4633" class="Symbol">{</a><a id="4634" href="/Soundness/#4634" class="Bound">A</a><a id="4635" class="Symbol">}</a> <a id="4637" class="Symbol">→</a> <a id="4639" href="/Untyped/#6623" class="Function">exts</a> <a id="4644" href="/Soundness/#4590" class="Bound">σ</a><a id="4645" class="Symbol">)</a> <a id="4647" class="Symbol">(</a><a id="4648" href="/Soundness/#3655" class="Function">subst-ext</a> <a id="4658" href="/Soundness/#4590" class="Bound">σ</a> <a id="4660" href="/Soundness/#4592" class="Bound">s</a><a id="4661" class="Symbol">)</a> <a id="4663" href="/Soundness/#4603" class="Bound">d</a><a id="4664" class="Symbol">)</a>
<a id="4666" href="/Soundness/#4308" class="Function">subst-pres</a> <a id="4677" href="/Soundness/#4677" class="Bound">σ</a> <a id="4679" href="/Soundness/#4679" class="Bound">s</a> <a id="4681" href="/Denotational/#9914" class="InductiveConstructor">⊥-intro</a> <a id="4689" class="Symbol">=</a> <a id="4691" href="/Denotational/#9914" class="InductiveConstructor">⊥-intro</a>
<a id="4699" href="/Soundness/#4308" class="Function">subst-pres</a> <a id="4710" href="/Soundness/#4710" class="Bound">σ</a> <a id="4712" href="/Soundness/#4712" class="Bound">s</a> <a id="4714" class="Symbol">(</a><a id="4715" href="/Denotational/#9989" class="InductiveConstructor">⊔-intro</a> <a id="4723" href="/Soundness/#4723" class="Bound">d₁</a> <a id="4726" href="/Soundness/#4726" class="Bound">d₂</a><a id="4728" class="Symbol">)</a> <a id="4730" class="Symbol">=</a>
  <a id="4734" href="/Denotational/#9989" class="InductiveConstructor">⊔-intro</a> <a id="4742" class="Symbol">(</a><a id="4743" href="/Soundness/#4308" class="Function">subst-pres</a> <a id="4754" href="/Soundness/#4710" class="Bound">σ</a> <a id="4756" href="/Soundness/#4712" class="Bound">s</a> <a id="4758" href="/Soundness/#4723" class="Bound">d₁</a><a id="4760" class="Symbol">)</a> <a id="4762" class="Symbol">(</a><a id="4763" href="/Soundness/#4308" class="Function">subst-pres</a> <a id="4774" href="/Soundness/#4710" class="Bound">σ</a> <a id="4776" href="/Soundness/#4712" class="Bound">s</a> <a id="4778" href="/Soundness/#4726" class="Bound">d₂</a><a id="4780" class="Symbol">)</a>
<a id="4782" href="/Soundness/#4308" class="Function">subst-pres</a> <a id="4793" href="/Soundness/#4793" class="Bound">σ</a> <a id="4795" href="/Soundness/#4795" class="Bound">s</a> <a id="4797" class="Symbol">(</a><a id="4798" href="/Denotational/#10120" class="InductiveConstructor">sub</a> <a id="4802" href="/Soundness/#4802" class="Bound">d</a> <a id="4804" href="/Soundness/#4804" class="Bound">lt</a><a id="4806" class="Symbol">)</a> <a id="4808" class="Symbol">=</a> <a id="4810" href="/Denotational/#10120" class="InductiveConstructor">sub</a> <a id="4814" class="Symbol">(</a><a id="4815" href="/Soundness/#4308" class="Function">subst-pres</a> <a id="4826" href="/Soundness/#4793" class="Bound">σ</a> <a id="4828" href="/Soundness/#4795" class="Bound">s</a> <a id="4830" href="/Soundness/#4802" class="Bound">d</a><a id="4831" class="Symbol">)</a> <a id="4833" href="/Soundness/#4804" class="Bound">lt</a></pre>

<p>The proof is by induction on the semantics of <code class="highlighter-rouge">M</code>.  The two interesting
cases are for variables and lambda abstractions.</p>

<ul>
  <li>
    <p>For a variable <code class="highlighter-rouge">x</code>, we have that <code class="highlighter-rouge">v ⊑ nth x γ</code> and we need to show that
<code class="highlighter-rouge">δ ⊢ σ x ↓ v</code>.  From the premise applied to <code class="highlighter-rouge">x</code>, we have that
<code class="highlighter-rouge">δ ⊢ σ x ↓ nth x γ</code>, so we conclude by the <code class="highlighter-rouge">sub</code> rule.</p>
  </li>
  <li>
    <p>For a lambda abstraction, we must extend the substitution
for the induction hypothesis. We apply the <code class="highlighter-rouge">subst-ext</code> lemma
to show that the extended substitution maps variables to
terms that result in the appropriate values.</p>
  </li>
</ul>

<h3 id="single-substitution-preserves-denotations">Single substitution preserves denotations</h3>

<p>For β reduction, <code class="highlighter-rouge">(ƛ N) · M —→ N [ M ]</code>, we need to show that the
semantics is preserved when substituting <code class="highlighter-rouge">M</code> for de Bruijn index 0 in
term <code class="highlighter-rouge">N</code>. By inversion on the rules <code class="highlighter-rouge">↦-elim</code> and <code class="highlighter-rouge">↦-intro</code>,
we have that <code class="highlighter-rouge">γ , v ⊢ M ↓ w</code> and <code class="highlighter-rouge">γ ⊢ N ↓ v</code>.
So we need to show that <code class="highlighter-rouge">γ ⊢ M [ N ] ↓ w</code>, or equivalently,
that <code class="highlighter-rouge">γ ⊢ subst (subst-zero N) M ↓ w</code>.</p>

<pre class="Agda"><a id="substitution"></a><a id="5799" href="/Soundness/#5799" class="Function">substitution</a> <a id="5812" class="Symbol">:</a> <a id="5814" class="Symbol">∀</a> <a id="5816" class="Symbol">{</a><a id="5817" href="/Soundness/#5817" class="Bound">Γ</a><a id="5818" class="Symbol">}</a> <a id="5820" class="Symbol">{</a><a id="5821" href="/Soundness/#5821" class="Bound">γ</a> <a id="5823" class="Symbol">:</a> <a id="5825" href="/Denotational/#7233" class="Function">Env</a> <a id="5829" href="/Soundness/#5817" class="Bound">Γ</a><a id="5830" class="Symbol">}</a> <a id="5832" class="Symbol">{</a><a id="5833" href="/Soundness/#5833" class="Bound">N</a> <a id="5835" href="/Soundness/#5835" class="Bound">M</a> <a id="5837" href="/Soundness/#5837" class="Bound">v</a> <a id="5839" href="/Soundness/#5839" class="Bound">w</a><a id="5840" class="Symbol">}</a>
   <a id="5845" class="Symbol">→</a> <a id="5847" href="/Soundness/#5821" class="Bound">γ</a> <a id="5849" href="/Denotational/#7406" class="Function Operator">`,</a> <a id="5852" href="/Soundness/#5837" class="Bound">v</a> <a id="5854" href="/Denotational/#9519" class="Datatype Operator">⊢</a> <a id="5856" href="/Soundness/#5833" class="Bound">N</a> <a id="5858" href="/Denotational/#9519" class="Datatype Operator">↓</a> <a id="5860" href="/Soundness/#5839" class="Bound">w</a>
   <a id="5865" class="Symbol">→</a> <a id="5867" href="/Soundness/#5821" class="Bound">γ</a> <a id="5869" href="/Denotational/#9519" class="Datatype Operator">⊢</a> <a id="5871" href="/Soundness/#5835" class="Bound">M</a> <a id="5873" href="/Denotational/#9519" class="Datatype Operator">↓</a> <a id="5875" href="/Soundness/#5837" class="Bound">v</a>
     <a id="5882" class="Comment">---------------</a>
   <a id="5901" class="Symbol">→</a> <a id="5903" href="/Soundness/#5821" class="Bound">γ</a> <a id="5905" href="/Denotational/#9519" class="Datatype Operator">⊢</a> <a id="5907" href="/Soundness/#5833" class="Bound">N</a> <a id="5909" href="/Untyped/#7475" class="Function Operator">[</a> <a id="5911" href="/Soundness/#5835" class="Bound">M</a> <a id="5913" href="/Untyped/#7475" class="Function Operator">]</a> <a id="5915" href="/Denotational/#9519" class="Datatype Operator">↓</a> <a id="5917" href="/Soundness/#5839" class="Bound">w</a>
<a id="5919" href="/Soundness/#5799" class="Function">substitution</a><a id="5931" class="Symbol">{</a><a id="5932" href="/Soundness/#5932" class="Bound">Γ</a><a id="5933" class="Symbol">}{</a><a id="5935" href="/Soundness/#5935" class="Bound">γ</a><a id="5936" class="Symbol">}{</a><a id="5938" href="/Soundness/#5938" class="Bound">N</a><a id="5939" class="Symbol">}{</a><a id="5941" href="/Soundness/#5941" class="Bound">M</a><a id="5942" class="Symbol">}{</a><a id="5944" href="/Soundness/#5944" class="Bound">v</a><a id="5945" class="Symbol">}{</a><a id="5947" href="/Soundness/#5947" class="Bound">w</a><a id="5948" class="Symbol">}</a> <a id="5950" href="/Soundness/#5950" class="Bound">dn</a> <a id="5953" href="/Soundness/#5953" class="Bound">dm</a> <a id="5956" class="Symbol">=</a>
  <a id="5960" href="/Soundness/#4308" class="Function">subst-pres</a> <a id="5971" class="Symbol">(</a><a id="5972" href="/Untyped/#7359" class="Function">subst-zero</a> <a id="5983" href="/Soundness/#5941" class="Bound">M</a><a id="5984" class="Symbol">)</a> <a id="5986" href="/Soundness/#6008" class="Function">sub-z-ok</a> <a id="5995" href="/Soundness/#5950" class="Bound">dn</a>
  <a id="6000" class="Keyword">where</a>
  <a id="6008" href="/Soundness/#6008" class="Function">sub-z-ok</a> <a id="6017" class="Symbol">:</a> <a id="6019" href="/Soundness/#5935" class="Bound">γ</a> <a id="6021" href="/Soundness/#3272" class="Function Operator">`⊢</a> <a id="6024" href="/Untyped/#7359" class="Function">subst-zero</a> <a id="6035" href="/Soundness/#5941" class="Bound">M</a> <a id="6037" href="/Soundness/#3272" class="Function Operator">↓</a> <a id="6039" class="Symbol">(</a><a id="6040" href="/Soundness/#5935" class="Bound">γ</a> <a id="6042" href="/Denotational/#7406" class="Function Operator">`,</a> <a id="6045" href="/Soundness/#5944" class="Bound">v</a><a id="6046" class="Symbol">)</a>
  <a id="6050" href="/Soundness/#6008" class="Function">sub-z-ok</a> <a id="6059" href="/Untyped/#3401" class="InductiveConstructor">Z</a> <a id="6061" class="Symbol">=</a> <a id="6063" href="/Soundness/#5953" class="Bound">dm</a>
  <a id="6068" href="/Soundness/#6008" class="Function">sub-z-ok</a> <a id="6077" class="Symbol">(</a><a id="6078" href="/Untyped/#3446" class="InductiveConstructor Operator">S</a> <a id="6080" href="/Soundness/#6080" class="Bound">x</a><a id="6081" class="Symbol">)</a> <a id="6083" class="Symbol">=</a> <a id="6085" href="/Denotational/#9573" class="InductiveConstructor">var</a></pre>

<p>This result is a corollary of the lemma for simultaneous substitution.
To use the lemma, we just need to show that <code class="highlighter-rouge">subst-zero M</code> maps
variables to terms that produces the same values as those in <code class="highlighter-rouge">γ , v</code>.
Let <code class="highlighter-rouge">y</code> be an arbitrary variable (de Bruijn index).</p>

<ul>
  <li>
    <p>If it is <code class="highlighter-rouge">Z</code>, then <code class="highlighter-rouge">(subst-zero M) y = M</code> and <code class="highlighter-rouge">nth y (γ , v) = v</code>.
By the premise we conclude that <code class="highlighter-rouge">γ ⊢ M ↓ v</code>.</p>
  </li>
  <li>
    <p>If it is <code class="highlighter-rouge">S x</code>, then <code class="highlighter-rouge">(subst-zero M) (S x) = x</code> and
<code class="highlighter-rouge">nth (S x) (γ , v) = nth x γ</code>.  So we conclude that
<code class="highlighter-rouge">γ ⊢ x ↓ nth x γ</code> by rule <code class="highlighter-rouge">var</code>.</p>
  </li>
</ul>

<h3 id="reduction-preserves-denotations">Reduction preserves denotations</h3>

<p>With the substitution lemma in hand, it is straightforward to prove
that reduction preserves denotations.</p>

<pre class="Agda"><a id="preserve"></a><a id="6778" href="/Soundness/#6778" class="Function">preserve</a> <a id="6787" class="Symbol">:</a> <a id="6789" class="Symbol">∀</a> <a id="6791" class="Symbol">{</a><a id="6792" href="/Soundness/#6792" class="Bound">Γ</a><a id="6793" class="Symbol">}</a> <a id="6795" class="Symbol">{</a><a id="6796" href="/Soundness/#6796" class="Bound">γ</a> <a id="6798" class="Symbol">:</a> <a id="6800" href="/Denotational/#7233" class="Function">Env</a> <a id="6804" href="/Soundness/#6792" class="Bound">Γ</a><a id="6805" class="Symbol">}</a> <a id="6807" class="Symbol">{</a><a id="6808" href="/Soundness/#6808" class="Bound">M</a> <a id="6810" href="/Soundness/#6810" class="Bound">N</a> <a id="6812" href="/Soundness/#6812" class="Bound">v</a><a id="6813" class="Symbol">}</a>
  <a id="6817" class="Symbol">→</a> <a id="6819" href="/Soundness/#6796" class="Bound">γ</a> <a id="6821" href="/Denotational/#9519" class="Datatype Operator">⊢</a> <a id="6823" href="/Soundness/#6808" class="Bound">M</a> <a id="6825" href="/Denotational/#9519" class="Datatype Operator">↓</a> <a id="6827" href="/Soundness/#6812" class="Bound">v</a>
  <a id="6831" class="Symbol">→</a> <a id="6833" href="/Soundness/#6808" class="Bound">M</a> <a id="6835" href="/LambdaReduction/#386" class="Datatype Operator">—→</a> <a id="6838" href="/Soundness/#6810" class="Bound">N</a>
    <a id="6844" class="Comment">----------</a>
  <a id="6857" class="Symbol">→</a> <a id="6859" href="/Soundness/#6796" class="Bound">γ</a> <a id="6861" href="/Denotational/#9519" class="Datatype Operator">⊢</a> <a id="6863" href="/Soundness/#6810" class="Bound">N</a> <a id="6865" href="/Denotational/#9519" class="Datatype Operator">↓</a> <a id="6867" href="/Soundness/#6812" class="Bound">v</a>
<a id="6869" href="/Soundness/#6778" class="Function">preserve</a> <a id="6878" class="Symbol">(</a><a id="6879" href="/Denotational/#9573" class="InductiveConstructor">var</a><a id="6882" class="Symbol">)</a> <a id="6884" class="Symbol">()</a>
<a id="6887" href="/Soundness/#6778" class="Function">preserve</a> <a id="6896" class="Symbol">(</a><a id="6897" href="/Denotational/#9652" class="InductiveConstructor">↦-elim</a> <a id="6904" href="/Soundness/#6904" class="Bound">d₁</a> <a id="6907" href="/Soundness/#6907" class="Bound">d₂</a><a id="6909" class="Symbol">)</a> <a id="6911" class="Symbol">(</a><a id="6912" href="/LambdaReduction/#436" class="InductiveConstructor">ξ₁</a> <a id="6915" href="/Soundness/#6915" class="Bound">r</a><a id="6916" class="Symbol">)</a> <a id="6918" class="Symbol">=</a> <a id="6920" href="/Denotational/#9652" class="InductiveConstructor">↦-elim</a> <a id="6927" class="Symbol">(</a><a id="6928" href="/Soundness/#6778" class="Function">preserve</a> <a id="6937" href="/Soundness/#6904" class="Bound">d₁</a> <a id="6940" href="/Soundness/#6915" class="Bound">r</a><a id="6941" class="Symbol">)</a> <a id="6943" href="/Soundness/#6907" class="Bound">d₂</a>
<a id="6946" href="/Soundness/#6778" class="Function">preserve</a> <a id="6955" class="Symbol">(</a><a id="6956" href="/Denotational/#9652" class="InductiveConstructor">↦-elim</a> <a id="6963" href="/Soundness/#6963" class="Bound">d₁</a> <a id="6966" href="/Soundness/#6966" class="Bound">d₂</a><a id="6968" class="Symbol">)</a> <a id="6970" class="Symbol">(</a><a id="6971" href="/LambdaReduction/#526" class="InductiveConstructor">ξ₂</a> <a id="6974" href="/Soundness/#6974" class="Bound">r</a><a id="6975" class="Symbol">)</a> <a id="6977" class="Symbol">=</a> <a id="6979" href="/Denotational/#9652" class="InductiveConstructor">↦-elim</a> <a id="6986" href="/Soundness/#6963" class="Bound">d₁</a> <a id="6989" class="Symbol">(</a><a id="6990" href="/Soundness/#6778" class="Function">preserve</a> <a id="6999" href="/Soundness/#6966" class="Bound">d₂</a> <a id="7002" href="/Soundness/#6974" class="Bound">r</a><a id="7003" class="Symbol">)</a>
<a id="7005" href="/Soundness/#6778" class="Function">preserve</a> <a id="7014" class="Symbol">(</a><a id="7015" href="/Denotational/#9652" class="InductiveConstructor">↦-elim</a> <a id="7022" href="/Soundness/#7022" class="Bound">d₁</a> <a id="7025" href="/Soundness/#7025" class="Bound">d₂</a><a id="7027" class="Symbol">)</a> <a id="7029" href="/LambdaReduction/#616" class="InductiveConstructor">β</a> <a id="7031" class="Symbol">=</a> <a id="7033" href="/Soundness/#5799" class="Function">substitution</a> <a id="7046" class="Symbol">(</a><a id="7047" href="/Compositional/#3655" class="Function">lambda-inversion</a> <a id="7064" href="/Soundness/#7022" class="Bound">d₁</a><a id="7066" class="Symbol">)</a> <a id="7068" href="/Soundness/#7025" class="Bound">d₂</a>
<a id="7071" href="/Soundness/#6778" class="Function">preserve</a> <a id="7080" class="Symbol">(</a><a id="7081" href="/Denotational/#9790" class="InductiveConstructor">↦-intro</a> <a id="7089" href="/Soundness/#7089" class="Bound">d</a><a id="7090" class="Symbol">)</a> <a id="7092" class="Symbol">(</a><a id="7093" href="/LambdaReduction/#724" class="InductiveConstructor">ζ</a> <a id="7095" href="/Soundness/#7095" class="Bound">r</a><a id="7096" class="Symbol">)</a> <a id="7098" class="Symbol">=</a> <a id="7100" href="/Denotational/#9790" class="InductiveConstructor">↦-intro</a> <a id="7108" class="Symbol">(</a><a id="7109" href="/Soundness/#6778" class="Function">preserve</a> <a id="7118" href="/Soundness/#7089" class="Bound">d</a> <a id="7120" href="/Soundness/#7095" class="Bound">r</a><a id="7121" class="Symbol">)</a>
<a id="7123" href="/Soundness/#6778" class="Function">preserve</a> <a id="7132" href="/Denotational/#9914" class="InductiveConstructor">⊥-intro</a> <a id="7140" href="/Soundness/#7140" class="Bound">r</a> <a id="7142" class="Symbol">=</a> <a id="7144" href="/Denotational/#9914" class="InductiveConstructor">⊥-intro</a>
<a id="7152" href="/Soundness/#6778" class="Function">preserve</a> <a id="7161" class="Symbol">(</a><a id="7162" href="/Denotational/#9989" class="InductiveConstructor">⊔-intro</a> <a id="7170" href="/Soundness/#7170" class="Bound">d</a> <a id="7172" href="/Soundness/#7172" class="Bound">d₁</a><a id="7174" class="Symbol">)</a> <a id="7176" href="/Soundness/#7176" class="Bound">r</a> <a id="7178" class="Symbol">=</a> <a id="7180" href="/Denotational/#9989" class="InductiveConstructor">⊔-intro</a> <a id="7188" class="Symbol">(</a><a id="7189" href="/Soundness/#6778" class="Function">preserve</a> <a id="7198" href="/Soundness/#7170" class="Bound">d</a> <a id="7200" href="/Soundness/#7176" class="Bound">r</a><a id="7201" class="Symbol">)</a> <a id="7203" class="Symbol">(</a><a id="7204" href="/Soundness/#6778" class="Function">preserve</a> <a id="7213" href="/Soundness/#7172" class="Bound">d₁</a> <a id="7216" href="/Soundness/#7176" class="Bound">r</a><a id="7217" class="Symbol">)</a>
<a id="7219" href="/Soundness/#6778" class="Function">preserve</a> <a id="7228" class="Symbol">(</a><a id="7229" href="/Denotational/#10120" class="InductiveConstructor">sub</a> <a id="7233" href="/Soundness/#7233" class="Bound">d</a> <a id="7235" href="/Soundness/#7235" class="Bound">lt</a><a id="7237" class="Symbol">)</a> <a id="7239" href="/Soundness/#7239" class="Bound">r</a> <a id="7241" class="Symbol">=</a> <a id="7243" href="/Denotational/#10120" class="InductiveConstructor">sub</a> <a id="7247" class="Symbol">(</a><a id="7248" href="/Soundness/#6778" class="Function">preserve</a> <a id="7257" href="/Soundness/#7233" class="Bound">d</a> <a id="7259" href="/Soundness/#7239" class="Bound">r</a><a id="7260" class="Symbol">)</a> <a id="7262" href="/Soundness/#7235" class="Bound">lt</a></pre>

<p>We proceed by induction on the semantics of <code class="highlighter-rouge">M</code> with case analysis on
the reduction.</p>

<ul>
  <li>
    <p>If <code class="highlighter-rouge">M</code> is a variable, then there is no such reduction.</p>
  </li>
  <li>
    <p>If <code class="highlighter-rouge">M</code> is an application, then the reduction is either a congruence
(ξ₁ or ξ₂) or β. For each congruence, we use the induction
hypothesis. For β reduction we use the substitution lemma and the
<code class="highlighter-rouge">sub</code> rule.</p>
  </li>
  <li>
    <p>The rest of the cases are straightforward.</p>
  </li>
</ul>

<h2 id="reduction-reflects-denotations">Reduction reflects denotations</h2>

<p>This section proves that reduction reflects the denotation of a
term. That is, if <code class="highlighter-rouge">N</code> results in <code class="highlighter-rouge">v</code>, and if <code class="highlighter-rouge">M</code> reduces to <code class="highlighter-rouge">N</code>, then
<code class="highlighter-rouge">M</code> also results in <code class="highlighter-rouge">v</code>. While there are some broad similarities
between this proof and the above proof of semantic preservation, we
shall require a few more technical lemmas to obtain this result.</p>

<p>The main challenge is dealing with the substitution in β reduction:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(ƛ N) · M —→ N [ M ]
</code></pre></div></div>

<p>We have that <code class="highlighter-rouge">γ ⊢ N [ M ] ↓ v</code> and need to show that
<code class="highlighter-rouge">γ ⊢ (ƛ N) · M ↓ v</code>. Now consider the derivation of <code class="highlighter-rouge">γ ⊢ N [ M ] ↓ v</code>.
The term <code class="highlighter-rouge">M</code> may occur 0, 1, or many times inside <code class="highlighter-rouge">N [ M ]</code>. At each of
those occurences, <code class="highlighter-rouge">M</code> may result in a different value. But to build a
derivation for <code class="highlighter-rouge">(ƛ N) · M</code>, we need a single value for <code class="highlighter-rouge">M</code>.  If <code class="highlighter-rouge">M</code>
occured more than 1 time, then we can join all of the different values
using <code class="highlighter-rouge">⊔</code>. If <code class="highlighter-rouge">M</code> occured 0 times, then we do not need any information
about <code class="highlighter-rouge">M</code> and can therefore use <code class="highlighter-rouge">⊥</code> for the value of <code class="highlighter-rouge">M</code>.</p>

<h3 id="renaming-reflects-meaning">Renaming reflects meaning</h3>

<p>Previously we showed that renaming variables preserves meaning.  Now
we prove the opposite, that it reflects meaning. That is,
if <code class="highlighter-rouge">δ ⊢ rename ρ M ↓ v</code>, then <code class="highlighter-rouge">γ ⊢ M ↓ v</code>, where <code class="highlighter-rouge">(δ ∘ ρ) </code>⊑ γ`.</p>

<p>First, we need a variant of a lemma given earlier.</p>
<pre class="Agda"><a id="nth-ext"></a><a id="8968" href="/Soundness/#8968" class="Function">nth-ext</a> <a id="8976" class="Symbol">:</a> <a id="8978" class="Symbol">∀</a> <a id="8980" class="Symbol">{</a><a id="8981" href="/Soundness/#8981" class="Bound">Γ</a> <a id="8983" href="/Soundness/#8983" class="Bound">Δ</a> <a id="8985" href="/Soundness/#8985" class="Bound">v</a><a id="8986" class="Symbol">}</a> <a id="8988" class="Symbol">{</a><a id="8989" href="/Soundness/#8989" class="Bound">γ</a> <a id="8991" class="Symbol">:</a> <a id="8993" href="/Denotational/#7233" class="Function">Env</a> <a id="8997" href="/Soundness/#8981" class="Bound">Γ</a><a id="8998" class="Symbol">}</a> <a id="9000" class="Symbol">{</a><a id="9001" href="/Soundness/#9001" class="Bound">δ</a> <a id="9003" class="Symbol">:</a> <a id="9005" href="/Denotational/#7233" class="Function">Env</a> <a id="9009" href="/Soundness/#8983" class="Bound">Δ</a><a id="9010" class="Symbol">}</a>
  <a id="9014" class="Symbol">→</a> <a id="9016" class="Symbol">(</a><a id="9017" href="/Soundness/#9017" class="Bound">ρ</a> <a id="9019" class="Symbol">:</a> <a id="9021" href="/Substitution/#2275" class="Function">Rename</a> <a id="9028" href="/Soundness/#8981" class="Bound">Γ</a> <a id="9030" href="/Soundness/#8983" class="Bound">Δ</a><a id="9031" class="Symbol">)</a>
  <a id="9035" class="Symbol">→</a> <a id="9037" class="Symbol">(</a><a id="9038" href="/Soundness/#9001" class="Bound">δ</a> <a id="9040" href="https://agda.github.io/agda-stdlib/v0.17/Function.html#769" class="Function Operator">∘</a> <a id="9042" href="/Soundness/#9017" class="Bound">ρ</a><a id="9043" class="Symbol">)</a> <a id="9045" href="/Denotational/#8259" class="Function Operator">`⊑</a> <a id="9048" href="/Soundness/#8989" class="Bound">γ</a>
    <a id="9054" class="Comment">------------------------------</a>
  <a id="9087" class="Symbol">→</a> <a id="9089" class="Symbol">((</a><a id="9091" href="/Soundness/#9001" class="Bound">δ</a> <a id="9093" href="/Denotational/#7406" class="Function Operator">`,</a> <a id="9096" href="/Soundness/#8985" class="Bound">v</a><a id="9097" class="Symbol">)</a> <a id="9099" href="https://agda.github.io/agda-stdlib/v0.17/Function.html#769" class="Function Operator">∘</a> <a id="9101" href="/Untyped/#5845" class="Function">ext</a> <a id="9105" href="/Soundness/#9017" class="Bound">ρ</a><a id="9106" class="Symbol">)</a> <a id="9108" href="/Denotational/#8259" class="Function Operator">`⊑</a> <a id="9111" class="Symbol">(</a><a id="9112" href="/Soundness/#8989" class="Bound">γ</a> <a id="9114" href="/Denotational/#7406" class="Function Operator">`,</a> <a id="9117" href="/Soundness/#8985" class="Bound">v</a><a id="9118" class="Symbol">)</a>
<a id="9120" href="/Soundness/#8968" class="Function">nth-ext</a> <a id="9128" href="/Soundness/#9128" class="Bound">ρ</a> <a id="9130" href="/Soundness/#9130" class="Bound">lt</a> <a id="9133" href="/Untyped/#3401" class="InductiveConstructor">Z</a> <a id="9135" class="Symbol">=</a> <a id="9137" href="/Denotational/#5540" class="Function">Refl⊑</a>
<a id="9143" href="/Soundness/#8968" class="Function">nth-ext</a> <a id="9151" href="/Soundness/#9151" class="Bound">ρ</a> <a id="9153" href="/Soundness/#9153" class="Bound">lt</a> <a id="9156" class="Symbol">(</a><a id="9157" href="/Untyped/#3446" class="InductiveConstructor Operator">S</a> <a id="9159" href="/Soundness/#9159" class="Bound">x</a><a id="9160" class="Symbol">)</a> <a id="9162" class="Symbol">=</a> <a id="9164" href="/Soundness/#9153" class="Bound">lt</a> <a id="9167" href="/Soundness/#9159" class="Bound">x</a></pre>

<p>The proof is then as follows.</p>
<pre class="Agda"><a id="rename-reflect"></a><a id="9224" href="/Soundness/#9224" class="Function">rename-reflect</a> <a id="9239" class="Symbol">:</a> <a id="9241" class="Symbol">∀</a> <a id="9243" class="Symbol">{</a><a id="9244" href="/Soundness/#9244" class="Bound">Γ</a> <a id="9246" href="/Soundness/#9246" class="Bound">Δ</a> <a id="9248" href="/Soundness/#9248" class="Bound">v</a><a id="9249" class="Symbol">}</a> <a id="9251" class="Symbol">{</a><a id="9252" href="/Soundness/#9252" class="Bound">γ</a> <a id="9254" class="Symbol">:</a> <a id="9256" href="/Denotational/#7233" class="Function">Env</a> <a id="9260" href="/Soundness/#9244" class="Bound">Γ</a><a id="9261" class="Symbol">}</a> <a id="9263" class="Symbol">{</a><a id="9264" href="/Soundness/#9264" class="Bound">δ</a> <a id="9266" class="Symbol">:</a> <a id="9268" href="/Denotational/#7233" class="Function">Env</a> <a id="9272" href="/Soundness/#9246" class="Bound">Δ</a><a id="9273" class="Symbol">}</a> <a id="9275" class="Symbol">{</a> <a id="9277" href="/Soundness/#9277" class="Bound">M</a> <a id="9279" class="Symbol">:</a> <a id="9281" href="/Soundness/#9244" class="Bound">Γ</a> <a id="9283" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="9285" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="9286" class="Symbol">}</a>
  <a id="9290" class="Symbol">→</a> <a id="9292" class="Symbol">{</a><a id="9293" href="/Soundness/#9293" class="Bound">ρ</a> <a id="9295" class="Symbol">:</a> <a id="9297" href="/Substitution/#2275" class="Function">Rename</a> <a id="9304" href="/Soundness/#9244" class="Bound">Γ</a> <a id="9306" href="/Soundness/#9246" class="Bound">Δ</a><a id="9307" class="Symbol">}</a>
  <a id="9311" class="Symbol">→</a> <a id="9313" class="Symbol">(</a><a id="9314" href="/Soundness/#9264" class="Bound">δ</a> <a id="9316" href="https://agda.github.io/agda-stdlib/v0.17/Function.html#769" class="Function Operator">∘</a> <a id="9318" href="/Soundness/#9293" class="Bound">ρ</a><a id="9319" class="Symbol">)</a> <a id="9321" href="/Denotational/#8259" class="Function Operator">`⊑</a> <a id="9324" href="/Soundness/#9252" class="Bound">γ</a>
  <a id="9328" class="Symbol">→</a> <a id="9330" href="/Soundness/#9264" class="Bound">δ</a> <a id="9332" href="/Denotational/#9519" class="Datatype Operator">⊢</a> <a id="9334" href="/Untyped/#6171" class="Function">rename</a> <a id="9341" href="/Soundness/#9293" class="Bound">ρ</a> <a id="9343" href="/Soundness/#9277" class="Bound">M</a> <a id="9345" href="/Denotational/#9519" class="Datatype Operator">↓</a> <a id="9347" href="/Soundness/#9248" class="Bound">v</a>
    <a id="9353" class="Comment">------------------------------------</a>
  <a id="9392" class="Symbol">→</a> <a id="9394" href="/Soundness/#9252" class="Bound">γ</a> <a id="9396" href="/Denotational/#9519" class="Datatype Operator">⊢</a> <a id="9398" href="/Soundness/#9277" class="Bound">M</a> <a id="9400" href="/Denotational/#9519" class="Datatype Operator">↓</a> <a id="9402" href="/Soundness/#9248" class="Bound">v</a>
<a id="9404" href="/Soundness/#9224" class="Function">rename-reflect</a> <a id="9419" class="Symbol">{</a><a id="9420" class="Argument">M</a> <a id="9422" class="Symbol">=</a> <a id="9424" href="/Untyped/#4186" class="InductiveConstructor Operator">`</a> <a id="9426" href="/Soundness/#9426" class="Bound">x</a><a id="9427" class="Symbol">}</a> <a id="9429" href="/Soundness/#9429" class="Bound">all-n</a> <a id="9435" href="/Soundness/#9435" class="Bound">d</a> <a id="9437" class="Keyword">with</a> <a id="9442" href="/Compositional/#9866" class="Function">var-inv</a> <a id="9450" href="/Soundness/#9435" class="Bound">d</a>
<a id="9452" class="Symbol">...</a> <a id="9456" class="Symbol">|</a> <a id="9458" href="/Soundness/#9458" class="Bound">lt</a> <a id="9461" class="Symbol">=</a>  <a id="9464" href="/Denotational/#10120" class="InductiveConstructor">sub</a> <a id="9468" href="/Denotational/#9573" class="InductiveConstructor">var</a> <a id="9472" class="Symbol">(</a><a id="9473" href="/Denotational/#4667" class="InductiveConstructor">Trans⊑</a> <a id="9480" href="/Soundness/#9458" class="Bound">lt</a> <a id="9483" class="Symbol">(</a><a id="9484" class="Bound">all-n</a> <a id="9490" class="Bound">x</a><a id="9491" class="Symbol">))</a>
<a id="9494" href="/Soundness/#9224" class="Function">rename-reflect</a> <a id="9509" class="Symbol">{</a><a id="9510" class="Argument">M</a> <a id="9512" class="Symbol">=</a> <a id="9514" href="/Untyped/#4238" class="InductiveConstructor Operator">ƛ</a> <a id="9516" href="/Soundness/#9516" class="Bound">N</a><a id="9517" class="Symbol">}{</a><a id="9519" class="Argument">ρ</a> <a id="9521" class="Symbol">=</a> <a id="9523" href="/Soundness/#9523" class="Bound">ρ</a><a id="9524" class="Symbol">}</a> <a id="9526" href="/Soundness/#9526" class="Bound">all-n</a> <a id="9532" class="Symbol">(</a><a id="9533" href="/Denotational/#9790" class="InductiveConstructor">↦-intro</a> <a id="9541" href="/Soundness/#9541" class="Bound">d</a><a id="9542" class="Symbol">)</a> <a id="9544" class="Symbol">=</a>
   <a id="9549" href="/Denotational/#9790" class="InductiveConstructor">↦-intro</a> <a id="9557" class="Symbol">(</a><a id="9558" href="/Soundness/#9224" class="Function">rename-reflect</a> <a id="9573" class="Symbol">(</a><a id="9574" href="/Soundness/#8968" class="Function">nth-ext</a> <a id="9582" href="/Soundness/#9523" class="Bound">ρ</a> <a id="9584" href="/Soundness/#9526" class="Bound">all-n</a><a id="9589" class="Symbol">)</a> <a id="9591" href="/Soundness/#9541" class="Bound">d</a><a id="9592" class="Symbol">)</a>
<a id="9594" href="/Soundness/#9224" class="Function">rename-reflect</a> <a id="9609" class="Symbol">{</a><a id="9610" class="Argument">M</a> <a id="9612" class="Symbol">=</a> <a id="9614" href="/Untyped/#4238" class="InductiveConstructor Operator">ƛ</a> <a id="9616" href="/Soundness/#9616" class="Bound">N</a><a id="9617" class="Symbol">}</a> <a id="9619" href="/Soundness/#9619" class="Bound">all-n</a> <a id="9625" href="/Denotational/#9914" class="InductiveConstructor">⊥-intro</a> <a id="9633" class="Symbol">=</a> <a id="9635" href="/Denotational/#9914" class="InductiveConstructor">⊥-intro</a>
<a id="9643" href="/Soundness/#9224" class="Function">rename-reflect</a> <a id="9658" class="Symbol">{</a><a id="9659" class="Argument">M</a> <a id="9661" class="Symbol">=</a> <a id="9663" href="/Untyped/#4238" class="InductiveConstructor Operator">ƛ</a> <a id="9665" href="/Soundness/#9665" class="Bound">N</a><a id="9666" class="Symbol">}</a> <a id="9668" href="/Soundness/#9668" class="Bound">all-n</a> <a id="9674" class="Symbol">(</a><a id="9675" href="/Denotational/#9989" class="InductiveConstructor">⊔-intro</a> <a id="9683" href="/Soundness/#9683" class="Bound">d₁</a> <a id="9686" href="/Soundness/#9686" class="Bound">d₂</a><a id="9688" class="Symbol">)</a> <a id="9690" class="Symbol">=</a>
   <a id="9695" href="/Denotational/#9989" class="InductiveConstructor">⊔-intro</a> <a id="9703" class="Symbol">(</a><a id="9704" href="/Soundness/#9224" class="Function">rename-reflect</a> <a id="9719" href="/Soundness/#9668" class="Bound">all-n</a> <a id="9725" href="/Soundness/#9683" class="Bound">d₁</a><a id="9727" class="Symbol">)</a> <a id="9729" class="Symbol">(</a><a id="9730" href="/Soundness/#9224" class="Function">rename-reflect</a> <a id="9745" href="/Soundness/#9668" class="Bound">all-n</a> <a id="9751" href="/Soundness/#9686" class="Bound">d₂</a><a id="9753" class="Symbol">)</a>
<a id="9755" href="/Soundness/#9224" class="Function">rename-reflect</a> <a id="9770" class="Symbol">{</a><a id="9771" class="Argument">M</a> <a id="9773" class="Symbol">=</a> <a id="9775" href="/Untyped/#4238" class="InductiveConstructor Operator">ƛ</a> <a id="9777" href="/Soundness/#9777" class="Bound">N</a><a id="9778" class="Symbol">}</a> <a id="9780" href="/Soundness/#9780" class="Bound">all-n</a> <a id="9786" class="Symbol">(</a><a id="9787" href="/Denotational/#10120" class="InductiveConstructor">sub</a> <a id="9791" href="/Soundness/#9791" class="Bound">d₁</a> <a id="9794" href="/Soundness/#9794" class="Bound">lt</a><a id="9796" class="Symbol">)</a> <a id="9798" class="Symbol">=</a>
   <a id="9803" href="/Denotational/#10120" class="InductiveConstructor">sub</a> <a id="9807" class="Symbol">(</a><a id="9808" href="/Soundness/#9224" class="Function">rename-reflect</a> <a id="9823" href="/Soundness/#9780" class="Bound">all-n</a> <a id="9829" href="/Soundness/#9791" class="Bound">d₁</a><a id="9831" class="Symbol">)</a> <a id="9833" href="/Soundness/#9794" class="Bound">lt</a>
<a id="9836" href="/Soundness/#9224" class="Function">rename-reflect</a> <a id="9851" class="Symbol">{</a><a id="9852" class="Argument">M</a> <a id="9854" class="Symbol">=</a> <a id="9856" href="/Soundness/#9856" class="Bound">L</a> <a id="9858" href="/Untyped/#4298" class="InductiveConstructor Operator">·</a> <a id="9860" href="/Soundness/#9860" class="Bound">M</a><a id="9861" class="Symbol">}</a> <a id="9863" href="/Soundness/#9863" class="Bound">all-n</a> <a id="9869" class="Symbol">(</a><a id="9870" href="/Denotational/#9652" class="InductiveConstructor">↦-elim</a> <a id="9877" href="/Soundness/#9877" class="Bound">d₁</a> <a id="9880" href="/Soundness/#9880" class="Bound">d₂</a><a id="9882" class="Symbol">)</a> <a id="9884" class="Symbol">=</a>
   <a id="9889" href="/Denotational/#9652" class="InductiveConstructor">↦-elim</a> <a id="9896" class="Symbol">(</a><a id="9897" href="/Soundness/#9224" class="Function">rename-reflect</a> <a id="9912" href="/Soundness/#9863" class="Bound">all-n</a> <a id="9918" href="/Soundness/#9877" class="Bound">d₁</a><a id="9920" class="Symbol">)</a> <a id="9922" class="Symbol">(</a><a id="9923" href="/Soundness/#9224" class="Function">rename-reflect</a> <a id="9938" href="/Soundness/#9863" class="Bound">all-n</a> <a id="9944" href="/Soundness/#9880" class="Bound">d₂</a><a id="9946" class="Symbol">)</a>
<a id="9948" href="/Soundness/#9224" class="Function">rename-reflect</a> <a id="9963" class="Symbol">{</a><a id="9964" class="Argument">M</a> <a id="9966" class="Symbol">=</a> <a id="9968" href="/Soundness/#9968" class="Bound">L</a> <a id="9970" href="/Untyped/#4298" class="InductiveConstructor Operator">·</a> <a id="9972" href="/Soundness/#9972" class="Bound">M</a><a id="9973" class="Symbol">}</a> <a id="9975" href="/Soundness/#9975" class="Bound">all-n</a> <a id="9981" href="/Denotational/#9914" class="InductiveConstructor">⊥-intro</a> <a id="9989" class="Symbol">=</a> <a id="9991" href="/Denotational/#9914" class="InductiveConstructor">⊥-intro</a>
<a id="9999" href="/Soundness/#9224" class="Function">rename-reflect</a> <a id="10014" class="Symbol">{</a><a id="10015" class="Argument">M</a> <a id="10017" class="Symbol">=</a> <a id="10019" href="/Soundness/#10019" class="Bound">L</a> <a id="10021" href="/Untyped/#4298" class="InductiveConstructor Operator">·</a> <a id="10023" href="/Soundness/#10023" class="Bound">M</a><a id="10024" class="Symbol">}</a> <a id="10026" href="/Soundness/#10026" class="Bound">all-n</a> <a id="10032" class="Symbol">(</a><a id="10033" href="/Denotational/#9989" class="InductiveConstructor">⊔-intro</a> <a id="10041" href="/Soundness/#10041" class="Bound">d₁</a> <a id="10044" href="/Soundness/#10044" class="Bound">d₂</a><a id="10046" class="Symbol">)</a> <a id="10048" class="Symbol">=</a>
   <a id="10053" href="/Denotational/#9989" class="InductiveConstructor">⊔-intro</a> <a id="10061" class="Symbol">(</a><a id="10062" href="/Soundness/#9224" class="Function">rename-reflect</a> <a id="10077" href="/Soundness/#10026" class="Bound">all-n</a> <a id="10083" href="/Soundness/#10041" class="Bound">d₁</a><a id="10085" class="Symbol">)</a> <a id="10087" class="Symbol">(</a><a id="10088" href="/Soundness/#9224" class="Function">rename-reflect</a> <a id="10103" href="/Soundness/#10026" class="Bound">all-n</a> <a id="10109" href="/Soundness/#10044" class="Bound">d₂</a><a id="10111" class="Symbol">)</a>
<a id="10113" href="/Soundness/#9224" class="Function">rename-reflect</a> <a id="10128" class="Symbol">{</a><a id="10129" class="Argument">M</a> <a id="10131" class="Symbol">=</a> <a id="10133" href="/Soundness/#10133" class="Bound">L</a> <a id="10135" href="/Untyped/#4298" class="InductiveConstructor Operator">·</a> <a id="10137" href="/Soundness/#10137" class="Bound">M</a><a id="10138" class="Symbol">}</a> <a id="10140" href="/Soundness/#10140" class="Bound">all-n</a> <a id="10146" class="Symbol">(</a><a id="10147" href="/Denotational/#10120" class="InductiveConstructor">sub</a> <a id="10151" href="/Soundness/#10151" class="Bound">d₁</a> <a id="10154" href="/Soundness/#10154" class="Bound">lt</a><a id="10156" class="Symbol">)</a> <a id="10158" class="Symbol">=</a>
   <a id="10163" href="/Denotational/#10120" class="InductiveConstructor">sub</a> <a id="10167" class="Symbol">(</a><a id="10168" href="/Soundness/#9224" class="Function">rename-reflect</a> <a id="10183" href="/Soundness/#10140" class="Bound">all-n</a> <a id="10189" href="/Soundness/#10151" class="Bound">d₁</a><a id="10191" class="Symbol">)</a> <a id="10193" href="/Soundness/#10154" class="Bound">lt</a></pre>

<p>We cannot prove this lemma by induction on the derivation of
<code class="highlighter-rouge">δ ⊢ rename ρ M ↓ v</code>, so instead we proceed by induction on <code class="highlighter-rouge">M</code>.</p>

<ul>
  <li>
    <p>If it is a variable, we apply the inversion lemma to obtain
that <code class="highlighter-rouge">v ⊑ nth (ρ x) δ</code>. Instantiating the premise to <code class="highlighter-rouge">x</code> we have
<code class="highlighter-rouge">nth (ρ x) δ = nth x γ</code>, so we conclude by the <code class="highlighter-rouge">var</code> rule.</p>
  </li>
  <li>
    <p>If it is a lambda abstraction <code class="highlighter-rouge">ƛ N</code>, we have
rename <code class="highlighter-rouge">ρ (ƛ N) = ƛ (rename (ext ρ) N)</code>.
We proceed by cases on <code class="highlighter-rouge">δ ⊢ ƛ (rename (ext ρ) N) ↓ v</code>.</p>

    <ul>
      <li>
        <p>Rule <code class="highlighter-rouge">↦-intro</code>: To satisfy the premise of the induction
hypothesis, we prove that the renaming can be extended to be a
mapping from <code class="highlighter-rouge">γ , v₁ to δ , v₁</code>.</p>
      </li>
      <li>
        <p>Rule <code class="highlighter-rouge">⊥-intro</code>: We simply apply <code class="highlighter-rouge">⊥-intro</code>.</p>
      </li>
      <li>
        <p>Rule <code class="highlighter-rouge">⊔-intro</code>: We apply the induction hypotheses and <code class="highlighter-rouge">⊔-intro</code>.</p>
      </li>
      <li>
        <p>Rule <code class="highlighter-rouge">sub</code>: We apply the induction hypothesis and <code class="highlighter-rouge">sub</code>.</p>
      </li>
    </ul>
  </li>
  <li>
    <p>If it is an application <code class="highlighter-rouge">L · M</code>, we have
<code class="highlighter-rouge">rename ρ (L · M) = (rename ρ L) · (rename ρ M)</code>.
We proceed by cases on <code class="highlighter-rouge">δ ⊢ (rename ρ L) · (rename ρ M) ↓ v</code>
and all the cases are straightforward.</p>
  </li>
</ul>

<p>In the upcoming uses of <code class="highlighter-rouge">rename-reflect</code>, the renaming will always be
the increment function. So we prove a corollary for that special case.</p>

<pre class="Agda"><a id="rename-inc-reflect"></a><a id="11374" href="/Soundness/#11374" class="Function">rename-inc-reflect</a> <a id="11393" class="Symbol">:</a> <a id="11395" class="Symbol">∀</a> <a id="11397" class="Symbol">{</a><a id="11398" href="/Soundness/#11398" class="Bound">Γ</a> <a id="11400" href="/Soundness/#11400" class="Bound">v′</a> <a id="11403" href="/Soundness/#11403" class="Bound">v</a><a id="11404" class="Symbol">}</a> <a id="11406" class="Symbol">{</a><a id="11407" href="/Soundness/#11407" class="Bound">γ</a> <a id="11409" class="Symbol">:</a> <a id="11411" href="/Denotational/#7233" class="Function">Env</a> <a id="11415" href="/Soundness/#11398" class="Bound">Γ</a><a id="11416" class="Symbol">}</a> <a id="11418" class="Symbol">{</a> <a id="11420" href="/Soundness/#11420" class="Bound">M</a> <a id="11422" class="Symbol">:</a> <a id="11424" href="/Soundness/#11398" class="Bound">Γ</a> <a id="11426" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="11428" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="11429" class="Symbol">}</a>
  <a id="11433" class="Symbol">→</a> <a id="11435" class="Symbol">(</a><a id="11436" href="/Soundness/#11407" class="Bound">γ</a> <a id="11438" href="/Denotational/#7406" class="Function Operator">`,</a> <a id="11441" href="/Soundness/#11400" class="Bound">v′</a><a id="11443" class="Symbol">)</a> <a id="11445" href="/Denotational/#9519" class="Datatype Operator">⊢</a> <a id="11447" href="/Untyped/#6171" class="Function">rename</a> <a id="11454" href="/Untyped/#3446" class="InductiveConstructor Operator">S_</a> <a id="11457" href="/Soundness/#11420" class="Bound">M</a> <a id="11459" href="/Denotational/#9519" class="Datatype Operator">↓</a> <a id="11461" href="/Soundness/#11403" class="Bound">v</a>
    <a id="11467" class="Comment">----------------------------</a>
  <a id="11498" class="Symbol">→</a> <a id="11500" href="/Soundness/#11407" class="Bound">γ</a> <a id="11502" href="/Denotational/#9519" class="Datatype Operator">⊢</a> <a id="11504" href="/Soundness/#11420" class="Bound">M</a> <a id="11506" href="/Denotational/#9519" class="Datatype Operator">↓</a> <a id="11508" href="/Soundness/#11403" class="Bound">v</a>
<a id="11510" href="/Soundness/#11374" class="Function">rename-inc-reflect</a> <a id="11529" href="/Soundness/#11529" class="Bound">d</a> <a id="11531" class="Symbol">=</a> <a id="11533" href="/Soundness/#9224" class="Function">rename-reflect</a> <a id="11548" href="/Denotational/#8777" class="Function">`Refl⊑</a> <a id="11555" href="/Soundness/#11529" class="Bound">d</a></pre>

<h3 id="substitution-reflects-denotations-the-variable-case">Substitution reflects denotations, the variable case</h3>

<p>We are almost ready to begin proving that simultaneous substitution
reflects denotations. That is, if <code class="highlighter-rouge">γ ⊢ (subst σ M) ↓ v</code>, then
<code class="highlighter-rouge">γ ⊢ σ k ↓ nth k δ</code> and <code class="highlighter-rouge">δ ⊢ M ↓ v</code> for any <code class="highlighter-rouge">k</code> and some <code class="highlighter-rouge">δ</code>.
We shall start with the case in which <code class="highlighter-rouge">M</code> is a variable <code class="highlighter-rouge">x</code>.
So instead the premise is <code class="highlighter-rouge">γ ⊢ σ x ↓ v</code> and we need to show that
<code class="highlighter-rouge">δ ⊢ x ↓ v</code> for some <code class="highlighter-rouge">δ</code>. The <code class="highlighter-rouge">δ</code> that we choose shall be the
environment that maps <code class="highlighter-rouge">x</code> to <code class="highlighter-rouge">v</code> and every other variable to <code class="highlighter-rouge">⊥</code>.</p>

<p>Next we define the environment that maps <code class="highlighter-rouge">x</code> to <code class="highlighter-rouge">v</code> and every other
variable to <code class="highlighter-rouge">⊥</code>, that is <code class="highlighter-rouge">const-env x v</code>. To tell variables apart, we
define the following function for deciding equality of variables.</p>

<pre class="Agda"><a id="_var≟_"></a><a id="12293" href="/Soundness/#12293" class="Function Operator">_var≟_</a> <a id="12300" class="Symbol">:</a> <a id="12302" class="Symbol">∀</a> <a id="12304" class="Symbol">{</a><a id="12305" href="/Soundness/#12305" class="Bound">Γ</a><a id="12306" class="Symbol">}</a> <a id="12308" class="Symbol">→</a> <a id="12310" class="Symbol">(</a><a id="12311" href="/Soundness/#12311" class="Bound">x</a> <a id="12313" href="/Soundness/#12313" class="Bound">y</a> <a id="12315" class="Symbol">:</a> <a id="12317" href="/Soundness/#12305" class="Bound">Γ</a> <a id="12319" href="/Untyped/#3365" class="Datatype Operator">∋</a> <a id="12321" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="12322" class="Symbol">)</a> <a id="12324" class="Symbol">→</a> <a id="12326" href="https://agda.github.io/agda-stdlib/v0.17/Relation.Nullary.html#534" class="Datatype">Dec</a> <a id="12330" class="Symbol">(</a><a id="12331" href="/Soundness/#12311" class="Bound">x</a> <a id="12333" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Equality.html#83" class="Datatype Operator">≡</a> <a id="12335" href="/Soundness/#12313" class="Bound">y</a><a id="12336" class="Symbol">)</a>
<a id="12338" href="/Untyped/#3401" class="InductiveConstructor">Z</a> <a id="12340" href="/Soundness/#12293" class="Function Operator">var≟</a> <a id="12345" href="/Untyped/#3401" class="InductiveConstructor">Z</a>  <a id="12348" class="Symbol">=</a>  <a id="12351" href="https://agda.github.io/agda-stdlib/v0.17/Relation.Nullary.html#570" class="InductiveConstructor">yes</a> <a id="12355" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a>
<a id="12360" href="/Untyped/#3401" class="InductiveConstructor">Z</a> <a id="12362" href="/Soundness/#12293" class="Function Operator">var≟</a> <a id="12367" class="Symbol">(</a><a id="12368" href="/Untyped/#3446" class="InductiveConstructor Operator">S</a> <a id="12370" class="Symbol">_)</a>  <a id="12374" class="Symbol">=</a>  <a id="12377" href="https://agda.github.io/agda-stdlib/v0.17/Relation.Nullary.html#597" class="InductiveConstructor">no</a> <a id="12380" class="Symbol">λ()</a>
<a id="12384" class="Symbol">(</a><a id="12385" href="/Untyped/#3446" class="InductiveConstructor Operator">S</a> <a id="12387" class="Symbol">_)</a> <a id="12390" href="/Soundness/#12293" class="Function Operator">var≟</a> <a id="12395" href="/Untyped/#3401" class="InductiveConstructor">Z</a>  <a id="12398" class="Symbol">=</a>  <a id="12401" href="https://agda.github.io/agda-stdlib/v0.17/Relation.Nullary.html#597" class="InductiveConstructor">no</a> <a id="12404" class="Symbol">λ()</a>
<a id="12408" class="Symbol">(</a><a id="12409" href="/Untyped/#3446" class="InductiveConstructor Operator">S</a> <a id="12411" href="/Soundness/#12411" class="Bound">x</a><a id="12412" class="Symbol">)</a> <a id="12414" href="/Soundness/#12293" class="Function Operator">var≟</a> <a id="12419" class="Symbol">(</a><a id="12420" href="/Untyped/#3446" class="InductiveConstructor Operator">S</a> <a id="12422" href="/Soundness/#12422" class="Bound">y</a><a id="12423" class="Symbol">)</a> <a id="12425" class="Keyword">with</a>  <a id="12431" href="/Soundness/#12411" class="Bound">x</a> <a id="12433" href="/Soundness/#12293" class="Function Operator">var≟</a> <a id="12438" href="/Soundness/#12422" class="Bound">y</a>
<a id="12440" class="Symbol">...</a>                 <a id="12460" class="Symbol">|</a>  <a id="12463" href="https://agda.github.io/agda-stdlib/v0.17/Relation.Nullary.html#570" class="InductiveConstructor">yes</a> <a id="12467" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a> <a id="12472" class="Symbol">=</a>  <a id="12475" href="https://agda.github.io/agda-stdlib/v0.17/Relation.Nullary.html#570" class="InductiveConstructor">yes</a> <a id="12479" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a>
<a id="12484" class="Symbol">...</a>                 <a id="12504" class="Symbol">|</a>  <a id="12507" href="https://agda.github.io/agda-stdlib/v0.17/Relation.Nullary.html#597" class="InductiveConstructor">no</a> <a id="12510" href="/Soundness/#12510" class="Bound">neq</a>   <a id="12516" class="Symbol">=</a>  <a id="12519" href="https://agda.github.io/agda-stdlib/v0.17/Relation.Nullary.html#597" class="InductiveConstructor">no</a> <a id="12522" class="Symbol">λ{</a><a id="12524" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a> <a id="12529" class="Symbol">→</a> <a id="12531" href="/Soundness/#12510" class="Bound">neq</a> <a id="12535" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a><a id="12539" class="Symbol">}</a>

<a id="var≟-refl"></a><a id="12542" href="/Soundness/#12542" class="Function">var≟-refl</a> <a id="12552" class="Symbol">:</a> <a id="12554" class="Symbol">∀</a> <a id="12556" class="Symbol">{</a><a id="12557" href="/Soundness/#12557" class="Bound">Γ</a><a id="12558" class="Symbol">}</a> <a id="12560" class="Symbol">(</a><a id="12561" href="/Soundness/#12561" class="Bound">x</a> <a id="12563" class="Symbol">:</a> <a id="12565" href="/Soundness/#12557" class="Bound">Γ</a> <a id="12567" href="/Untyped/#3365" class="Datatype Operator">∋</a> <a id="12569" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="12570" class="Symbol">)</a> <a id="12572" class="Symbol">→</a> <a id="12574" class="Symbol">(</a><a id="12575" href="/Soundness/#12561" class="Bound">x</a> <a id="12577" href="/Soundness/#12293" class="Function Operator">var≟</a> <a id="12582" href="/Soundness/#12561" class="Bound">x</a><a id="12583" class="Symbol">)</a> <a id="12585" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Equality.html#83" class="Datatype Operator">≡</a> <a id="12587" href="https://agda.github.io/agda-stdlib/v0.17/Relation.Nullary.html#570" class="InductiveConstructor">yes</a> <a id="12591" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a>
<a id="12596" href="/Soundness/#12542" class="Function">var≟-refl</a> <a id="12606" href="/Untyped/#3401" class="InductiveConstructor">Z</a> <a id="12608" class="Symbol">=</a> <a id="12610" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a>
<a id="12615" href="/Soundness/#12542" class="Function">var≟-refl</a> <a id="12625" class="Symbol">(</a><a id="12626" href="/Untyped/#3446" class="InductiveConstructor Operator">S</a> <a id="12628" href="/Soundness/#12628" class="Bound">x</a><a id="12629" class="Symbol">)</a> <a id="12631" class="Keyword">rewrite</a> <a id="12639" href="/Soundness/#12542" class="Function">var≟-refl</a> <a id="12649" href="/Soundness/#12628" class="Bound">x</a> <a id="12651" class="Symbol">=</a> <a id="12653" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a></pre>

<p>Now we use <code class="highlighter-rouge">var≟</code> to define <code class="highlighter-rouge">const-env</code>.</p>

<pre class="Agda"><a id="const-env"></a><a id="12725" href="/Soundness/#12725" class="Function">const-env</a> <a id="12735" class="Symbol">:</a> <a id="12737" class="Symbol">∀{</a><a id="12739" href="/Soundness/#12739" class="Bound">Γ</a><a id="12740" class="Symbol">}</a> <a id="12742" class="Symbol">→</a> <a id="12744" class="Symbol">(</a><a id="12745" href="/Soundness/#12745" class="Bound">x</a> <a id="12747" class="Symbol">:</a> <a id="12749" href="/Soundness/#12739" class="Bound">Γ</a> <a id="12751" href="/Untyped/#3365" class="Datatype Operator">∋</a> <a id="12753" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="12754" class="Symbol">)</a> <a id="12756" class="Symbol">→</a> <a id="12758" href="/Denotational/#3999" class="Datatype">Value</a> <a id="12764" class="Symbol">→</a> <a id="12766" href="/Denotational/#7233" class="Function">Env</a> <a id="12770" href="/Soundness/#12739" class="Bound">Γ</a>
<a id="12772" href="/Soundness/#12725" class="Function">const-env</a> <a id="12782" href="/Soundness/#12782" class="Bound">x</a> <a id="12784" href="/Soundness/#12784" class="Bound">v</a> <a id="12786" href="/Soundness/#12786" class="Bound">y</a> <a id="12788" class="Keyword">with</a> <a id="12793" href="/Soundness/#12782" class="Bound">x</a> <a id="12795" href="/Soundness/#12293" class="Function Operator">var≟</a> <a id="12800" href="/Soundness/#12786" class="Bound">y</a>
<a id="12802" class="Symbol">...</a>             <a id="12818" class="Symbol">|</a> <a id="12820" href="https://agda.github.io/agda-stdlib/v0.17/Relation.Nullary.html#570" class="InductiveConstructor">yes</a> <a id="12824" class="Symbol">_</a>       <a id="12832" class="Symbol">=</a> <a id="12834" class="Bound">v</a>
<a id="12836" class="Symbol">...</a>             <a id="12852" class="Symbol">|</a> <a id="12854" href="https://agda.github.io/agda-stdlib/v0.17/Relation.Nullary.html#597" class="InductiveConstructor">no</a> <a id="12857" class="Symbol">_</a>        <a id="12866" class="Symbol">=</a> <a id="12868" href="/Denotational/#4019" class="InductiveConstructor">⊥</a></pre>

<p>Of course, <code class="highlighter-rouge">const-env x v</code> maps <code class="highlighter-rouge">x</code> to value <code class="highlighter-rouge">v</code></p>

<pre class="Agda"><a id="same-const-env"></a><a id="12945" href="/Soundness/#12945" class="Function">same-const-env</a> <a id="12960" class="Symbol">:</a> <a id="12962" class="Symbol">∀{</a><a id="12964" href="/Soundness/#12964" class="Bound">Γ</a><a id="12965" class="Symbol">}</a> <a id="12967" class="Symbol">{</a><a id="12968" href="/Soundness/#12968" class="Bound">x</a> <a id="12970" class="Symbol">:</a> <a id="12972" href="/Soundness/#12964" class="Bound">Γ</a> <a id="12974" href="/Untyped/#3365" class="Datatype Operator">∋</a> <a id="12976" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="12977" class="Symbol">}</a> <a id="12979" class="Symbol">{</a><a id="12980" href="/Soundness/#12980" class="Bound">v</a><a id="12981" class="Symbol">}</a> <a id="12983" class="Symbol">→</a> <a id="12985" class="Symbol">(</a><a id="12986" href="/Soundness/#12725" class="Function">const-env</a> <a id="12996" href="/Soundness/#12968" class="Bound">x</a> <a id="12998" href="/Soundness/#12980" class="Bound">v</a><a id="12999" class="Symbol">)</a> <a id="13001" href="/Soundness/#12968" class="Bound">x</a> <a id="13003" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Equality.html#83" class="Datatype Operator">≡</a> <a id="13005" href="/Soundness/#12980" class="Bound">v</a>
<a id="13007" href="/Soundness/#12945" class="Function">same-const-env</a> <a id="13022" class="Symbol">{</a><a id="13023" class="Argument">x</a> <a id="13025" class="Symbol">=</a> <a id="13027" href="/Soundness/#13027" class="Bound">x</a><a id="13028" class="Symbol">}</a> <a id="13030" class="Keyword">rewrite</a> <a id="13038" href="/Soundness/#12542" class="Function">var≟-refl</a> <a id="13048" href="/Soundness/#13027" class="Bound">x</a> <a id="13050" class="Symbol">=</a> <a id="13052" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a></pre>

<p>and <code class="highlighter-rouge">const-env x v</code> maps <code class="highlighter-rouge">y</code> to <code class="highlighter-rouge">⊥, so long as </code>x ≢ y`.</p>

<pre class="Agda"><a id="diff-nth-const-env"></a><a id="13139" href="/Soundness/#13139" class="Function">diff-nth-const-env</a> <a id="13158" class="Symbol">:</a> <a id="13160" class="Symbol">∀{</a><a id="13162" href="/Soundness/#13162" class="Bound">Γ</a><a id="13163" class="Symbol">}</a> <a id="13165" class="Symbol">{</a><a id="13166" href="/Soundness/#13166" class="Bound">x</a> <a id="13168" href="/Soundness/#13168" class="Bound">y</a> <a id="13170" class="Symbol">:</a> <a id="13172" href="/Soundness/#13162" class="Bound">Γ</a> <a id="13174" href="/Untyped/#3365" class="Datatype Operator">∋</a> <a id="13176" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="13177" class="Symbol">}</a> <a id="13179" class="Symbol">{</a><a id="13180" href="/Soundness/#13180" class="Bound">v</a><a id="13181" class="Symbol">}</a>
  <a id="13185" class="Symbol">→</a> <a id="13187" href="/Soundness/#13166" class="Bound">x</a> <a id="13189" href="https://agda.github.io/agda-stdlib/v0.17/Relation.Binary.PropositionalEquality.Core.html#660" class="Function Operator">≢</a> <a id="13191" href="/Soundness/#13168" class="Bound">y</a>
    <a id="13197" class="Comment">-------------------</a>
  <a id="13219" class="Symbol">→</a> <a id="13221" href="/Soundness/#12725" class="Function">const-env</a> <a id="13231" href="/Soundness/#13166" class="Bound">x</a> <a id="13233" href="/Soundness/#13180" class="Bound">v</a> <a id="13235" href="/Soundness/#13168" class="Bound">y</a> <a id="13237" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Equality.html#83" class="Datatype Operator">≡</a> <a id="13239" href="/Denotational/#4019" class="InductiveConstructor">⊥</a>
<a id="13241" href="/Soundness/#13139" class="Function">diff-nth-const-env</a> <a id="13260" class="Symbol">{</a><a id="13261" href="/Soundness/#13261" class="Bound">Γ</a><a id="13262" class="Symbol">}</a> <a id="13264" class="Symbol">{</a><a id="13265" href="/Soundness/#13265" class="Bound">x</a><a id="13266" class="Symbol">}</a> <a id="13268" class="Symbol">{</a><a id="13269" href="/Soundness/#13269" class="Bound">y</a><a id="13270" class="Symbol">}</a> <a id="13272" href="/Soundness/#13272" class="Bound">neq</a> <a id="13276" class="Keyword">with</a> <a id="13281" href="/Soundness/#13265" class="Bound">x</a> <a id="13283" href="/Soundness/#12293" class="Function Operator">var≟</a> <a id="13288" href="/Soundness/#13269" class="Bound">y</a>
<a id="13290" class="Symbol">...</a>  <a id="13295" class="Symbol">|</a> <a id="13297" href="https://agda.github.io/agda-stdlib/v0.17/Relation.Nullary.html#570" class="InductiveConstructor">yes</a> <a id="13301" href="/Soundness/#13301" class="Bound">eq</a>  <a id="13305" class="Symbol">=</a>  <a id="13308" href="https://agda.github.io/agda-stdlib/v0.17/Data.Empty.html#360" class="Function">⊥-elim</a> <a id="13315" class="Symbol">(</a><a id="13316" class="Bound">neq</a> <a id="13320" href="/Soundness/#13301" class="Bound">eq</a><a id="13322" class="Symbol">)</a>
<a id="13324" class="Symbol">...</a>  <a id="13329" class="Symbol">|</a> <a id="13331" href="https://agda.github.io/agda-stdlib/v0.17/Relation.Nullary.html#597" class="InductiveConstructor">no</a> <a id="13334" class="Symbol">_</a>    <a id="13339" class="Symbol">=</a>  <a id="13342" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a></pre>

<p>So we choose <code class="highlighter-rouge">const-env x v</code> for <code class="highlighter-rouge">δ</code> and obtain <code class="highlighter-rouge">δ ⊢ x ↓ v</code>
with the <code class="highlighter-rouge">var</code> rule.</p>

<p>It remains to prove that <code class="highlighter-rouge">γ ⊢ σ ↓ δ</code> and <code class="highlighter-rouge">δ ⊢ M ↓ v</code> for any <code class="highlighter-rouge">k</code>, given that
we have chosen <code class="highlighter-rouge">const-env x v</code> for <code class="highlighter-rouge">δ</code>.  We shall have two cases to
consider, <code class="highlighter-rouge">x ≡ y</code> or <code class="highlighter-rouge">x ≢ y</code>.</p>

<p>Now to finish the two cases of the proof.</p>

<ul>
  <li>In the case where <code class="highlighter-rouge">x ≡ y</code>, we need to show
that <code class="highlighter-rouge">γ ⊢ σ y ↓ v</code>, but that’s just our premise.</li>
  <li>In the case where <code class="highlighter-rouge">x ≢ y,</code> we need to show
that <code class="highlighter-rouge">γ ⊢ σ y ↓ ⊥</code>, which we do via rule <code class="highlighter-rouge">⊥-intro</code>.</li>
</ul>

<p>Thus, we have completed the variable case of the proof that
simultaneous substitution reflects denotations.  Here is the proof
again, formally.</p>

<pre class="Agda"><a id="subst-reflect-var"></a><a id="14014" href="/Soundness/#14014" class="Function">subst-reflect-var</a> <a id="14032" class="Symbol">:</a> <a id="14034" class="Symbol">∀</a> <a id="14036" class="Symbol">{</a><a id="14037" href="/Soundness/#14037" class="Bound">Γ</a> <a id="14039" href="/Soundness/#14039" class="Bound">Δ</a><a id="14040" class="Symbol">}</a> <a id="14042" class="Symbol">{</a><a id="14043" href="/Soundness/#14043" class="Bound">γ</a> <a id="14045" class="Symbol">:</a> <a id="14047" href="/Denotational/#7233" class="Function">Env</a> <a id="14051" href="/Soundness/#14039" class="Bound">Δ</a><a id="14052" class="Symbol">}</a> <a id="14054" class="Symbol">{</a><a id="14055" href="/Soundness/#14055" class="Bound">x</a> <a id="14057" class="Symbol">:</a> <a id="14059" href="/Soundness/#14037" class="Bound">Γ</a> <a id="14061" href="/Untyped/#3365" class="Datatype Operator">∋</a> <a id="14063" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="14064" class="Symbol">}</a> <a id="14066" class="Symbol">{</a><a id="14067" href="/Soundness/#14067" class="Bound">v</a><a id="14068" class="Symbol">}</a> <a id="14070" class="Symbol">{</a><a id="14071" href="/Soundness/#14071" class="Bound">σ</a> <a id="14073" class="Symbol">:</a> <a id="14075" href="/Substitution/#2504" class="Function">Subst</a> <a id="14081" href="/Soundness/#14037" class="Bound">Γ</a> <a id="14083" href="/Soundness/#14039" class="Bound">Δ</a><a id="14084" class="Symbol">}</a>
  <a id="14088" class="Symbol">→</a> <a id="14090" href="/Soundness/#14043" class="Bound">γ</a> <a id="14092" href="/Denotational/#9519" class="Datatype Operator">⊢</a> <a id="14094" href="/Soundness/#14071" class="Bound">σ</a> <a id="14096" href="/Soundness/#14055" class="Bound">x</a> <a id="14098" href="/Denotational/#9519" class="Datatype Operator">↓</a> <a id="14100" href="/Soundness/#14067" class="Bound">v</a>
    <a id="14106" class="Comment">-----------------------------------------</a>
  <a id="14150" class="Symbol">→</a> <a id="14152" href="https://agda.github.io/agda-stdlib/v0.17/Data.Product.html#764" class="Function">Σ[</a> <a id="14155" href="/Soundness/#14155" class="Bound">δ</a> <a id="14157" href="https://agda.github.io/agda-stdlib/v0.17/Data.Product.html#764" class="Function">∈</a> <a id="14159" href="/Denotational/#7233" class="Function">Env</a> <a id="14163" href="/Soundness/#14037" class="Bound">Γ</a> <a id="14165" href="https://agda.github.io/agda-stdlib/v0.17/Data.Product.html#764" class="Function">]</a> <a id="14167" href="/Soundness/#14043" class="Bound">γ</a> <a id="14169" href="/Soundness/#3272" class="Function Operator">`⊢</a> <a id="14172" href="/Soundness/#14071" class="Bound">σ</a> <a id="14174" href="/Soundness/#3272" class="Function Operator">↓</a> <a id="14176" href="/Soundness/#14155" class="Bound">δ</a>  <a id="14179" href="https://agda.github.io/agda-stdlib/v0.17/Data.Product.html#1353" class="Function Operator">×</a>  <a id="14182" href="/Soundness/#14155" class="Bound">δ</a> <a id="14184" href="/Denotational/#9519" class="Datatype Operator">⊢</a> <a id="14186" href="/Untyped/#4186" class="InductiveConstructor Operator">`</a> <a id="14188" href="/Soundness/#14055" class="Bound">x</a> <a id="14190" href="/Denotational/#9519" class="Datatype Operator">↓</a> <a id="14192" href="/Soundness/#14067" class="Bound">v</a>
<a id="14194" href="/Soundness/#14014" class="Function">subst-reflect-var</a> <a id="14212" class="Symbol">{</a><a id="14213" href="/Soundness/#14213" class="Bound">Γ</a><a id="14214" class="Symbol">}{</a><a id="14216" href="/Soundness/#14216" class="Bound">Δ</a><a id="14217" class="Symbol">}{</a><a id="14219" href="/Soundness/#14219" class="Bound">γ</a><a id="14220" class="Symbol">}{</a><a id="14222" href="/Soundness/#14222" class="Bound">x</a><a id="14223" class="Symbol">}{</a><a id="14225" href="/Soundness/#14225" class="Bound">v</a><a id="14226" class="Symbol">}{</a><a id="14228" href="/Soundness/#14228" class="Bound">σ</a><a id="14229" class="Symbol">}</a> <a id="14231" href="/Soundness/#14231" class="Bound">xv</a>
  <a id="14236" class="Keyword">rewrite</a> <a id="14244" href="https://agda.github.io/agda-stdlib/v0.17/Relation.Binary.PropositionalEquality.Core.html#838" class="Function">sym</a> <a id="14248" class="Symbol">(</a><a id="14249" href="/Soundness/#12945" class="Function">same-const-env</a> <a id="14264" class="Symbol">{</a><a id="14265" href="/Soundness/#14213" class="Bound">Γ</a><a id="14266" class="Symbol">}{</a><a id="14268" href="/Soundness/#14222" class="Bound">x</a><a id="14269" class="Symbol">}{</a><a id="14271" href="/Soundness/#14225" class="Bound">v</a><a id="14272" class="Symbol">})</a> <a id="14275" class="Symbol">=</a>
    <a id="14281" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="14283" href="/Soundness/#12725" class="Function">const-env</a> <a id="14293" href="/Soundness/#14222" class="Bound">x</a> <a id="14295" href="/Soundness/#14225" class="Bound">v</a> <a id="14297" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="14299" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="14301" href="/Soundness/#14334" class="Function">const-env-ok</a> <a id="14314" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="14316" href="/Denotational/#9573" class="InductiveConstructor">var</a> <a id="14320" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="14322" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a>
  <a id="14326" class="Keyword">where</a>
  <a id="14334" href="/Soundness/#14334" class="Function">const-env-ok</a> <a id="14347" class="Symbol">:</a> <a id="14349" href="/Soundness/#14219" class="Bound">γ</a> <a id="14351" href="/Soundness/#3272" class="Function Operator">`⊢</a> <a id="14354" href="/Soundness/#14228" class="Bound">σ</a> <a id="14356" href="/Soundness/#3272" class="Function Operator">↓</a> <a id="14358" href="/Soundness/#12725" class="Function">const-env</a> <a id="14368" href="/Soundness/#14222" class="Bound">x</a> <a id="14370" href="/Soundness/#14225" class="Bound">v</a>
  <a id="14374" href="/Soundness/#14334" class="Function">const-env-ok</a> <a id="14387" href="/Soundness/#14387" class="Bound">y</a> <a id="14389" class="Keyword">with</a> <a id="14394" href="/Soundness/#14222" class="Bound">x</a> <a id="14396" href="/Soundness/#12293" class="Function Operator">var≟</a> <a id="14401" href="/Soundness/#14387" class="Bound">y</a>
  <a id="14405" class="Symbol">...</a> <a id="14409" class="Symbol">|</a> <a id="14411" href="https://agda.github.io/agda-stdlib/v0.17/Relation.Nullary.html#570" class="InductiveConstructor">yes</a> <a id="14415" href="/Soundness/#14415" class="Bound">x≡y</a> <a id="14419" class="Keyword">rewrite</a> <a id="14427" href="https://agda.github.io/agda-stdlib/v0.17/Relation.Binary.PropositionalEquality.Core.html#838" class="Function">sym</a> <a id="14431" href="/Soundness/#14415" class="Bound">x≡y</a> <a id="14435" class="Symbol">|</a> <a id="14437" href="/Soundness/#12945" class="Function">same-const-env</a> <a id="14452" class="Symbol">{</a><a id="14453" href="/Soundness/#14213" class="Bound">Γ</a><a id="14454" class="Symbol">}{</a><a id="14456" href="/Soundness/#14222" class="Bound">x</a><a id="14457" class="Symbol">}{</a><a id="14459" href="/Soundness/#14225" class="Bound">v</a><a id="14460" class="Symbol">}</a> <a id="14462" class="Symbol">=</a> <a id="14464" href="/Soundness/#14231" class="Bound">xv</a>
  <a id="14469" class="Symbol">...</a> <a id="14473" class="Symbol">|</a> <a id="14475" href="https://agda.github.io/agda-stdlib/v0.17/Relation.Nullary.html#597" class="InductiveConstructor">no</a> <a id="14478" href="/Soundness/#14478" class="Bound">x≢y</a> <a id="14482" class="Keyword">rewrite</a> <a id="14490" href="/Soundness/#13139" class="Function">diff-nth-const-env</a> <a id="14509" class="Symbol">{</a><a id="14510" href="/Soundness/#14213" class="Bound">Γ</a><a id="14511" class="Symbol">}{</a><a id="14513" href="/Soundness/#14222" class="Bound">x</a><a id="14514" class="Symbol">}{</a><a id="14516" class="Bound">y</a><a id="14517" class="Symbol">}{</a><a id="14519" href="/Soundness/#14225" class="Bound">v</a><a id="14520" class="Symbol">}</a> <a id="14522" href="/Soundness/#14478" class="Bound">x≢y</a> <a id="14526" class="Symbol">=</a> <a id="14528" href="/Denotational/#9914" class="InductiveConstructor">⊥-intro</a></pre>

<h3 id="substitutions-and-environment-construction">Substitutions and environment construction</h3>

<p>Every substitution produces terms that can evaluate to <code class="highlighter-rouge">⊥</code>.</p>

<pre class="Agda"><a id="subst-⊥"></a><a id="14671" href="/Soundness/#14671" class="Function">subst-⊥</a> <a id="14679" class="Symbol">:</a> <a id="14681" class="Symbol">∀{</a><a id="14683" href="/Soundness/#14683" class="Bound">Γ</a> <a id="14685" href="/Soundness/#14685" class="Bound">Δ</a><a id="14686" class="Symbol">}{</a><a id="14688" href="/Soundness/#14688" class="Bound">γ</a> <a id="14690" class="Symbol">:</a> <a id="14692" href="/Denotational/#7233" class="Function">Env</a> <a id="14696" href="/Soundness/#14685" class="Bound">Δ</a><a id="14697" class="Symbol">}{</a><a id="14699" href="/Soundness/#14699" class="Bound">σ</a> <a id="14701" class="Symbol">:</a> <a id="14703" href="/Substitution/#2504" class="Function">Subst</a> <a id="14709" href="/Soundness/#14683" class="Bound">Γ</a> <a id="14711" href="/Soundness/#14685" class="Bound">Δ</a><a id="14712" class="Symbol">}</a>
    <a id="14718" class="Comment">-----------------</a>
  <a id="14738" class="Symbol">→</a> <a id="14740" href="/Soundness/#14688" class="Bound">γ</a> <a id="14742" href="/Soundness/#3272" class="Function Operator">`⊢</a> <a id="14745" href="/Soundness/#14699" class="Bound">σ</a> <a id="14747" href="/Soundness/#3272" class="Function Operator">↓</a> <a id="14749" href="/Denotational/#8478" class="Function">`⊥</a>
<a id="14752" href="/Soundness/#14671" class="Function">subst-⊥</a> <a id="14760" href="/Soundness/#14760" class="Bound">x</a> <a id="14762" class="Symbol">=</a> <a id="14764" href="/Denotational/#9914" class="InductiveConstructor">⊥-intro</a></pre>

<p>If a substitution produces terms that evaluate to the values in
both <code class="highlighter-rouge">γ₁</code> and <code class="highlighter-rouge">γ₂</code>, then those terms also evaluate to the values in
<code class="highlighter-rouge">γ₁ ⊔ γ₂</code>.</p>

<pre class="Agda"><a id="subst-⊔"></a><a id="14941" href="/Soundness/#14941" class="Function">subst-⊔</a> <a id="14949" class="Symbol">:</a> <a id="14951" class="Symbol">∀{</a><a id="14953" href="/Soundness/#14953" class="Bound">Γ</a> <a id="14955" href="/Soundness/#14955" class="Bound">Δ</a><a id="14956" class="Symbol">}{</a><a id="14958" href="/Soundness/#14958" class="Bound">γ</a> <a id="14960" class="Symbol">:</a> <a id="14962" href="/Denotational/#7233" class="Function">Env</a> <a id="14966" href="/Soundness/#14955" class="Bound">Δ</a><a id="14967" class="Symbol">}{</a><a id="14969" href="/Soundness/#14969" class="Bound">γ₁</a> <a id="14972" href="/Soundness/#14972" class="Bound">γ₂</a> <a id="14975" class="Symbol">:</a> <a id="14977" href="/Denotational/#7233" class="Function">Env</a> <a id="14981" href="/Soundness/#14953" class="Bound">Γ</a><a id="14982" class="Symbol">}{</a><a id="14984" href="/Soundness/#14984" class="Bound">σ</a> <a id="14986" class="Symbol">:</a> <a id="14988" href="/Substitution/#2504" class="Function">Subst</a> <a id="14994" href="/Soundness/#14953" class="Bound">Γ</a> <a id="14996" href="/Soundness/#14955" class="Bound">Δ</a><a id="14997" class="Symbol">}</a>
           <a id="15010" class="Symbol">→</a> <a id="15012" href="/Soundness/#14958" class="Bound">γ</a> <a id="15014" href="/Soundness/#3272" class="Function Operator">`⊢</a> <a id="15017" href="/Soundness/#14984" class="Bound">σ</a> <a id="15019" href="/Soundness/#3272" class="Function Operator">↓</a> <a id="15021" href="/Soundness/#14969" class="Bound">γ₁</a>
           <a id="15035" class="Symbol">→</a> <a id="15037" href="/Soundness/#14958" class="Bound">γ</a> <a id="15039" href="/Soundness/#3272" class="Function Operator">`⊢</a> <a id="15042" href="/Soundness/#14984" class="Bound">σ</a> <a id="15044" href="/Soundness/#3272" class="Function Operator">↓</a> <a id="15046" href="/Soundness/#14972" class="Bound">γ₂</a>
             <a id="15062" class="Comment">-------------------------</a>
           <a id="15099" class="Symbol">→</a> <a id="15101" href="/Soundness/#14958" class="Bound">γ</a> <a id="15103" href="/Soundness/#3272" class="Function Operator">`⊢</a> <a id="15106" href="/Soundness/#14984" class="Bound">σ</a> <a id="15108" href="/Soundness/#3272" class="Function Operator">↓</a> <a id="15110" class="Symbol">(</a><a id="15111" href="/Soundness/#14969" class="Bound">γ₁</a> <a id="15114" href="/Denotational/#8507" class="Function Operator">`⊔</a> <a id="15117" href="/Soundness/#14972" class="Bound">γ₂</a><a id="15119" class="Symbol">)</a>
<a id="15121" href="/Soundness/#14941" class="Function">subst-⊔</a> <a id="15129" href="/Soundness/#15129" class="Bound">γ₁-ok</a> <a id="15135" href="/Soundness/#15135" class="Bound">γ₂-ok</a> <a id="15141" href="/Soundness/#15141" class="Bound">x</a> <a id="15143" class="Symbol">=</a> <a id="15145" href="/Denotational/#9989" class="InductiveConstructor">⊔-intro</a> <a id="15153" class="Symbol">(</a><a id="15154" href="/Soundness/#15129" class="Bound">γ₁-ok</a> <a id="15160" href="/Soundness/#15141" class="Bound">x</a><a id="15161" class="Symbol">)</a> <a id="15163" class="Symbol">(</a><a id="15164" href="/Soundness/#15135" class="Bound">γ₂-ok</a> <a id="15170" href="/Soundness/#15141" class="Bound">x</a><a id="15171" class="Symbol">)</a></pre>

<h3 id="the-lambda-constructor-is-injective">The Lambda constructor is injective</h3>

<pre class="Agda"><a id="lambda-inj"></a><a id="15239" href="/Soundness/#15239" class="Function">lambda-inj</a> <a id="15250" class="Symbol">:</a> <a id="15252" class="Symbol">∀</a> <a id="15254" class="Symbol">{</a><a id="15255" href="/Soundness/#15255" class="Bound">Γ</a><a id="15256" class="Symbol">}</a> <a id="15258" class="Symbol">{</a><a id="15259" href="/Soundness/#15259" class="Bound">M</a> <a id="15261" href="/Soundness/#15261" class="Bound">N</a> <a id="15263" class="Symbol">:</a> <a id="15265" href="/Soundness/#15255" class="Bound">Γ</a> <a id="15267" href="/Untyped/#3018" class="InductiveConstructor Operator">,</a> <a id="15269" href="/Untyped/#2694" class="InductiveConstructor">★</a> <a id="15271" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="15273" href="/Untyped/#2694" class="InductiveConstructor">★</a> <a id="15275" class="Symbol">}</a>
  <a id="15279" class="Symbol">→</a> <a id="15281" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Equality.html#83" class="Datatype Operator">_≡_</a> <a id="15285" class="Symbol">{</a><a id="15286" class="Argument">A</a> <a id="15288" class="Symbol">=</a> <a id="15290" href="/Soundness/#15255" class="Bound">Γ</a> <a id="15292" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="15294" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="15295" class="Symbol">}</a> <a id="15297" class="Symbol">(</a><a id="15298" href="/Untyped/#4238" class="InductiveConstructor Operator">ƛ</a> <a id="15300" href="/Soundness/#15259" class="Bound">M</a><a id="15301" class="Symbol">)</a> <a id="15303" class="Symbol">(</a><a id="15304" href="/Untyped/#4238" class="InductiveConstructor Operator">ƛ</a> <a id="15306" href="/Soundness/#15261" class="Bound">N</a><a id="15307" class="Symbol">)</a>
    <a id="15313" class="Comment">---------------------------</a>
  <a id="15343" class="Symbol">→</a> <a id="15345" href="/Soundness/#15259" class="Bound">M</a> <a id="15347" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Equality.html#83" class="Datatype Operator">≡</a> <a id="15349" href="/Soundness/#15261" class="Bound">N</a>
<a id="15351" href="/Soundness/#15239" class="Function">lambda-inj</a> <a id="15362" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a> <a id="15367" class="Symbol">=</a> <a id="15369" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a></pre>

<h3 id="simultaneous-substitution-reflects-denotations">Simultaneous substitution reflects denotations</h3>

<p>In this section we prove a central lemma, that
substitution reflects denotations. That is, if <code class="highlighter-rouge">γ ⊢ subst σ M ↓ v</code>, then
<code class="highlighter-rouge">δ ⊢ M ↓ v</code> and <code class="highlighter-rouge">γ ⊢ σ ↓ δ</code> for some <code class="highlighter-rouge">δ</code>. We shall proceed by induction on
the derivation of <code class="highlighter-rouge">γ ⊢ subst σ M ↓ v</code>. This requires a minor
restatement of the lemma, changing the premise to <code class="highlighter-rouge">γ ⊢ L ↓ v</code> and
<code class="highlighter-rouge">L ≡ subst σ M</code>.</p>

<pre class="Agda"><a id="split"></a><a id="15791" href="/Soundness/#15791" class="Function">split</a> <a id="15797" class="Symbol">:</a> <a id="15799" class="Symbol">∀</a> <a id="15801" class="Symbol">{</a><a id="15802" href="/Soundness/#15802" class="Bound">Γ</a><a id="15803" class="Symbol">}</a> <a id="15805" class="Symbol">{</a><a id="15806" href="/Soundness/#15806" class="Bound">M</a> <a id="15808" class="Symbol">:</a> <a id="15810" href="/Soundness/#15802" class="Bound">Γ</a> <a id="15812" href="/Untyped/#3018" class="InductiveConstructor Operator">,</a> <a id="15814" href="/Untyped/#2694" class="InductiveConstructor">★</a> <a id="15816" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="15818" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="15819" class="Symbol">}</a> <a id="15821" class="Symbol">{</a><a id="15822" href="/Soundness/#15822" class="Bound">δ</a> <a id="15824" class="Symbol">:</a> <a id="15826" href="/Denotational/#7233" class="Function">Env</a> <a id="15830" class="Symbol">(</a><a id="15831" href="/Soundness/#15802" class="Bound">Γ</a> <a id="15833" href="/Untyped/#3018" class="InductiveConstructor Operator">,</a> <a id="15835" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="15836" class="Symbol">)}</a> <a id="15839" class="Symbol">{</a><a id="15840" href="/Soundness/#15840" class="Bound">v</a><a id="15841" class="Symbol">}</a>
  <a id="15845" class="Symbol">→</a> <a id="15847" href="/Soundness/#15822" class="Bound">δ</a> <a id="15849" href="/Denotational/#9519" class="Datatype Operator">⊢</a> <a id="15851" href="/Soundness/#15806" class="Bound">M</a> <a id="15853" href="/Denotational/#9519" class="Datatype Operator">↓</a> <a id="15855" href="/Soundness/#15840" class="Bound">v</a>
    <a id="15861" class="Comment">--------------------------</a>
  <a id="15890" class="Symbol">→</a> <a id="15892" class="Symbol">(</a><a id="15893" href="/Denotational/#7659" class="Function">init</a> <a id="15898" href="/Soundness/#15822" class="Bound">δ</a> <a id="15900" href="/Denotational/#7406" class="Function Operator">`,</a> <a id="15903" href="/Denotational/#7714" class="Function">last</a> <a id="15908" href="/Soundness/#15822" class="Bound">δ</a><a id="15909" class="Symbol">)</a> <a id="15911" href="/Denotational/#9519" class="Datatype Operator">⊢</a> <a id="15913" href="/Soundness/#15806" class="Bound">M</a> <a id="15915" href="/Denotational/#9519" class="Datatype Operator">↓</a> <a id="15917" href="/Soundness/#15840" class="Bound">v</a>
<a id="15919" href="/Soundness/#15791" class="Function">split</a> <a id="15925" class="Symbol">{</a><a id="15926" class="Argument">δ</a> <a id="15928" class="Symbol">=</a> <a id="15930" href="/Soundness/#15930" class="Bound">δ</a><a id="15931" class="Symbol">}</a> <a id="15933" href="/Soundness/#15933" class="Bound">δMv</a> <a id="15937" class="Keyword">rewrite</a> <a id="15945" href="/Denotational/#7763" class="Function">init-last</a> <a id="15955" href="/Soundness/#15930" class="Bound">δ</a> <a id="15957" class="Symbol">=</a> <a id="15959" href="/Soundness/#15933" class="Bound">δMv</a>

<a id="subst-reflect"></a><a id="15964" href="/Soundness/#15964" class="Function">subst-reflect</a> <a id="15978" class="Symbol">:</a> <a id="15980" class="Symbol">∀</a> <a id="15982" class="Symbol">{</a><a id="15983" href="/Soundness/#15983" class="Bound">Γ</a> <a id="15985" href="/Soundness/#15985" class="Bound">Δ</a><a id="15986" class="Symbol">}</a> <a id="15988" class="Symbol">{</a><a id="15989" href="/Soundness/#15989" class="Bound">δ</a> <a id="15991" class="Symbol">:</a> <a id="15993" href="/Denotational/#7233" class="Function">Env</a> <a id="15997" href="/Soundness/#15985" class="Bound">Δ</a><a id="15998" class="Symbol">}</a> <a id="16000" class="Symbol">{</a><a id="16001" href="/Soundness/#16001" class="Bound">M</a> <a id="16003" class="Symbol">:</a> <a id="16005" href="/Soundness/#15983" class="Bound">Γ</a> <a id="16007" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="16009" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="16010" class="Symbol">}</a> <a id="16012" class="Symbol">{</a><a id="16013" href="/Soundness/#16013" class="Bound">v</a><a id="16014" class="Symbol">}</a> <a id="16016" class="Symbol">{</a><a id="16017" href="/Soundness/#16017" class="Bound">L</a> <a id="16019" class="Symbol">:</a> <a id="16021" href="/Soundness/#15985" class="Bound">Δ</a> <a id="16023" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="16025" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="16026" class="Symbol">}</a> <a id="16028" class="Symbol">{</a><a id="16029" href="/Soundness/#16029" class="Bound">σ</a> <a id="16031" class="Symbol">:</a> <a id="16033" href="/Substitution/#2504" class="Function">Subst</a> <a id="16039" href="/Soundness/#15983" class="Bound">Γ</a> <a id="16041" href="/Soundness/#15985" class="Bound">Δ</a><a id="16042" class="Symbol">}</a>
  <a id="16046" class="Symbol">→</a> <a id="16048" href="/Soundness/#15989" class="Bound">δ</a> <a id="16050" href="/Denotational/#9519" class="Datatype Operator">⊢</a> <a id="16052" href="/Soundness/#16017" class="Bound">L</a> <a id="16054" href="/Denotational/#9519" class="Datatype Operator">↓</a> <a id="16056" href="/Soundness/#16013" class="Bound">v</a>
  <a id="16060" class="Symbol">→</a> <a id="16062" href="/Untyped/#6931" class="Function">subst</a> <a id="16068" href="/Soundness/#16029" class="Bound">σ</a> <a id="16070" href="/Soundness/#16001" class="Bound">M</a> <a id="16072" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Equality.html#83" class="Datatype Operator">≡</a> <a id="16074" href="/Soundness/#16017" class="Bound">L</a>
    <a id="16080" class="Comment">---------------------------------------</a>
  <a id="16122" class="Symbol">→</a> <a id="16124" href="https://agda.github.io/agda-stdlib/v0.17/Data.Product.html#764" class="Function">Σ[</a> <a id="16127" href="/Soundness/#16127" class="Bound">γ</a> <a id="16129" href="https://agda.github.io/agda-stdlib/v0.17/Data.Product.html#764" class="Function">∈</a> <a id="16131" href="/Denotational/#7233" class="Function">Env</a> <a id="16135" href="/Soundness/#15983" class="Bound">Γ</a> <a id="16137" href="https://agda.github.io/agda-stdlib/v0.17/Data.Product.html#764" class="Function">]</a> <a id="16139" href="/Soundness/#15989" class="Bound">δ</a> <a id="16141" href="/Soundness/#3272" class="Function Operator">`⊢</a> <a id="16144" href="/Soundness/#16029" class="Bound">σ</a> <a id="16146" href="/Soundness/#3272" class="Function Operator">↓</a> <a id="16148" href="/Soundness/#16127" class="Bound">γ</a>  <a id="16151" href="https://agda.github.io/agda-stdlib/v0.17/Data.Product.html#1353" class="Function Operator">×</a>  <a id="16154" href="/Soundness/#16127" class="Bound">γ</a> <a id="16156" href="/Denotational/#9519" class="Datatype Operator">⊢</a> <a id="16158" href="/Soundness/#16001" class="Bound">M</a> <a id="16160" href="/Denotational/#9519" class="Datatype Operator">↓</a> <a id="16162" href="/Soundness/#16013" class="Bound">v</a>

<a id="16165" href="/Soundness/#15964" class="Function">subst-reflect</a> <a id="16179" class="Symbol">{</a><a id="16180" class="Argument">M</a> <a id="16182" class="Symbol">=</a> <a id="16184" href="/Soundness/#16184" class="Bound">M</a><a id="16185" class="Symbol">}{</a><a id="16187" class="Argument">σ</a> <a id="16189" class="Symbol">=</a> <a id="16191" href="/Soundness/#16191" class="Bound">σ</a><a id="16192" class="Symbol">}</a> <a id="16194" class="Symbol">(</a><a id="16195" href="/Denotational/#9573" class="InductiveConstructor">var</a> <a id="16199" class="Symbol">{</a><a id="16200" class="Argument">x</a> <a id="16202" class="Symbol">=</a> <a id="16204" href="/Soundness/#16204" class="Bound">y</a><a id="16205" class="Symbol">})</a> <a id="16208" href="/Soundness/#16208" class="Bound">eqL</a> <a id="16212" class="Keyword">with</a> <a id="16217" href="/Soundness/#16184" class="Bound">M</a>
<a id="16219" class="Symbol">...</a> <a id="16223" class="Symbol">|</a> <a id="16225" href="/Untyped/#4186" class="InductiveConstructor Operator">`</a> <a id="16227" href="/Soundness/#16227" class="Bound">x</a>  <a id="16230" class="Keyword">with</a> <a id="16235" href="/Denotational/#9573" class="InductiveConstructor">var</a> <a id="16239" class="Symbol">{</a><a id="16240" class="Argument">x</a> <a id="16242" class="Symbol">=</a> <a id="16244" class="Bound">y</a><a id="16245" class="Symbol">}</a>
<a id="16247" class="Symbol">...</a>           <a id="16261" class="Symbol">|</a> <a id="16263" href="/Soundness/#16263" class="Bound">yv</a>  <a id="16267" class="Keyword">rewrite</a> <a id="16275" href="https://agda.github.io/agda-stdlib/v0.17/Relation.Binary.PropositionalEquality.Core.html#838" class="Function">sym</a> <a id="16279" class="Bound">eqL</a> <a id="16283" class="Symbol">=</a> <a id="16285" href="/Soundness/#14014" class="Function">subst-reflect-var</a> <a id="16303" class="Symbol">{</a><a id="16304" class="Argument">σ</a> <a id="16306" class="Symbol">=</a> <a id="16308" class="Bound">σ</a><a id="16309" class="Symbol">}</a> <a id="16311" href="/Soundness/#16263" class="Bound">yv</a>
<a id="16314" href="/Soundness/#15964" class="Function">subst-reflect</a> <a id="16328" class="Symbol">{</a><a id="16329" class="Argument">M</a> <a id="16331" class="Symbol">=</a> <a id="16333" href="/Soundness/#16333" class="Bound">M</a><a id="16334" class="Symbol">}</a> <a id="16336" class="Symbol">(</a><a id="16337" href="/Denotational/#9573" class="InductiveConstructor">var</a> <a id="16341" class="Symbol">{</a><a id="16342" class="Argument">x</a> <a id="16344" class="Symbol">=</a> <a id="16346" href="/Soundness/#16346" class="Bound">y</a><a id="16347" class="Symbol">})</a> <a id="16350" class="Symbol">()</a> <a id="16353" class="Symbol">|</a> <a id="16355" href="/Soundness/#16355" class="Bound">M₁</a> <a id="16358" href="/Untyped/#4298" class="InductiveConstructor Operator">·</a> <a id="16360" href="/Soundness/#16360" class="Bound">M₂</a>
<a id="16363" href="/Soundness/#15964" class="Function">subst-reflect</a> <a id="16377" class="Symbol">{</a><a id="16378" class="Argument">M</a> <a id="16380" class="Symbol">=</a> <a id="16382" href="/Soundness/#16382" class="Bound">M</a><a id="16383" class="Symbol">}</a> <a id="16385" class="Symbol">(</a><a id="16386" href="/Denotational/#9573" class="InductiveConstructor">var</a> <a id="16390" class="Symbol">{</a><a id="16391" class="Argument">x</a> <a id="16393" class="Symbol">=</a> <a id="16395" href="/Soundness/#16395" class="Bound">y</a><a id="16396" class="Symbol">})</a> <a id="16399" class="Symbol">()</a> <a id="16402" class="Symbol">|</a> <a id="16404" href="/Untyped/#4238" class="InductiveConstructor Operator">ƛ</a> <a id="16406" href="/Soundness/#16406" class="Bound">M′</a>

<a id="16410" href="/Soundness/#15964" class="Function">subst-reflect</a> <a id="16424" class="Symbol">{</a><a id="16425" class="Argument">M</a> <a id="16427" class="Symbol">=</a> <a id="16429" href="/Soundness/#16429" class="Bound">M</a><a id="16430" class="Symbol">}{</a><a id="16432" class="Argument">σ</a> <a id="16434" class="Symbol">=</a> <a id="16436" href="/Soundness/#16436" class="Bound">σ</a><a id="16437" class="Symbol">}</a> <a id="16439" class="Symbol">(</a><a id="16440" href="/Denotational/#9652" class="InductiveConstructor">↦-elim</a> <a id="16447" href="/Soundness/#16447" class="Bound">d₁</a> <a id="16450" href="/Soundness/#16450" class="Bound">d₂</a><a id="16452" class="Symbol">)</a> <a id="16454" href="/Soundness/#16454" class="Bound">eqL</a>
         <a id="16467" class="Keyword">with</a> <a id="16472" href="/Soundness/#16429" class="Bound">M</a>
<a id="16474" class="Symbol">...</a>    <a id="16481" class="Symbol">|</a> <a id="16483" href="/Untyped/#4186" class="InductiveConstructor Operator">`</a> <a id="16485" href="/Soundness/#16485" class="Bound">x</a> <a id="16487" class="Keyword">with</a> <a id="16492" href="/Denotational/#9652" class="InductiveConstructor">↦-elim</a> <a id="16499" class="Bound">d₁</a> <a id="16502" class="Bound">d₂</a>
<a id="16505" class="Symbol">...</a>    <a id="16512" class="Symbol">|</a> <a id="16514" href="/Soundness/#16514" class="Bound">d′</a> <a id="16517" class="Keyword">rewrite</a> <a id="16525" href="https://agda.github.io/agda-stdlib/v0.17/Relation.Binary.PropositionalEquality.Core.html#838" class="Function">sym</a> <a id="16529" class="Bound">eqL</a> <a id="16533" class="Symbol">=</a> <a id="16535" href="/Soundness/#14014" class="Function">subst-reflect-var</a> <a id="16553" class="Symbol">{</a><a id="16554" class="Argument">σ</a> <a id="16556" class="Symbol">=</a> <a id="16558" class="Bound">σ</a><a id="16559" class="Symbol">}</a> <a id="16561" href="/Soundness/#16514" class="Bound">d′</a>
<a id="16564" href="/Soundness/#15964" class="Function">subst-reflect</a> <a id="16578" class="Symbol">(</a><a id="16579" href="/Denotational/#9652" class="InductiveConstructor">↦-elim</a> <a id="16586" href="/Soundness/#16586" class="Bound">d₁</a> <a id="16589" href="/Soundness/#16589" class="Bound">d₂</a><a id="16591" class="Symbol">)</a> <a id="16593" class="Symbol">()</a> <a id="16596" class="Symbol">|</a> <a id="16598" href="/Untyped/#4238" class="InductiveConstructor Operator">ƛ</a> <a id="16600" href="/Soundness/#16600" class="Bound">M′</a>
<a id="16603" href="/Soundness/#15964" class="Function">subst-reflect</a><a id="16616" class="Symbol">{</a><a id="16617" href="/Soundness/#16617" class="Bound">Γ</a><a id="16618" class="Symbol">}{</a><a id="16620" href="/Soundness/#16620" class="Bound">Δ</a><a id="16621" class="Symbol">}{</a><a id="16623" href="/Soundness/#16623" class="Bound">γ</a><a id="16624" class="Symbol">}{</a><a id="16626" class="Argument">σ</a> <a id="16628" class="Symbol">=</a> <a id="16630" href="/Soundness/#16630" class="Bound">σ</a><a id="16631" class="Symbol">}</a> <a id="16633" class="Symbol">(</a><a id="16634" href="/Denotational/#9652" class="InductiveConstructor">↦-elim</a> <a id="16641" href="/Soundness/#16641" class="Bound">d₁</a> <a id="16644" href="/Soundness/#16644" class="Bound">d₂</a><a id="16646" class="Symbol">)</a>
   <a id="16651" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a> <a id="16656" class="Symbol">|</a> <a id="16658" href="/Soundness/#16658" class="Bound">M₁</a> <a id="16661" href="/Untyped/#4298" class="InductiveConstructor Operator">·</a> <a id="16663" href="/Soundness/#16663" class="Bound">M₂</a>
     <a id="16671" class="Keyword">with</a> <a id="16676" href="/Soundness/#15964" class="Function">subst-reflect</a> <a id="16690" class="Symbol">{</a><a id="16691" class="Argument">M</a> <a id="16693" class="Symbol">=</a> <a id="16695" href="/Soundness/#16658" class="Bound">M₁</a><a id="16697" class="Symbol">}</a> <a id="16699" href="/Soundness/#16641" class="Bound">d₁</a> <a id="16702" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a> <a id="16707" class="Symbol">|</a> <a id="16709" href="/Soundness/#15964" class="Function">subst-reflect</a> <a id="16723" class="Symbol">{</a><a id="16724" class="Argument">M</a> <a id="16726" class="Symbol">=</a> <a id="16728" href="/Soundness/#16663" class="Bound">M₂</a><a id="16730" class="Symbol">}</a> <a id="16732" href="/Soundness/#16644" class="Bound">d₂</a> <a id="16735" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a>
<a id="16740" class="Symbol">...</a>     <a id="16748" class="Symbol">|</a> <a id="16750" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="16752" href="/Soundness/#16752" class="Bound">δ₁</a> <a id="16755" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="16757" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="16759" href="/Soundness/#16759" class="Bound">subst-δ₁</a> <a id="16768" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="16770" href="/Soundness/#16770" class="Bound">m1</a> <a id="16773" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="16775" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="16777" class="Symbol">|</a> <a id="16779" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="16781" href="/Soundness/#16781" class="Bound">δ₂</a> <a id="16784" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="16786" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="16788" href="/Soundness/#16788" class="Bound">subst-δ₂</a> <a id="16797" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="16799" href="/Soundness/#16799" class="Bound">m2</a> <a id="16802" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="16804" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="16806" class="Symbol">=</a>
     <a id="16813" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="16815" href="/Soundness/#16752" class="Bound">δ₁</a> <a id="16818" href="/Denotational/#8507" class="Function Operator">`⊔</a> <a id="16821" href="/Soundness/#16781" class="Bound">δ₂</a> <a id="16824" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="16826" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="16828" href="/Soundness/#14941" class="Function">subst-⊔</a> <a id="16836" class="Symbol">{</a><a id="16837" class="Argument">γ₁</a> <a id="16840" class="Symbol">=</a> <a id="16842" href="/Soundness/#16752" class="Bound">δ₁</a><a id="16844" class="Symbol">}{</a><a id="16846" class="Argument">γ₂</a> <a id="16849" class="Symbol">=</a> <a id="16851" href="/Soundness/#16781" class="Bound">δ₂</a><a id="16853" class="Symbol">}{</a><a id="16855" class="Argument">σ</a> <a id="16857" class="Symbol">=</a> <a id="16859" class="Bound">σ</a><a id="16860" class="Symbol">}</a> <a id="16862" href="/Soundness/#16759" class="Bound">subst-δ₁</a> <a id="16871" href="/Soundness/#16788" class="Bound">subst-δ₂</a> <a id="16880" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a>
                    <a id="16902" href="/Denotational/#9652" class="InductiveConstructor">↦-elim</a> <a id="16909" class="Symbol">(</a><a id="16910" href="/Denotational/#25541" class="Function">Env⊑</a> <a id="16915" href="/Soundness/#16770" class="Bound">m1</a> <a id="16918" class="Symbol">(</a><a id="16919" href="/Denotational/#8845" class="Function">EnvConjR1⊑</a> <a id="16930" href="/Soundness/#16752" class="Bound">δ₁</a> <a id="16933" href="/Soundness/#16781" class="Bound">δ₂</a><a id="16935" class="Symbol">))</a>
                           <a id="16965" class="Symbol">(</a><a id="16966" href="/Denotational/#25541" class="Function">Env⊑</a> <a id="16971" href="/Soundness/#16799" class="Bound">m2</a> <a id="16974" class="Symbol">(</a><a id="16975" href="/Denotational/#8942" class="Function">EnvConjR2⊑</a> <a id="16986" href="/Soundness/#16752" class="Bound">δ₁</a> <a id="16989" href="/Soundness/#16781" class="Bound">δ₂</a><a id="16991" class="Symbol">))</a> <a id="16994" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="16996" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a>

<a id="16999" href="/Soundness/#15964" class="Function">subst-reflect</a> <a id="17013" class="Symbol">{</a><a id="17014" class="Argument">M</a> <a id="17016" class="Symbol">=</a> <a id="17018" href="/Soundness/#17018" class="Bound">M</a><a id="17019" class="Symbol">}{</a><a id="17021" class="Argument">σ</a> <a id="17023" class="Symbol">=</a> <a id="17025" href="/Soundness/#17025" class="Bound">σ</a><a id="17026" class="Symbol">}</a> <a id="17028" class="Symbol">(</a><a id="17029" href="/Denotational/#9790" class="InductiveConstructor">↦-intro</a> <a id="17037" href="/Soundness/#17037" class="Bound">d</a><a id="17038" class="Symbol">)</a> <a id="17040" href="/Soundness/#17040" class="Bound">eqL</a> <a id="17044" class="Keyword">with</a> <a id="17049" href="/Soundness/#17018" class="Bound">M</a>
<a id="17051" class="Symbol">...</a>    <a id="17058" class="Symbol">|</a> <a id="17060" href="/Untyped/#4186" class="InductiveConstructor Operator">`</a> <a id="17062" href="/Soundness/#17062" class="Bound">x</a> <a id="17064" class="Keyword">with</a> <a id="17069" class="Symbol">(</a><a id="17070" href="/Denotational/#9790" class="InductiveConstructor">↦-intro</a> <a id="17078" class="Bound">d</a><a id="17079" class="Symbol">)</a>
<a id="17081" class="Symbol">...</a>             <a id="17097" class="Symbol">|</a> <a id="17099" href="/Soundness/#17099" class="Bound">d′</a> <a id="17102" class="Keyword">rewrite</a> <a id="17110" href="https://agda.github.io/agda-stdlib/v0.17/Relation.Binary.PropositionalEquality.Core.html#838" class="Function">sym</a> <a id="17114" class="Bound">eqL</a> <a id="17118" class="Symbol">=</a> <a id="17120" href="/Soundness/#14014" class="Function">subst-reflect-var</a> <a id="17138" class="Symbol">{</a><a id="17139" class="Argument">σ</a> <a id="17141" class="Symbol">=</a> <a id="17143" class="Bound">σ</a><a id="17144" class="Symbol">}</a> <a id="17146" href="/Soundness/#17099" class="Bound">d′</a>
<a id="17149" href="/Soundness/#15964" class="Function">subst-reflect</a> <a id="17163" class="Symbol">{</a><a id="17164" class="Argument">σ</a> <a id="17166" class="Symbol">=</a> <a id="17168" href="/Soundness/#17168" class="Bound">σ</a><a id="17169" class="Symbol">}</a> <a id="17171" class="Symbol">(</a><a id="17172" href="/Denotational/#9790" class="InductiveConstructor">↦-intro</a> <a id="17180" href="/Soundness/#17180" class="Bound">d</a><a id="17181" class="Symbol">)</a> <a id="17183" href="/Soundness/#17183" class="Bound">eq</a> <a id="17186" class="Symbol">|</a> <a id="17188" href="/Untyped/#4238" class="InductiveConstructor Operator">ƛ</a> <a id="17190" href="/Soundness/#17190" class="Bound">M′</a>
      <a id="17199" class="Keyword">with</a> <a id="17204" href="/Soundness/#15964" class="Function">subst-reflect</a> <a id="17218" class="Symbol">{</a><a id="17219" class="Argument">σ</a> <a id="17221" class="Symbol">=</a> <a id="17223" href="/Untyped/#6623" class="Function">exts</a> <a id="17228" href="/Soundness/#17168" class="Bound">σ</a><a id="17229" class="Symbol">}</a> <a id="17231" href="/Soundness/#17180" class="Bound">d</a> <a id="17233" class="Symbol">(</a><a id="17234" href="/Soundness/#15239" class="Function">lambda-inj</a> <a id="17245" href="/Soundness/#17183" class="Bound">eq</a><a id="17247" class="Symbol">)</a>
<a id="17249" class="Symbol">...</a> <a id="17253" class="Symbol">|</a> <a id="17255" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17257" href="/Soundness/#17257" class="Bound">δ′</a> <a id="17260" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="17262" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17264" href="/Soundness/#17264" class="Bound">exts-σ-δ′</a> <a id="17274" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="17276" href="/Soundness/#17276" class="Bound">m′</a> <a id="17279" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="17281" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="17283" class="Symbol">=</a>
    <a id="17289" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17291" href="/Denotational/#7659" class="Function">init</a> <a id="17296" href="/Soundness/#17257" class="Bound">δ′</a> <a id="17299" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="17301" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17303" class="Symbol">((λ</a> <a id="17307" href="/Soundness/#17307" class="Bound">x</a> <a id="17309" class="Symbol">→</a> <a id="17311" href="/Soundness/#11374" class="Function">rename-inc-reflect</a> <a id="17330" class="Symbol">(</a><a id="17331" href="/Soundness/#17264" class="Bound">exts-σ-δ′</a> <a id="17341" class="Symbol">(</a><a id="17342" href="/Untyped/#3446" class="InductiveConstructor Operator">S</a> <a id="17344" href="/Soundness/#17307" class="Bound">x</a><a id="17345" class="Symbol">))))</a> <a id="17350" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a>
             <a id="17365" href="/Denotational/#9790" class="InductiveConstructor">↦-intro</a> <a id="17373" class="Symbol">(</a><a id="17374" href="/Denotational/#25985" class="Function">up-env</a> <a id="17381" class="Symbol">(</a><a id="17382" href="/Soundness/#15791" class="Function">split</a> <a id="17388" href="/Soundness/#17276" class="Bound">m′</a><a id="17390" class="Symbol">)</a> <a id="17392" class="Symbol">(</a><a id="17393" href="/Compositional/#9866" class="Function">var-inv</a> <a id="17401" class="Symbol">(</a><a id="17402" href="/Soundness/#17264" class="Bound">exts-σ-δ′</a> <a id="17412" href="/Untyped/#3401" class="InductiveConstructor">Z</a><a id="17413" class="Symbol">)))</a> <a id="17417" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="17419" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a>
<a id="17421" href="/Soundness/#15964" class="Function">subst-reflect</a> <a id="17435" class="Symbol">(</a><a id="17436" href="/Denotational/#9790" class="InductiveConstructor">↦-intro</a> <a id="17444" href="/Soundness/#17444" class="Bound">d</a><a id="17445" class="Symbol">)</a> <a id="17447" class="Symbol">()</a> <a id="17450" class="Symbol">|</a> <a id="17452" href="/Soundness/#17452" class="Bound">M₁</a> <a id="17455" href="/Untyped/#4298" class="InductiveConstructor Operator">·</a> <a id="17457" href="/Soundness/#17457" class="Bound">M₂</a>

<a id="17461" href="/Soundness/#15964" class="Function">subst-reflect</a> <a id="17475" class="Symbol">{</a><a id="17476" class="Argument">σ</a> <a id="17478" class="Symbol">=</a> <a id="17480" href="/Soundness/#17480" class="Bound">σ</a><a id="17481" class="Symbol">}</a> <a id="17483" href="/Denotational/#9914" class="InductiveConstructor">⊥-intro</a> <a id="17491" href="/Soundness/#17491" class="Bound">eq</a> <a id="17494" class="Symbol">=</a>
    <a id="17500" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17502" href="/Denotational/#8478" class="Function">`⊥</a> <a id="17505" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="17507" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17509" href="/Soundness/#14671" class="Function">subst-⊥</a> <a id="17517" class="Symbol">{</a><a id="17518" class="Argument">σ</a> <a id="17520" class="Symbol">=</a> <a id="17522" href="/Soundness/#17480" class="Bound">σ</a><a id="17523" class="Symbol">}</a> <a id="17525" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="17527" href="/Denotational/#9914" class="InductiveConstructor">⊥-intro</a> <a id="17535" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="17537" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a>

<a id="17540" href="/Soundness/#15964" class="Function">subst-reflect</a> <a id="17554" class="Symbol">{</a><a id="17555" class="Argument">σ</a> <a id="17557" class="Symbol">=</a> <a id="17559" href="/Soundness/#17559" class="Bound">σ</a><a id="17560" class="Symbol">}</a> <a id="17562" class="Symbol">(</a><a id="17563" href="/Denotational/#9989" class="InductiveConstructor">⊔-intro</a> <a id="17571" href="/Soundness/#17571" class="Bound">d₁</a> <a id="17574" href="/Soundness/#17574" class="Bound">d₂</a><a id="17576" class="Symbol">)</a> <a id="17578" href="/Soundness/#17578" class="Bound">eq</a>
  <a id="17583" class="Keyword">with</a> <a id="17588" href="/Soundness/#15964" class="Function">subst-reflect</a> <a id="17602" class="Symbol">{</a><a id="17603" class="Argument">σ</a> <a id="17605" class="Symbol">=</a> <a id="17607" href="/Soundness/#17559" class="Bound">σ</a><a id="17608" class="Symbol">}</a> <a id="17610" href="/Soundness/#17571" class="Bound">d₁</a> <a id="17613" href="/Soundness/#17578" class="Bound">eq</a> <a id="17616" class="Symbol">|</a> <a id="17618" href="/Soundness/#15964" class="Function">subst-reflect</a> <a id="17632" class="Symbol">{</a><a id="17633" class="Argument">σ</a> <a id="17635" class="Symbol">=</a> <a id="17637" href="/Soundness/#17559" class="Bound">σ</a><a id="17638" class="Symbol">}</a> <a id="17640" href="/Soundness/#17574" class="Bound">d₂</a> <a id="17643" href="/Soundness/#17578" class="Bound">eq</a>
<a id="17646" class="Symbol">...</a> <a id="17650" class="Symbol">|</a> <a id="17652" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17654" href="/Soundness/#17654" class="Bound">δ₁</a> <a id="17657" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="17659" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17661" href="/Soundness/#17661" class="Bound">subst-δ₁</a> <a id="17670" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="17672" href="/Soundness/#17672" class="Bound">m1</a> <a id="17675" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="17677" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="17679" class="Symbol">|</a> <a id="17681" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17683" href="/Soundness/#17683" class="Bound">δ₂</a> <a id="17686" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="17688" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17690" href="/Soundness/#17690" class="Bound">subst-δ₂</a> <a id="17699" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="17701" href="/Soundness/#17701" class="Bound">m2</a> <a id="17704" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="17706" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="17708" class="Symbol">=</a>
     <a id="17715" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17717" href="/Soundness/#17654" class="Bound">δ₁</a> <a id="17720" href="/Denotational/#8507" class="Function Operator">`⊔</a> <a id="17723" href="/Soundness/#17683" class="Bound">δ₂</a> <a id="17726" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="17728" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17730" href="/Soundness/#14941" class="Function">subst-⊔</a> <a id="17738" class="Symbol">{</a><a id="17739" class="Argument">γ₁</a> <a id="17742" class="Symbol">=</a> <a id="17744" href="/Soundness/#17654" class="Bound">δ₁</a><a id="17746" class="Symbol">}{</a><a id="17748" class="Argument">γ₂</a> <a id="17751" class="Symbol">=</a> <a id="17753" href="/Soundness/#17683" class="Bound">δ₂</a><a id="17755" class="Symbol">}{</a><a id="17757" class="Argument">σ</a> <a id="17759" class="Symbol">=</a> <a id="17761" class="Bound">σ</a><a id="17762" class="Symbol">}</a> <a id="17764" href="/Soundness/#17661" class="Bound">subst-δ₁</a> <a id="17773" href="/Soundness/#17690" class="Bound">subst-δ₂</a> <a id="17782" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a>
                    <a id="17804" href="/Denotational/#9989" class="InductiveConstructor">⊔-intro</a> <a id="17812" class="Symbol">(</a><a id="17813" href="/Denotational/#25541" class="Function">Env⊑</a> <a id="17818" href="/Soundness/#17672" class="Bound">m1</a> <a id="17821" class="Symbol">(</a><a id="17822" href="/Denotational/#8845" class="Function">EnvConjR1⊑</a> <a id="17833" href="/Soundness/#17654" class="Bound">δ₁</a> <a id="17836" href="/Soundness/#17683" class="Bound">δ₂</a><a id="17838" class="Symbol">))</a>
                            <a id="17869" class="Symbol">(</a><a id="17870" href="/Denotational/#25541" class="Function">Env⊑</a> <a id="17875" href="/Soundness/#17701" class="Bound">m2</a> <a id="17878" class="Symbol">(</a><a id="17879" href="/Denotational/#8942" class="Function">EnvConjR2⊑</a> <a id="17890" href="/Soundness/#17654" class="Bound">δ₁</a> <a id="17893" href="/Soundness/#17683" class="Bound">δ₂</a><a id="17895" class="Symbol">))</a> <a id="17898" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="17900" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a>
<a id="17902" href="/Soundness/#15964" class="Function">subst-reflect</a> <a id="17916" class="Symbol">(</a><a id="17917" href="/Denotational/#10120" class="InductiveConstructor">sub</a> <a id="17921" href="/Soundness/#17921" class="Bound">d</a> <a id="17923" href="/Soundness/#17923" class="Bound">lt</a><a id="17925" class="Symbol">)</a> <a id="17927" href="/Soundness/#17927" class="Bound">eq</a>
    <a id="17934" class="Keyword">with</a> <a id="17939" href="/Soundness/#15964" class="Function">subst-reflect</a> <a id="17953" href="/Soundness/#17921" class="Bound">d</a> <a id="17955" href="/Soundness/#17927" class="Bound">eq</a>
<a id="17958" class="Symbol">...</a> <a id="17962" class="Symbol">|</a> <a id="17964" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17966" href="/Soundness/#17966" class="Bound">δ</a> <a id="17968" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="17970" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17972" href="/Soundness/#17972" class="Bound">subst-δ</a> <a id="17980" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="17982" href="/Soundness/#17982" class="Bound">m</a> <a id="17984" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="17986" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="17988" class="Symbol">=</a> <a id="17990" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17992" href="/Soundness/#17966" class="Bound">δ</a> <a id="17994" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="17996" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17998" href="/Soundness/#17972" class="Bound">subst-δ</a> <a id="18006" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="18008" href="/Denotational/#10120" class="InductiveConstructor">sub</a> <a id="18012" href="/Soundness/#17982" class="Bound">m</a> <a id="18014" class="Bound">lt</a> <a id="18017" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="18019" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a></pre>

<ul>
  <li>
    <p>Case <code class="highlighter-rouge">var</code>: We have subst <code class="highlighter-rouge">σ M ≡ y</code>, so <code class="highlighter-rouge">M</code> must also be a variable, say <code class="highlighter-rouge">x</code>.
We apply the lemma <code class="highlighter-rouge">subst-reflect-var</code> to conclude.</p>
  </li>
  <li>Case <code class="highlighter-rouge">↦-elim</code>: We have <code class="highlighter-rouge">subst σ M ≡ L₁ · L₂</code>. We proceed by cases on <code class="highlighter-rouge">M</code>.
    <ul>
      <li>
        <p>Case <code class="highlighter-rouge">M ≡ x</code>: We apply the <code class="highlighter-rouge">subst-reflect-var</code> lemma again to conclude.</p>
      </li>
      <li>
        <p>Case <code class="highlighter-rouge">M ≡ M₁ · M₂</code>: By the induction hypothesis, we have
some <code class="highlighter-rouge">δ₁</code> and <code class="highlighter-rouge">δ₂</code> such that <code class="highlighter-rouge">δ₁ ⊢ M₁ ↓ v₁ ↦ v₃</code> and <code class="highlighter-rouge">γ ⊢ σ ↓ δ₁</code>,
as well as <code class="highlighter-rouge">δ₂ ⊢ M₂ ↓ v₁</code> and <code class="highlighter-rouge">γ ⊢ σ ↓ δ₂</code>.
By <code class="highlighter-rouge">Env⊑</code> we have <code class="highlighter-rouge">δ₁ ⊔ δ₂ ⊢ M₁ ↓ v₁ ↦ v₃</code> and <code class="highlighter-rouge">δ₁ ⊔ δ₂ ⊢ M₂ ↓ v₁</code>
(using <code class="highlighter-rouge">EnvConjR1⊑</code> and <code class="highlighter-rouge">EnvConjR2⊑</code>), and therefore
<code class="highlighter-rouge">δ₁ ⊔ δ₂ ⊢ M₁ · M₂ ↓ v₃</code>.
We conclude this case by obtaining <code class="highlighter-rouge">γ ⊢ σ ↓ δ₁ ⊔ δ₂</code>
by the <code class="highlighter-rouge">subst-⊔</code> lemma.</p>
      </li>
    </ul>
  </li>
  <li>Case <code class="highlighter-rouge">↦-intro</code>: We have <code class="highlighter-rouge">subst σ M ≡ ƛ L′</code>. We proceed by cases on <code class="highlighter-rouge">M</code>.
    <ul>
      <li>
        <p>Case <code class="highlighter-rouge">M ≡ x</code>: We apply the <code class="highlighter-rouge">subst-reflect-var</code> lemma.</p>
      </li>
      <li>
        <p>Case <code class="highlighter-rouge">M ≡ ƛ M′</code>: By the induction hypothesis, we have
<code class="highlighter-rouge">(δ′ , v′) ⊢ M′ ↓ v₂</code> and <code class="highlighter-rouge">(δ , v₁) ⊢ exts σ ↓ (δ′ , v′)</code>.
From the later we have <code class="highlighter-rouge">(δ , v₁) ⊢ # 0 ↓ v′</code>.
By the lemma <code class="highlighter-rouge">var-inv</code> we have <code class="highlighter-rouge">v′ ⊑ v₁</code>, so by the <code class="highlighter-rouge">up-env</code> lemma we
have <code class="highlighter-rouge">(δ′ , v₁) ⊢ M′ ↓ v₂</code> and therefore <code class="highlighter-rouge">δ′ ⊢ ƛ M′ ↓ v₁ → v₂</code>.  We
also need to show that <code class="highlighter-rouge">δ </code>⊢ σ ↓ δ′<code class="highlighter-rouge">.  Fix </code>k<code class="highlighter-rouge">. We have
</code>(δ , v₁) ⊢ rename S_ σ k ↓ nth k δ′<code class="highlighter-rouge">.  We then apply the lemma
</code>rename-inc-reflect<code class="highlighter-rouge"> to obtain </code>δ ⊢ σ k ↓ nth k δ′`, so this case is
complete.</p>
      </li>
    </ul>
  </li>
  <li>
    <p>Case <code class="highlighter-rouge">⊥-intro</code>: We choose <code class="highlighter-rouge">⊥</code> for <code class="highlighter-rouge">δ</code>.
We have <code class="highlighter-rouge">⊥ ⊢ M ↓ ⊥</code> by <code class="highlighter-rouge">⊥-intro</code>.
We have <code class="highlighter-rouge">δ ⊢ σ ↓ ⊥</code> by the lemma <code class="highlighter-rouge">subst-empty</code>.</p>
  </li>
  <li>Case <code class="highlighter-rouge">⊔-intro</code>: By the induction hypothesis we have
<code class="highlighter-rouge">δ₁ ⊢ M ↓ v₁</code>, <code class="highlighter-rouge">δ₂ ⊢ M ↓ v₂</code>, <code class="highlighter-rouge">δ ⊢ σ ↓ δ₁</code>, and <code class="highlighter-rouge">δ ⊢ σ ↓ δ₂</code>.
We have <code class="highlighter-rouge">δ₁ ⊔ δ₂ ⊢ M ↓ v₁</code> and <code class="highlighter-rouge">δ₁ ⊔ δ₂ ⊢ M ↓ v₂</code>
by <code class="highlighter-rouge">Env⊑</code> with <code class="highlighter-rouge">EnvConjR1⊑</code> and <code class="highlighter-rouge">EnvConjR2⊑</code>.
So by <code class="highlighter-rouge">⊔-intro</code> we have <code class="highlighter-rouge">δ₁ ⊔ δ₂ ⊢ M ↓ v₁ ⊔ v₂</code>.
By <code class="highlighter-rouge">subst-⊔</code> we conclude that <code class="highlighter-rouge">δ ⊢ σ ↓ δ₁ ⊔ δ₂</code>.</li>
</ul>

<h3 id="single-substitution-reflects-denotations">Single substitution reflects denotations</h3>

<p>Most of the work is now behind us. We have proved that simultaneous
substitution reflects denotations. Of course, β reduction uses single
substitution, so we need a corollary that proves that single
substitution reflects denotations. That is,
given terms <code class="highlighter-rouge">N : (Γ , ★ ⊢ ★)</code> and <code class="highlighter-rouge">M : (Γ ⊢ ★)</code>,
if <code class="highlighter-rouge">γ ⊢ N [ M ] ↓ w</code>, then <code class="highlighter-rouge">γ ⊢ M ↓ v</code> and <code class="highlighter-rouge">(γ , v) ⊢ N ↓ w</code>
for some value <code class="highlighter-rouge">v</code>. We have <code class="highlighter-rouge">N [ M ] = subst (subst-zero M) N</code>.</p>

<p>We first prove a lemma about <code class="highlighter-rouge">subst-zero</code>, that if
<code class="highlighter-rouge">δ ⊢ subst-zero M ↓ γ</code>, then
<code class="highlighter-rouge">γ ⊑ (δ , w) × δ ⊢ M ↓ w</code> for some <code class="highlighter-rouge">w</code>.</p>

<pre class="Agda"><a id="subst-zero-reflect"></a><a id="20459" href="/Soundness/#20459" class="Function">subst-zero-reflect</a> <a id="20478" class="Symbol">:</a> <a id="20480" class="Symbol">∀</a> <a id="20482" class="Symbol">{</a><a id="20483" href="/Soundness/#20483" class="Bound">Δ</a><a id="20484" class="Symbol">}</a> <a id="20486" class="Symbol">{</a><a id="20487" href="/Soundness/#20487" class="Bound">δ</a> <a id="20489" class="Symbol">:</a> <a id="20491" href="/Denotational/#7233" class="Function">Env</a> <a id="20495" href="/Soundness/#20483" class="Bound">Δ</a><a id="20496" class="Symbol">}</a> <a id="20498" class="Symbol">{</a><a id="20499" href="/Soundness/#20499" class="Bound">γ</a> <a id="20501" class="Symbol">:</a> <a id="20503" href="/Denotational/#7233" class="Function">Env</a> <a id="20507" class="Symbol">(</a><a id="20508" href="/Soundness/#20483" class="Bound">Δ</a> <a id="20510" href="/Untyped/#3018" class="InductiveConstructor Operator">,</a> <a id="20512" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="20513" class="Symbol">)}</a> <a id="20516" class="Symbol">{</a><a id="20517" href="/Soundness/#20517" class="Bound">M</a> <a id="20519" class="Symbol">:</a> <a id="20521" href="/Soundness/#20483" class="Bound">Δ</a> <a id="20523" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="20525" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="20526" class="Symbol">}</a>
  <a id="20530" class="Symbol">→</a> <a id="20532" href="/Soundness/#20487" class="Bound">δ</a> <a id="20534" href="/Soundness/#3272" class="Function Operator">`⊢</a> <a id="20537" href="/Untyped/#7359" class="Function">subst-zero</a> <a id="20548" href="/Soundness/#20517" class="Bound">M</a> <a id="20550" href="/Soundness/#3272" class="Function Operator">↓</a> <a id="20552" href="/Soundness/#20499" class="Bound">γ</a>
    <a id="20558" class="Comment">----------------------------------------</a>
  <a id="20601" class="Symbol">→</a> <a id="20603" href="https://agda.github.io/agda-stdlib/v0.17/Data.Product.html#764" class="Function">Σ[</a> <a id="20606" href="/Soundness/#20606" class="Bound">w</a> <a id="20608" href="https://agda.github.io/agda-stdlib/v0.17/Data.Product.html#764" class="Function">∈</a> <a id="20610" href="/Denotational/#3999" class="Datatype">Value</a> <a id="20616" href="https://agda.github.io/agda-stdlib/v0.17/Data.Product.html#764" class="Function">]</a> <a id="20618" href="/Soundness/#20499" class="Bound">γ</a> <a id="20620" href="/Denotational/#8259" class="Function Operator">`⊑</a> <a id="20623" class="Symbol">(</a><a id="20624" href="/Soundness/#20487" class="Bound">δ</a> <a id="20626" href="/Denotational/#7406" class="Function Operator">`,</a> <a id="20629" href="/Soundness/#20606" class="Bound">w</a><a id="20630" class="Symbol">)</a> <a id="20632" href="https://agda.github.io/agda-stdlib/v0.17/Data.Product.html#1353" class="Function Operator">×</a> <a id="20634" href="/Soundness/#20487" class="Bound">δ</a> <a id="20636" href="/Denotational/#9519" class="Datatype Operator">⊢</a> <a id="20638" href="/Soundness/#20517" class="Bound">M</a> <a id="20640" href="/Denotational/#9519" class="Datatype Operator">↓</a> <a id="20642" href="/Soundness/#20606" class="Bound">w</a>
<a id="20644" href="/Soundness/#20459" class="Function">subst-zero-reflect</a> <a id="20663" class="Symbol">{</a><a id="20664" class="Argument">δ</a> <a id="20666" class="Symbol">=</a> <a id="20668" href="/Soundness/#20668" class="Bound">δ</a><a id="20669" class="Symbol">}</a> <a id="20671" class="Symbol">{</a><a id="20672" class="Argument">γ</a> <a id="20674" class="Symbol">=</a> <a id="20676" href="/Soundness/#20676" class="Bound">γ</a><a id="20677" class="Symbol">}</a> <a id="20679" href="/Soundness/#20679" class="Bound">δσγ</a> <a id="20683" class="Symbol">=</a> <a id="20685" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="20687" href="/Denotational/#7714" class="Function">last</a> <a id="20692" href="/Soundness/#20676" class="Bound">γ</a> <a id="20694" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="20696" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="20698" href="/Soundness/#20726" class="Function">lemma</a> <a id="20704" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="20706" href="/Soundness/#20679" class="Bound">δσγ</a> <a id="20710" href="/Untyped/#3401" class="InductiveConstructor">Z</a> <a id="20712" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="20714" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a>
  <a id="20718" class="Keyword">where</a>
  <a id="20726" href="/Soundness/#20726" class="Function">lemma</a> <a id="20732" class="Symbol">:</a> <a id="20734" href="/Soundness/#20676" class="Bound">γ</a> <a id="20736" href="/Denotational/#8259" class="Function Operator">`⊑</a> <a id="20739" class="Symbol">(</a><a id="20740" href="/Soundness/#20668" class="Bound">δ</a> <a id="20742" href="/Denotational/#7406" class="Function Operator">`,</a> <a id="20745" href="/Denotational/#7714" class="Function">last</a> <a id="20750" href="/Soundness/#20676" class="Bound">γ</a><a id="20751" class="Symbol">)</a>
  <a id="20755" href="/Soundness/#20726" class="Function">lemma</a> <a id="20761" href="/Untyped/#3401" class="InductiveConstructor">Z</a>  <a id="20764" class="Symbol">=</a>  <a id="20767" href="/Denotational/#5540" class="Function">Refl⊑</a>
  <a id="20775" href="/Soundness/#20726" class="Function">lemma</a> <a id="20781" class="Symbol">(</a><a id="20782" href="/Untyped/#3446" class="InductiveConstructor Operator">S</a> <a id="20784" href="/Soundness/#20784" class="Bound">x</a><a id="20785" class="Symbol">)</a> <a id="20787" class="Symbol">=</a> <a id="20789" href="/Compositional/#9866" class="Function">var-inv</a> <a id="20797" class="Symbol">(</a><a id="20798" href="/Soundness/#20679" class="Bound">δσγ</a> <a id="20802" class="Symbol">(</a><a id="20803" href="/Untyped/#3446" class="InductiveConstructor Operator">S</a> <a id="20805" href="/Soundness/#20784" class="Bound">x</a><a id="20806" class="Symbol">))</a></pre>

<p>We choose <code class="highlighter-rouge">w</code> to be the last value in <code class="highlighter-rouge">γ</code> and we obtain <code class="highlighter-rouge">δ ⊢ M ↓ w</code>
by applying the premise to variable <code class="highlighter-rouge">Z</code>. Finally, to prove
<code class="highlighter-rouge">γ ⊑ (δ , w)</code>, we prove a lemma by induction in the input variable.
The base case is trivial because of our choice of <code class="highlighter-rouge">w</code>.
In the induction case, <code class="highlighter-rouge">S x</code>, the premise
<code class="highlighter-rouge">δ ⊢ subst-zero M ↓ γ</code> gives us <code class="highlighter-rouge">δ ⊢ x ↓ γ (S x)</code> and then
using <code class="highlighter-rouge">var-inv</code> we conclude that <code class="highlighter-rouge">γ (S x) ⊑ (δ </code>, w) (S x)`.</p>

<p>Now to prove that substitution reflects denotations.</p>

<pre class="Agda"><a id="substitution-reflect"></a><a id="21301" href="/Soundness/#21301" class="Function">substitution-reflect</a> <a id="21322" class="Symbol">:</a> <a id="21324" class="Symbol">∀</a> <a id="21326" class="Symbol">{</a><a id="21327" href="/Soundness/#21327" class="Bound">Δ</a><a id="21328" class="Symbol">}</a> <a id="21330" class="Symbol">{</a><a id="21331" href="/Soundness/#21331" class="Bound">δ</a> <a id="21333" class="Symbol">:</a> <a id="21335" href="/Denotational/#7233" class="Function">Env</a> <a id="21339" href="/Soundness/#21327" class="Bound">Δ</a><a id="21340" class="Symbol">}</a> <a id="21342" class="Symbol">{</a><a id="21343" href="/Soundness/#21343" class="Bound">N</a> <a id="21345" class="Symbol">:</a> <a id="21347" href="/Soundness/#21327" class="Bound">Δ</a> <a id="21349" href="/Untyped/#3018" class="InductiveConstructor Operator">,</a> <a id="21351" href="/Untyped/#2694" class="InductiveConstructor">★</a> <a id="21353" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="21355" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="21356" class="Symbol">}</a> <a id="21358" class="Symbol">{</a><a id="21359" href="/Soundness/#21359" class="Bound">M</a> <a id="21361" class="Symbol">:</a> <a id="21363" href="/Soundness/#21327" class="Bound">Δ</a> <a id="21365" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="21367" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="21368" class="Symbol">}</a> <a id="21370" class="Symbol">{</a><a id="21371" href="/Soundness/#21371" class="Bound">v</a><a id="21372" class="Symbol">}</a>
  <a id="21376" class="Symbol">→</a> <a id="21378" href="/Soundness/#21331" class="Bound">δ</a> <a id="21380" href="/Denotational/#9519" class="Datatype Operator">⊢</a> <a id="21382" href="/Soundness/#21343" class="Bound">N</a> <a id="21384" href="/Untyped/#7475" class="Function Operator">[</a> <a id="21386" href="/Soundness/#21359" class="Bound">M</a> <a id="21388" href="/Untyped/#7475" class="Function Operator">]</a> <a id="21390" href="/Denotational/#9519" class="Datatype Operator">↓</a> <a id="21392" href="/Soundness/#21371" class="Bound">v</a>
    <a id="21398" class="Comment">------------------------------------------------</a>
  <a id="21449" class="Symbol">→</a> <a id="21451" href="https://agda.github.io/agda-stdlib/v0.17/Data.Product.html#764" class="Function">Σ[</a> <a id="21454" href="/Soundness/#21454" class="Bound">w</a> <a id="21456" href="https://agda.github.io/agda-stdlib/v0.17/Data.Product.html#764" class="Function">∈</a> <a id="21458" href="/Denotational/#3999" class="Datatype">Value</a> <a id="21464" href="https://agda.github.io/agda-stdlib/v0.17/Data.Product.html#764" class="Function">]</a> <a id="21466" href="/Soundness/#21331" class="Bound">δ</a> <a id="21468" href="/Denotational/#9519" class="Datatype Operator">⊢</a> <a id="21470" href="/Soundness/#21359" class="Bound">M</a> <a id="21472" href="/Denotational/#9519" class="Datatype Operator">↓</a> <a id="21474" href="/Soundness/#21454" class="Bound">w</a>  <a id="21477" href="https://agda.github.io/agda-stdlib/v0.17/Data.Product.html#1353" class="Function Operator">×</a>  <a id="21480" class="Symbol">(</a><a id="21481" href="/Soundness/#21331" class="Bound">δ</a> <a id="21483" href="/Denotational/#7406" class="Function Operator">`,</a> <a id="21486" href="/Soundness/#21454" class="Bound">w</a><a id="21487" class="Symbol">)</a> <a id="21489" href="/Denotational/#9519" class="Datatype Operator">⊢</a> <a id="21491" href="/Soundness/#21343" class="Bound">N</a> <a id="21493" href="/Denotational/#9519" class="Datatype Operator">↓</a> <a id="21495" href="/Soundness/#21371" class="Bound">v</a>
<a id="21497" href="/Soundness/#21301" class="Function">substitution-reflect</a> <a id="21518" href="/Soundness/#21518" class="Bound">d</a> <a id="21520" class="Keyword">with</a> <a id="21525" href="/Soundness/#15964" class="Function">subst-reflect</a> <a id="21539" href="/Soundness/#21518" class="Bound">d</a> <a id="21541" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a>
<a id="21546" class="Symbol">...</a>  <a id="21551" class="Symbol">|</a> <a id="21553" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="21555" href="/Soundness/#21555" class="Bound">γ</a> <a id="21557" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="21559" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="21561" href="/Soundness/#21561" class="Bound">δσγ</a> <a id="21565" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="21567" href="/Soundness/#21567" class="Bound">γNv</a> <a id="21571" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="21573" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="21575" class="Keyword">with</a> <a id="21580" href="/Soundness/#20459" class="Function">subst-zero-reflect</a> <a id="21599" href="/Soundness/#21561" class="Bound">δσγ</a>
<a id="21603" class="Symbol">...</a>    <a id="21610" class="Symbol">|</a> <a id="21612" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="21614" href="/Soundness/#21614" class="Bound">w</a> <a id="21616" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="21618" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="21620" href="/Soundness/#21620" class="Bound">ineq</a> <a id="21625" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="21627" href="/Soundness/#21627" class="Bound">δMw</a> <a id="21631" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="21633" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="21635" class="Symbol">=</a> <a id="21637" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="21639" href="/Soundness/#21614" class="Bound">w</a> <a id="21641" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="21643" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="21645" href="/Soundness/#21627" class="Bound">δMw</a> <a id="21649" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="21651" href="/Denotational/#25541" class="Function">Env⊑</a> <a id="21656" class="Bound">γNv</a> <a id="21660" href="/Soundness/#21620" class="Bound">ineq</a> <a id="21665" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="21667" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a></pre>

<p>We apply the <code class="highlighter-rouge">subst-reflect</code> lemma to obtain
<code class="highlighter-rouge">δ ⊢ subst-zero M ↓ γ</code> and <code class="highlighter-rouge">γ ⊢ N ↓ v</code> for some <code class="highlighter-rouge">γ</code>.
Using the former, the <code class="highlighter-rouge">subst-zero-reflect</code> lemma gives
us <code class="highlighter-rouge">γ ⊑ (δ , w)</code> and <code class="highlighter-rouge">δ ⊢ M ↓ w</code>. We conclude that
<code class="highlighter-rouge">δ , w ⊢ N ↓ v</code> by applying the <code class="highlighter-rouge">Env⊑</code> lemma, using
<code class="highlighter-rouge">γ ⊢ N ↓ v</code> and <code class="highlighter-rouge">γ ⊑ (δ , w)</code>.</p>

<h3 id="reduction-reflects-denotations-1">Reduction reflects denotations</h3>

<p>Now that we have proved that substitution reflects denotations, we can
easily prove that reduction does too.</p>

<pre class="Agda"><a id="reflect-beta"></a><a id="22129" href="/Soundness/#22129" class="Function">reflect-beta</a> <a id="22142" class="Symbol">:</a> <a id="22144" class="Symbol">∀{</a><a id="22146" href="/Soundness/#22146" class="Bound">Γ</a><a id="22147" class="Symbol">}{</a><a id="22149" href="/Soundness/#22149" class="Bound">γ</a> <a id="22151" class="Symbol">:</a> <a id="22153" href="/Denotational/#7233" class="Function">Env</a> <a id="22157" href="/Soundness/#22146" class="Bound">Γ</a><a id="22158" class="Symbol">}{</a><a id="22160" href="/Soundness/#22160" class="Bound">M</a> <a id="22162" href="/Soundness/#22162" class="Bound">N</a><a id="22163" class="Symbol">}{</a><a id="22165" href="/Soundness/#22165" class="Bound">v</a><a id="22166" class="Symbol">}</a>
    <a id="22172" class="Symbol">→</a> <a id="22174" href="/Soundness/#22149" class="Bound">γ</a> <a id="22176" href="/Denotational/#9519" class="Datatype Operator">⊢</a> <a id="22178" class="Symbol">(</a><a id="22179" href="/Soundness/#22162" class="Bound">N</a> <a id="22181" href="/Untyped/#7475" class="Function Operator">[</a> <a id="22183" href="/Soundness/#22160" class="Bound">M</a> <a id="22185" href="/Untyped/#7475" class="Function Operator">]</a><a id="22186" class="Symbol">)</a> <a id="22188" href="/Denotational/#9519" class="Datatype Operator">↓</a> <a id="22190" href="/Soundness/#22165" class="Bound">v</a>
    <a id="22196" class="Symbol">→</a> <a id="22198" href="/Soundness/#22149" class="Bound">γ</a> <a id="22200" href="/Denotational/#9519" class="Datatype Operator">⊢</a> <a id="22202" class="Symbol">(</a><a id="22203" href="/Untyped/#4238" class="InductiveConstructor Operator">ƛ</a> <a id="22205" href="/Soundness/#22162" class="Bound">N</a><a id="22206" class="Symbol">)</a> <a id="22208" href="/Untyped/#4298" class="InductiveConstructor Operator">·</a> <a id="22210" href="/Soundness/#22160" class="Bound">M</a> <a id="22212" href="/Denotational/#9519" class="Datatype Operator">↓</a> <a id="22214" href="/Soundness/#22165" class="Bound">v</a>
<a id="22216" href="/Soundness/#22129" class="Function">reflect-beta</a> <a id="22229" href="/Soundness/#22229" class="Bound">d</a>
    <a id="22235" class="Keyword">with</a> <a id="22240" href="/Soundness/#21301" class="Function">substitution-reflect</a> <a id="22261" href="/Soundness/#22229" class="Bound">d</a>
<a id="22263" class="Symbol">...</a> <a id="22267" class="Symbol">|</a> <a id="22269" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="22271" href="/Soundness/#22271" class="Bound">v₂′</a> <a id="22275" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="22277" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="22279" href="/Soundness/#22279" class="Bound">d₁′</a> <a id="22283" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="22285" href="/Soundness/#22285" class="Bound">d₂′</a> <a id="22289" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="22291" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="22293" class="Symbol">=</a> <a id="22295" href="/Denotational/#9652" class="InductiveConstructor">↦-elim</a> <a id="22302" class="Symbol">(</a><a id="22303" href="/Denotational/#9790" class="InductiveConstructor">↦-intro</a> <a id="22311" href="/Soundness/#22285" class="Bound">d₂′</a><a id="22314" class="Symbol">)</a> <a id="22316" href="/Soundness/#22279" class="Bound">d₁′</a>


<a id="reflect"></a><a id="22322" href="/Soundness/#22322" class="Function">reflect</a> <a id="22330" class="Symbol">:</a> <a id="22332" class="Symbol">∀</a> <a id="22334" class="Symbol">{</a><a id="22335" href="/Soundness/#22335" class="Bound">Γ</a><a id="22336" class="Symbol">}</a> <a id="22338" class="Symbol">{</a><a id="22339" href="/Soundness/#22339" class="Bound">γ</a> <a id="22341" class="Symbol">:</a> <a id="22343" href="/Denotational/#7233" class="Function">Env</a> <a id="22347" href="/Soundness/#22335" class="Bound">Γ</a><a id="22348" class="Symbol">}</a> <a id="22350" class="Symbol">{</a><a id="22351" href="/Soundness/#22351" class="Bound">M</a> <a id="22353" href="/Soundness/#22353" class="Bound">M′</a> <a id="22356" href="/Soundness/#22356" class="Bound">N</a> <a id="22358" href="/Soundness/#22358" class="Bound">v</a><a id="22359" class="Symbol">}</a>
  <a id="22363" class="Symbol">→</a> <a id="22365" href="/Soundness/#22339" class="Bound">γ</a> <a id="22367" href="/Denotational/#9519" class="Datatype Operator">⊢</a> <a id="22369" href="/Soundness/#22356" class="Bound">N</a> <a id="22371" href="/Denotational/#9519" class="Datatype Operator">↓</a> <a id="22373" href="/Soundness/#22358" class="Bound">v</a>  <a id="22376" class="Symbol">→</a>  <a id="22379" href="/Soundness/#22351" class="Bound">M</a> <a id="22381" href="/LambdaReduction/#386" class="Datatype Operator">—→</a> <a id="22384" href="/Soundness/#22353" class="Bound">M′</a>  <a id="22388" class="Symbol">→</a>   <a id="22392" href="/Soundness/#22353" class="Bound">M′</a> <a id="22395" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Equality.html#83" class="Datatype Operator">≡</a> <a id="22397" href="/Soundness/#22356" class="Bound">N</a>
    <a id="22403" class="Comment">---------------------------------</a>
  <a id="22439" class="Symbol">→</a> <a id="22441" href="/Soundness/#22339" class="Bound">γ</a> <a id="22443" href="/Denotational/#9519" class="Datatype Operator">⊢</a> <a id="22445" href="/Soundness/#22351" class="Bound">M</a> <a id="22447" href="/Denotational/#9519" class="Datatype Operator">↓</a> <a id="22449" href="/Soundness/#22358" class="Bound">v</a>
<a id="22451" href="/Soundness/#22322" class="Function">reflect</a> <a id="22459" href="/Denotational/#9573" class="InductiveConstructor">var</a> <a id="22463" class="Symbol">(</a><a id="22464" href="/LambdaReduction/#436" class="InductiveConstructor">ξ₁</a> <a id="22467" href="/Soundness/#22467" class="Bound">r</a><a id="22468" class="Symbol">)</a> <a id="22470" class="Symbol">()</a>
<a id="22473" href="/Soundness/#22322" class="Function">reflect</a> <a id="22481" href="/Denotational/#9573" class="InductiveConstructor">var</a> <a id="22485" class="Symbol">(</a><a id="22486" href="/LambdaReduction/#526" class="InductiveConstructor">ξ₂</a> <a id="22489" href="/Soundness/#22489" class="Bound">r</a><a id="22490" class="Symbol">)</a> <a id="22492" class="Symbol">()</a>
<a id="22495" href="/Soundness/#22322" class="Function">reflect</a><a id="22502" class="Symbol">{</a><a id="22503" class="Argument">γ</a> <a id="22505" class="Symbol">=</a> <a id="22507" href="/Soundness/#22507" class="Bound">γ</a><a id="22508" class="Symbol">}</a> <a id="22510" class="Symbol">(</a><a id="22511" href="/Denotational/#9573" class="InductiveConstructor">var</a><a id="22514" class="Symbol">{</a><a id="22515" class="Argument">x</a> <a id="22517" class="Symbol">=</a> <a id="22519" href="/Soundness/#22519" class="Bound">x</a><a id="22520" class="Symbol">})</a> <a id="22523" href="/LambdaReduction/#616" class="InductiveConstructor">β</a> <a id="22525" href="/Soundness/#22525" class="Bound">mn</a>
    <a id="22532" class="Keyword">with</a> <a id="22537" href="/Denotational/#9573" class="InductiveConstructor">var</a><a id="22540" class="Symbol">{</a><a id="22541" class="Argument">γ</a> <a id="22543" class="Symbol">=</a> <a id="22545" href="/Soundness/#22507" class="Bound">γ</a><a id="22546" class="Symbol">}{</a><a id="22548" class="Argument">x</a> <a id="22550" class="Symbol">=</a> <a id="22552" href="/Soundness/#22519" class="Bound">x</a><a id="22553" class="Symbol">}</a>
<a id="22555" class="Symbol">...</a> <a id="22559" class="Symbol">|</a> <a id="22561" href="/Soundness/#22561" class="Bound">d′</a> <a id="22564" class="Keyword">rewrite</a> <a id="22572" href="https://agda.github.io/agda-stdlib/v0.17/Relation.Binary.PropositionalEquality.Core.html#838" class="Function">sym</a> <a id="22576" class="Bound">mn</a> <a id="22579" class="Symbol">=</a> <a id="22581" href="/Soundness/#22129" class="Function">reflect-beta</a> <a id="22594" href="/Soundness/#22561" class="Bound">d′</a>
<a id="22597" href="/Soundness/#22322" class="Function">reflect</a> <a id="22605" href="/Denotational/#9573" class="InductiveConstructor">var</a> <a id="22609" class="Symbol">(</a><a id="22610" href="/LambdaReduction/#724" class="InductiveConstructor">ζ</a> <a id="22612" href="/Soundness/#22612" class="Bound">r</a><a id="22613" class="Symbol">)</a> <a id="22615" class="Symbol">()</a>
<a id="22618" href="/Soundness/#22322" class="Function">reflect</a> <a id="22626" class="Symbol">(</a><a id="22627" href="/Denotational/#9652" class="InductiveConstructor">↦-elim</a> <a id="22634" href="/Soundness/#22634" class="Bound">d₁</a> <a id="22637" href="/Soundness/#22637" class="Bound">d₂</a><a id="22639" class="Symbol">)</a> <a id="22641" class="Symbol">(</a><a id="22642" href="/LambdaReduction/#436" class="InductiveConstructor">ξ₁</a> <a id="22645" href="/Soundness/#22645" class="Bound">r</a><a id="22646" class="Symbol">)</a> <a id="22648" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a> <a id="22653" class="Symbol">=</a> <a id="22655" href="/Denotational/#9652" class="InductiveConstructor">↦-elim</a> <a id="22662" class="Symbol">(</a><a id="22663" href="/Soundness/#22322" class="Function">reflect</a> <a id="22671" href="/Soundness/#22634" class="Bound">d₁</a> <a id="22674" href="/Soundness/#22645" class="Bound">r</a> <a id="22676" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a><a id="22680" class="Symbol">)</a> <a id="22682" href="/Soundness/#22637" class="Bound">d₂</a>
<a id="22685" href="/Soundness/#22322" class="Function">reflect</a> <a id="22693" class="Symbol">(</a><a id="22694" href="/Denotational/#9652" class="InductiveConstructor">↦-elim</a> <a id="22701" href="/Soundness/#22701" class="Bound">d₁</a> <a id="22704" href="/Soundness/#22704" class="Bound">d₂</a><a id="22706" class="Symbol">)</a> <a id="22708" class="Symbol">(</a><a id="22709" href="/LambdaReduction/#526" class="InductiveConstructor">ξ₂</a> <a id="22712" href="/Soundness/#22712" class="Bound">r</a><a id="22713" class="Symbol">)</a> <a id="22715" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a> <a id="22720" class="Symbol">=</a> <a id="22722" href="/Denotational/#9652" class="InductiveConstructor">↦-elim</a> <a id="22729" href="/Soundness/#22701" class="Bound">d₁</a> <a id="22732" class="Symbol">(</a><a id="22733" href="/Soundness/#22322" class="Function">reflect</a> <a id="22741" href="/Soundness/#22704" class="Bound">d₂</a> <a id="22744" href="/Soundness/#22712" class="Bound">r</a> <a id="22746" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a><a id="22750" class="Symbol">)</a>
<a id="22752" href="/Soundness/#22322" class="Function">reflect</a> <a id="22760" class="Symbol">(</a><a id="22761" href="/Denotational/#9652" class="InductiveConstructor">↦-elim</a> <a id="22768" href="/Soundness/#22768" class="Bound">d₁</a> <a id="22771" href="/Soundness/#22771" class="Bound">d₂</a><a id="22773" class="Symbol">)</a> <a id="22775" href="/LambdaReduction/#616" class="InductiveConstructor">β</a> <a id="22777" href="/Soundness/#22777" class="Bound">mn</a>
    <a id="22784" class="Keyword">with</a> <a id="22789" href="/Denotational/#9652" class="InductiveConstructor">↦-elim</a> <a id="22796" href="/Soundness/#22768" class="Bound">d₁</a> <a id="22799" href="/Soundness/#22771" class="Bound">d₂</a>
<a id="22802" class="Symbol">...</a> <a id="22806" class="Symbol">|</a> <a id="22808" href="/Soundness/#22808" class="Bound">d′</a> <a id="22811" class="Keyword">rewrite</a> <a id="22819" href="https://agda.github.io/agda-stdlib/v0.17/Relation.Binary.PropositionalEquality.Core.html#838" class="Function">sym</a> <a id="22823" class="Bound">mn</a> <a id="22826" class="Symbol">=</a> <a id="22828" href="/Soundness/#22129" class="Function">reflect-beta</a> <a id="22841" href="/Soundness/#22808" class="Bound">d′</a>
<a id="22844" href="/Soundness/#22322" class="Function">reflect</a> <a id="22852" class="Symbol">(</a><a id="22853" href="/Denotational/#9652" class="InductiveConstructor">↦-elim</a> <a id="22860" href="/Soundness/#22860" class="Bound">d₁</a> <a id="22863" href="/Soundness/#22863" class="Bound">d₂</a><a id="22865" class="Symbol">)</a> <a id="22867" class="Symbol">(</a><a id="22868" href="/LambdaReduction/#724" class="InductiveConstructor">ζ</a> <a id="22870" href="/Soundness/#22870" class="Bound">r</a><a id="22871" class="Symbol">)</a> <a id="22873" class="Symbol">()</a>
<a id="22876" href="/Soundness/#22322" class="Function">reflect</a> <a id="22884" class="Symbol">(</a><a id="22885" href="/Denotational/#9790" class="InductiveConstructor">↦-intro</a> <a id="22893" href="/Soundness/#22893" class="Bound">d</a><a id="22894" class="Symbol">)</a> <a id="22896" class="Symbol">(</a><a id="22897" href="/LambdaReduction/#436" class="InductiveConstructor">ξ₁</a> <a id="22900" href="/Soundness/#22900" class="Bound">r</a><a id="22901" class="Symbol">)</a> <a id="22903" class="Symbol">()</a>
<a id="22906" href="/Soundness/#22322" class="Function">reflect</a> <a id="22914" class="Symbol">(</a><a id="22915" href="/Denotational/#9790" class="InductiveConstructor">↦-intro</a> <a id="22923" href="/Soundness/#22923" class="Bound">d</a><a id="22924" class="Symbol">)</a> <a id="22926" class="Symbol">(</a><a id="22927" href="/LambdaReduction/#526" class="InductiveConstructor">ξ₂</a> <a id="22930" href="/Soundness/#22930" class="Bound">r</a><a id="22931" class="Symbol">)</a> <a id="22933" class="Symbol">()</a>
<a id="22936" href="/Soundness/#22322" class="Function">reflect</a> <a id="22944" class="Symbol">(</a><a id="22945" href="/Denotational/#9790" class="InductiveConstructor">↦-intro</a> <a id="22953" href="/Soundness/#22953" class="Bound">d</a><a id="22954" class="Symbol">)</a> <a id="22956" href="/LambdaReduction/#616" class="InductiveConstructor">β</a> <a id="22958" href="/Soundness/#22958" class="Bound">mn</a>
    <a id="22965" class="Keyword">with</a> <a id="22970" href="/Denotational/#9790" class="InductiveConstructor">↦-intro</a> <a id="22978" href="/Soundness/#22953" class="Bound">d</a>
<a id="22980" class="Symbol">...</a> <a id="22984" class="Symbol">|</a> <a id="22986" href="/Soundness/#22986" class="Bound">d′</a> <a id="22989" class="Keyword">rewrite</a> <a id="22997" href="https://agda.github.io/agda-stdlib/v0.17/Relation.Binary.PropositionalEquality.Core.html#838" class="Function">sym</a> <a id="23001" class="Bound">mn</a> <a id="23004" class="Symbol">=</a> <a id="23006" href="/Soundness/#22129" class="Function">reflect-beta</a> <a id="23019" href="/Soundness/#22986" class="Bound">d′</a>
<a id="23022" href="/Soundness/#22322" class="Function">reflect</a> <a id="23030" class="Symbol">(</a><a id="23031" href="/Denotational/#9790" class="InductiveConstructor">↦-intro</a> <a id="23039" href="/Soundness/#23039" class="Bound">d</a><a id="23040" class="Symbol">)</a> <a id="23042" class="Symbol">(</a><a id="23043" href="/LambdaReduction/#724" class="InductiveConstructor">ζ</a> <a id="23045" href="/Soundness/#23045" class="Bound">r</a><a id="23046" class="Symbol">)</a> <a id="23048" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a> <a id="23053" class="Symbol">=</a> <a id="23055" href="/Denotational/#9790" class="InductiveConstructor">↦-intro</a> <a id="23063" class="Symbol">(</a><a id="23064" href="/Soundness/#22322" class="Function">reflect</a> <a id="23072" href="/Soundness/#23039" class="Bound">d</a> <a id="23074" href="/Soundness/#23045" class="Bound">r</a> <a id="23076" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a><a id="23080" class="Symbol">)</a>
<a id="23082" href="/Soundness/#22322" class="Function">reflect</a> <a id="23090" href="/Denotational/#9914" class="InductiveConstructor">⊥-intro</a> <a id="23098" href="/Soundness/#23098" class="Bound">r</a> <a id="23100" href="/Soundness/#23100" class="Bound">mn</a> <a id="23103" class="Symbol">=</a> <a id="23105" href="/Denotational/#9914" class="InductiveConstructor">⊥-intro</a>
<a id="23113" href="/Soundness/#22322" class="Function">reflect</a> <a id="23121" class="Symbol">(</a><a id="23122" href="/Denotational/#9989" class="InductiveConstructor">⊔-intro</a> <a id="23130" href="/Soundness/#23130" class="Bound">d₁</a> <a id="23133" href="/Soundness/#23133" class="Bound">d₂</a><a id="23135" class="Symbol">)</a> <a id="23137" href="/Soundness/#23137" class="Bound">r</a> <a id="23139" href="/Soundness/#23139" class="Bound">mn</a> <a id="23142" class="Keyword">rewrite</a> <a id="23150" href="https://agda.github.io/agda-stdlib/v0.17/Relation.Binary.PropositionalEquality.Core.html#838" class="Function">sym</a> <a id="23154" href="/Soundness/#23139" class="Bound">mn</a> <a id="23157" class="Symbol">=</a>
   <a id="23162" href="/Denotational/#9989" class="InductiveConstructor">⊔-intro</a> <a id="23170" class="Symbol">(</a><a id="23171" href="/Soundness/#22322" class="Function">reflect</a> <a id="23179" href="/Soundness/#23130" class="Bound">d₁</a> <a id="23182" href="/Soundness/#23137" class="Bound">r</a> <a id="23184" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a><a id="23188" class="Symbol">)</a> <a id="23190" class="Symbol">(</a><a id="23191" href="/Soundness/#22322" class="Function">reflect</a> <a id="23199" href="/Soundness/#23133" class="Bound">d₂</a> <a id="23202" href="/Soundness/#23137" class="Bound">r</a> <a id="23204" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a><a id="23208" class="Symbol">)</a>
<a id="23210" href="/Soundness/#22322" class="Function">reflect</a> <a id="23218" class="Symbol">(</a><a id="23219" href="/Denotational/#10120" class="InductiveConstructor">sub</a> <a id="23223" href="/Soundness/#23223" class="Bound">d</a> <a id="23225" href="/Soundness/#23225" class="Bound">lt</a><a id="23227" class="Symbol">)</a> <a id="23229" href="/Soundness/#23229" class="Bound">r</a> <a id="23231" href="/Soundness/#23231" class="Bound">mn</a> <a id="23234" class="Symbol">=</a> <a id="23236" href="/Denotational/#10120" class="InductiveConstructor">sub</a> <a id="23240" class="Symbol">(</a><a id="23241" href="/Soundness/#22322" class="Function">reflect</a> <a id="23249" href="/Soundness/#23223" class="Bound">d</a> <a id="23251" href="/Soundness/#23229" class="Bound">r</a> <a id="23253" href="/Soundness/#23231" class="Bound">mn</a><a id="23255" class="Symbol">)</a> <a id="23257" href="/Soundness/#23225" class="Bound">lt</a></pre>

<h2 id="reduction-implies-denotational-equality">Reduction implies denotational equality</h2>

<p>We have proved that reduction both preserves and reflects
denotations. Thus, reduction implies denotational equality.</p>

<pre class="Agda"><a id="reduce-equal"></a><a id="23448" href="/Soundness/#23448" class="Function">reduce-equal</a> <a id="23461" class="Symbol">:</a> <a id="23463" class="Symbol">∀</a> <a id="23465" class="Symbol">{</a><a id="23466" href="/Soundness/#23466" class="Bound">Γ</a><a id="23467" class="Symbol">}</a> <a id="23469" class="Symbol">{</a><a id="23470" href="/Soundness/#23470" class="Bound">M</a> <a id="23472" class="Symbol">:</a> <a id="23474" href="/Soundness/#23466" class="Bound">Γ</a> <a id="23476" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="23478" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="23479" class="Symbol">}</a> <a id="23481" class="Symbol">{</a><a id="23482" href="/Soundness/#23482" class="Bound">N</a> <a id="23484" class="Symbol">:</a> <a id="23486" href="/Soundness/#23466" class="Bound">Γ</a> <a id="23488" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="23490" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="23491" class="Symbol">}</a>
  <a id="23495" class="Symbol">→</a> <a id="23497" href="/Soundness/#23470" class="Bound">M</a> <a id="23499" href="/LambdaReduction/#386" class="Datatype Operator">—→</a> <a id="23502" href="/Soundness/#23482" class="Bound">N</a>
    <a id="23508" class="Comment">---------</a>
  <a id="23520" class="Symbol">→</a> <a id="23522" href="/Denotational/#17652" class="Function">ℰ</a> <a id="23524" href="/Soundness/#23470" class="Bound">M</a> <a id="23526" href="/Denotational/#17850" class="Function Operator">≃</a> <a id="23528" href="/Denotational/#17652" class="Function">ℰ</a> <a id="23530" href="/Soundness/#23482" class="Bound">N</a>
<a id="23532" href="/Soundness/#23448" class="Function">reduce-equal</a> <a id="23545" class="Symbol">{</a><a id="23546" href="/Soundness/#23546" class="Bound">Γ</a><a id="23547" class="Symbol">}{</a><a id="23549" href="/Soundness/#23549" class="Bound">M</a><a id="23550" class="Symbol">}{</a><a id="23552" href="/Soundness/#23552" class="Bound">N</a><a id="23553" class="Symbol">}</a> <a id="23555" href="/Soundness/#23555" class="Bound">r</a> <a id="23557" href="/Soundness/#23557" class="Bound">γ</a> <a id="23559" href="/Soundness/#23559" class="Bound">v</a> <a id="23561" class="Symbol">=</a>
    <a id="23567" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="23569" class="Symbol">(λ</a> <a id="23572" href="/Soundness/#23572" class="Bound">m</a> <a id="23574" class="Symbol">→</a> <a id="23576" href="/Soundness/#6778" class="Function">preserve</a> <a id="23585" href="/Soundness/#23572" class="Bound">m</a> <a id="23587" href="/Soundness/#23555" class="Bound">r</a><a id="23588" class="Symbol">)</a> <a id="23590" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="23592" class="Symbol">(λ</a> <a id="23595" href="/Soundness/#23595" class="Bound">n</a> <a id="23597" class="Symbol">→</a> <a id="23599" href="/Soundness/#22322" class="Function">reflect</a> <a id="23607" href="/Soundness/#23595" class="Bound">n</a> <a id="23609" href="/Soundness/#23555" class="Bound">r</a> <a id="23611" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a><a id="23615" class="Symbol">)</a> <a id="23617" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a></pre>

<p>We conclude with the <em>soundness property</em>, that multi-step reduction
to a lambda abstraction implies denotational equivalence with a lambda
abstraction.</p>

<pre class="Agda"><a id="soundness"></a><a id="23798" href="/Soundness/#23798" class="Function">soundness</a> <a id="23808" class="Symbol">:</a> <a id="23810" class="Symbol">∀{</a><a id="23812" href="/Soundness/#23812" class="Bound">Γ</a><a id="23813" class="Symbol">}</a> <a id="23815" class="Symbol">{</a><a id="23816" href="/Soundness/#23816" class="Bound">M</a> <a id="23818" class="Symbol">:</a> <a id="23820" href="/Soundness/#23812" class="Bound">Γ</a> <a id="23822" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="23824" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="23825" class="Symbol">}</a> <a id="23827" class="Symbol">{</a><a id="23828" href="/Soundness/#23828" class="Bound">N</a> <a id="23830" class="Symbol">:</a> <a id="23832" href="/Soundness/#23812" class="Bound">Γ</a> <a id="23834" href="/Untyped/#3018" class="InductiveConstructor Operator">,</a> <a id="23836" href="/Untyped/#2694" class="InductiveConstructor">★</a> <a id="23838" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="23840" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="23841" class="Symbol">}</a>
  <a id="23845" class="Symbol">→</a> <a id="23847" href="/Soundness/#23816" class="Bound">M</a> <a id="23849" href="/LambdaReduction/#894" class="Datatype Operator">—↠</a> <a id="23852" href="/Untyped/#4238" class="InductiveConstructor Operator">ƛ</a> <a id="23854" href="/Soundness/#23828" class="Bound">N</a>
    <a id="23860" class="Comment">-----------------</a>
  <a id="23880" class="Symbol">→</a> <a id="23882" href="/Denotational/#17652" class="Function">ℰ</a> <a id="23884" href="/Soundness/#23816" class="Bound">M</a> <a id="23886" href="/Denotational/#17850" class="Function Operator">≃</a> <a id="23888" href="/Denotational/#17652" class="Function">ℰ</a> <a id="23890" class="Symbol">(</a><a id="23891" href="/Untyped/#4238" class="InductiveConstructor Operator">ƛ</a> <a id="23893" href="/Soundness/#23828" class="Bound">N</a><a id="23894" class="Symbol">)</a>
<a id="23896" href="/Soundness/#23798" class="Function">soundness</a> <a id="23906" class="Symbol">(</a><a id="23907" class="DottedPattern Symbol">.(</a><a id="23909" href="/Untyped/#4238" class="DottedPattern InductiveConstructor Operator">ƛ</a> <a id="23911" class="DottedPattern Symbol">_)</a> <a id="23914" href="/LambdaReduction/#944" class="InductiveConstructor Operator">[]</a><a id="23916" class="Symbol">)</a> <a id="23918" href="/Soundness/#23918" class="Bound">γ</a> <a id="23920" href="/Soundness/#23920" class="Bound">v</a> <a id="23922" class="Symbol">=</a> <a id="23924" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="23926" class="Symbol">(λ</a> <a id="23929" href="/Soundness/#23929" class="Bound">x</a> <a id="23931" class="Symbol">→</a> <a id="23933" href="/Soundness/#23929" class="Bound">x</a><a id="23934" class="Symbol">)</a> <a id="23936" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="23938" class="Symbol">(λ</a> <a id="23941" href="/Soundness/#23941" class="Bound">x</a> <a id="23943" class="Symbol">→</a> <a id="23945" href="/Soundness/#23941" class="Bound">x</a><a id="23946" class="Symbol">)</a> <a id="23948" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a>
<a id="23950" href="/Soundness/#23798" class="Function">soundness</a> <a id="23960" class="Symbol">{</a><a id="23961" href="/Soundness/#23961" class="Bound">Γ</a><a id="23962" class="Symbol">}</a> <a id="23964" class="Symbol">(</a><a id="23965" href="/Soundness/#23965" class="Bound">L</a> <a id="23967" href="/LambdaReduction/#1001" class="InductiveConstructor Operator">—→⟨</a> <a id="23971" href="/Soundness/#23971" class="Bound">r</a> <a id="23973" href="/LambdaReduction/#1001" class="InductiveConstructor Operator">⟩</a> <a id="23975" href="/Soundness/#23975" class="Bound">M—↠N</a><a id="23979" class="Symbol">)</a> <a id="23981" href="/Soundness/#23981" class="Bound">γ</a> <a id="23983" href="/Soundness/#23983" class="Bound">v</a> <a id="23985" class="Symbol">=</a>
   <a id="23990" class="Keyword">let</a> <a id="23994" href="/Soundness/#23994" class="Bound">ih</a> <a id="23997" class="Symbol">=</a> <a id="23999" href="/Soundness/#23798" class="Function">soundness</a> <a id="24009" href="/Soundness/#23975" class="Bound">M—↠N</a> <a id="24014" class="Keyword">in</a>
   <a id="24020" class="Keyword">let</a> <a id="24024" href="/Soundness/#24024" class="Bound">e</a> <a id="24026" class="Symbol">=</a> <a id="24028" href="/Soundness/#23448" class="Function">reduce-equal</a> <a id="24041" href="/Soundness/#23971" class="Bound">r</a> <a id="24043" class="Keyword">in</a>
   <a id="24049" href="/Denotational/#18271" class="Function">≃-trans</a> <a id="24057" class="Symbol">{</a><a id="24058" href="/Soundness/#23961" class="Bound">Γ</a><a id="24059" class="Symbol">}</a> <a id="24061" href="/Soundness/#24024" class="Bound">e</a> <a id="24063" href="/Soundness/#23994" class="Bound">ih</a> <a id="24066" href="/Soundness/#23981" class="Bound">γ</a> <a id="24068" href="/Soundness/#23983" class="Bound">v</a></pre>

<h2 id="unicode">Unicode</h2>

<p>This chapter uses the following unicode:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>≟  U+225F  QUESTIONED EQUAL TO (\?=)
</code></pre></div></div>

  </div>

  <p style="text-align:center;">
    
    <a alt="Previous chapter" href="/Compositional/">Prev</a>
    &bullet;
    
    
    <a alt="Source code" href="https://github.com/plfa/plfa.github.io/blob/dev/src/plfa/Soundness.lagda">Source</a>
    
    
    &bullet;
    <a alt="Next chapter" href="/Adequacy/">Next</a>
    
</p>


</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Programming Language Foundations in Agda
</h2><div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Philip Wadler</li>
          <li><a class="u-email" href="mailto:wadler@inf.ed.ac.uk">wadler@inf.ed.ac.uk</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/wadler"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">wadler</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3"></div>
    </div><div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Wen Kokke</li>
          <li><a class="u-email" href="mailto:wen.kokke@ed.ac.uk">wen.kokke@ed.ac.uk</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/wenkokke"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">wenkokke</span></a></li><li><a href="https://www.twitter.com/wenkokke"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">wenkokke</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3"></div>
    </div>This work is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>
  </div>
</footer>
<!-- Import jQuery -->
<script type="text/javascript" src="/assets/jquery.js"></script>

<!-- Script which allows for foldable code blocks -->
<script type="text/javascript">
 $('div.foldable pre').each(function(){
     var autoHeight = $(this).height();
     var lineHeight = parseFloat($(this).css('line-height'));

     var plus    = $("<div></div>");
     var horLine = $("<div></div>");
     var verLine = $("<div></div>");
     $(this).prepend(plus);
     plus.css({
         'position'         : 'relative',
         'float'            : 'right',
         'right'            : '-' + (0.5 * lineHeight - 1.5) + 'px',
         'width'            : lineHeight,
         'height'           : lineHeight});
     verLine.css({
         'position'         : 'relative',
         'height'           : lineHeight,
         'width'            : '3px',
         'background-color' : '#C1E0FF'});
     horLine.css({
         'position'         : 'relative',
         'top'              : '-' + (0.5 * lineHeight + 1.5) + 'px',
         'left'             : '-' + (0.5 * lineHeight - 1.5) + 'px',
         'height'           : '3px',
         'width'            : lineHeight,
         'background-color' : '#C1E0FF'});
     plus.append(verLine);
     plus.append(horLine);

     $(this).height(2.0 * lineHeight);
     $(this).css('overflow','hidden');

     $(this).click(function(){
         if ($(this).height() == autoHeight) {
             $(this).height(2.0 * lineHeight);
             plus.show();
         }
         else {
             $(this).height('auto');
             plus.hide();
         }
     });
 });
</script>

<!-- Import KaTeX -->
<script type="text/javascript" src="/assets/katex.js"></script>

<!-- Script which renders TeX using KaTeX -->
<script type="text/javascript">
 $("script[type='math/tex']").replaceWith(
     function(){
         var tex = $(this).text();
         return "<span class=\"inline-equation\">" +
                katex.renderToString(tex) +
                "</span>";
     });
 $("script[type='math/tex; mode=display']").replaceWith(
     function(){
         var tex = $(this).text().replace(/%.*?(\n|$)/g,"");
         return "<div class=\"equation\">" +
                katex.renderToString("\\displaystyle "+tex) +
                "</div>";
     });
</script>
</body>

</html>
